<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CKA Lab | Command Reference & Practice Scenarios</title>
  <meta name="description" content="CKA command reference with 60+ kubectl commands by domain and practice scenarios. Copy commands and run in Killercoda or your cluster.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600&family=Outfit:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <style>
    body.lab-page { overflow: hidden; }
    .lab-page { --nav-width: 400px; height: 100vh; display: flex; flex-direction: column; }
    .lab-layout { display: flex; gap: 0; flex: 1; min-height: 0; }
    .lab-sidebar { width: var(--nav-width); min-width: var(--nav-width); height: calc(100vh - 48px); background: var(--surface); border-right: 1px solid var(--border); overflow-y: auto; flex-shrink: 0; }
    .lab-main { flex: 1; display: flex; flex-direction: column; min-width: 0; min-height: 0; overflow: hidden; }
    .lab-header { padding: 1rem 1.5rem; border-bottom: 1px solid var(--border); background: var(--surface); display: flex; align-items: center; justify-content: space-between; gap: 1rem; flex-wrap: wrap; }
    .lab-header h1 { margin: 0; font-size: 1.2rem; font-weight: 700; }
    .cmd-cat { border-bottom: 1px solid var(--border); }
    .cmd-cat-header { padding: 0.6rem 1rem; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-muted); cursor: pointer; display: flex; align-items: center; justify-content: space-between; user-select: none; }
    .cmd-cat-header:hover { background: var(--surface2); color: var(--text); }
    .cmd-cat-header .arrow { font-size: 0.7rem; transition: transform 0.2s; }
    .cmd-cat.collapsed .arrow { transform: rotate(-90deg); }
    .cmd-cat.collapsed .cmd-list { display: none; }
    .cmd-list { padding: 0.25rem 0; }
    .cmd-item { display: flex; align-items: flex-start; gap: 0.5rem; padding: 0.5rem 1rem; font-size: 0.82rem; font-family: 'JetBrains Mono', monospace; cursor: pointer; transition: background 0.15s; }
    .cmd-item:hover { background: var(--surface2); }
    .cmd-item code { flex: 1; min-width: 0; white-space: pre-wrap; overflow-wrap: break-word; font-size: 0.85rem; line-height: 1.45; color: #0f172a; font-weight: 500; }
    .cmd-item .copy-btn { flex-shrink: 0; padding: 0.25rem 0.5rem; font-size: 0.75rem; margin-top: 1px; opacity: 0.7; }
    .cmd-item:hover .copy-btn { opacity: 1; }
    .lab-btn { padding: 0.5rem 1rem; font-size: 0.9rem; font-weight: 600; background: var(--accent); color: white; border: none; border-radius: 6px; cursor: pointer; text-decoration: none; display: inline-flex; align-items: center; gap: 0.5rem; }
    .lab-btn:hover { filter: brightness(1.08); }
    .lab-btn.secondary { background: var(--surface2); color: var(--text); border: 1px solid var(--border); }
    .lab-scenarios { padding: 1.5rem 2rem 2rem; border-top: 1px solid var(--border); background: var(--surface); flex: 1; min-height: 0; overflow-y: auto; }
    .lab-scenarios h2 { font-size: 1.05rem; margin: 0 0 1.25rem; color: var(--text); font-weight: 600; }
    .scenario-card { background: var(--bg); border: 1px solid var(--border); border-radius: 10px; padding: 1.25rem 1.5rem; margin-bottom: 1rem; }
    .scenario-card h4 { margin: 0 0 0.5rem; font-size: 1rem; color: var(--text); font-weight: 600; }
    .scenario-card p { margin: 0.5rem 0; font-size: 0.9rem; color: var(--text-muted); line-height: 1.6; }
.scenario-card p code { font-size: 0.85rem; background: var(--code-bg); padding: 0.1rem 0.35rem; border-radius: 3px; }
    .scenario-card pre { margin: 0.75rem 0 0; padding: 1rem 1.25rem; background: #1e293b; border-radius: 8px; font-size: 0.9rem; line-height: 1.6; overflow-x: auto; border: 1px solid #334155; }
    .scenario-card pre code { color: #e2e8f0; font-family: 'JetBrains Mono', monospace; font-size: 0.9rem; white-space: pre; }
    .scenario-card .copy-cmd { margin-top: 0.75rem; padding: 0.4rem 0.9rem; font-size: 0.85rem; font-weight: 500; }
    body.dark-mode .cmd-item code { color: #e2e8f0; }
    @media (max-width: 900px) { .lab-layout { flex-direction: column; } .lab-sidebar { width: 100%; min-width: 100%; max-height: 40vh; } }
  </style>
</head>
<body class="lab-page">
  <header class="site-header" style="height: 48px; padding: 0 1rem; justify-content: space-between;">
    <a href="index.html" style="text-decoration: none; color: inherit; display: flex; align-items: center; gap: 0.5rem;">
      <span style="font-weight: 700;">CKA Study Guide</span>
      <span class="badge">CKA</span>
    </a>
    <a href="index.html#section-16" class="lab-btn secondary">‚Üê Back to Guide</a>
    <a href="index.html" class="lab-btn secondary">üè† Home</a>
  </header>

  <div class="lab-layout">
    <aside class="lab-sidebar">
      <div style="padding: 1rem; font-size: 0.85rem; color: var(--text-muted);">
        <strong>Command Reference</strong> ‚Äî Click to copy, paste into terminal.
      </div>
      <div id="cmd-reference"></div>
    </aside>

    <div class="lab-main">
      <div class="lab-header">
        <h1>üìã CKA Command Reference & Scenarios</h1>
        <div style="display: flex; gap: 0.5rem;">
          <a href="https://killercoda.com/killer-shell-cka" target="_blank" rel="noopener" class="lab-btn">Practice in Killercoda ‚Üó</a>
          <a href="https://labs.play-with-k8s.com" target="_blank" rel="noopener" class="lab-btn secondary">Play with K8s ‚Üó</a>
        </div>
      </div>
      <div class="lab-scenarios">
        <h2>Quick scenarios ‚Äî Copy & run in Killercoda or your cluster</h2>
        <div class="scenario-card">
          <h4>1. Pod + Deployment + Service</h4>
          <p><strong>Goal:</strong> Deploy a web app, scale it, and expose it via a ClusterIP Service.</p>
          <p><strong>Steps:</strong> (1) Create a Deployment with 3 replicas of nginx. (2) Expose it on port 80. (3) Verify pods, deployment, and service.</p>
          <p><strong>Verify:</strong> <code>kubectl get pods</code> ‚Äî all should be Running. <code>kubectl get endpoints nginx-svc</code> ‚Äî shows pod IPs.</p>
          <pre><code>kubectl create deployment nginx-deploy --image=nginx:1.21 --replicas=3
kubectl expose deployment nginx-deploy --port=80 --name=nginx-svc
kubectl get deploy,svc,pods</code></pre>
          <button class="copy-cmd copy-btn">Copy all</button>
        </div>
        <div class="scenario-card">
          <h4>2. ConfigMap + Pod env</h4>
          <p><strong>Goal:</strong> Store config as ConfigMap and inject it into a Pod as an environment variable.</p>
          <p><strong>Steps:</strong> (1) Create ConfigMap with <code>APP_ENV=production</code>. (2) Create a Pod that references the ConfigMap via <code>envFrom</code> or <code>valueFrom.configMapKeyRef</code>.</p>
          <p><strong>Verify:</strong> <code>kubectl exec busybox-cm -- env | grep APP_ENV</code> ‚Äî should show <code>APP_ENV=production</code>.</p>
          <p><strong>Tip:</strong> In exam, you may need to create the pod from YAML. Use <code>kubectl run ... --dry-run=client -o yaml</code> then add the env block.</p>
          <pre><code>kubectl create configmap app-cm --from-literal=APP_ENV=production
kubectl run busybox-cm --image=busybox:1.28 --restart=Never -- sleep 3600 --overrides='{"spec":{"containers":[{"name":"b","image":"busybox:1.28","command":["sleep","3600"],"env":[{"name":"APP_ENV","valueFrom":{"configMapKeyRef":{"name":"app-cm","key":"APP_ENV"}}}]}]}}'</code></pre>
          <button class="copy-cmd copy-btn">Copy all</button>
        </div>
        <div class="scenario-card">
          <h4>3. RBAC ‚Äî Role + RoleBinding</h4>
          <p><strong>Goal:</strong> Give user <code>jane</code> permission to get and list pods in namespace <code>dev</code> only.</p>
          <p><strong>Steps:</strong> (1) Create namespace <code>dev</code> if needed: <code>kubectl create ns dev</code>. (2) Create Role with verbs <code>get,list</code> and resource <code>pods</code>. (3) Create RoleBinding to bind the Role to user <code>jane</code>.</p>
          <p><strong>Verify:</strong> <code>kubectl auth can-i get pods --as=jane -n dev</code> ‚Äî should return <code>yes</code>. Check other ns: <code>--as=jane -n kube-system</code> ‚Äî typically <code>no</code>.</p>
          <pre><code>kubectl create role pod-reader --verb=get,list --resource=pods -n dev
kubectl create rolebinding jane-pod-reader --role=pod-reader --user=jane -n dev
kubectl auth can-i get pods --as=jane -n dev</code></pre>
          <button class="copy-cmd copy-btn">Copy all</button>
        </div>
        <div class="scenario-card">
          <h4>4. Node drain (maintenance)</h4>
          <p><strong>Goal:</strong> Safely evacuate a node for maintenance without losing workloads.</p>
          <p><strong>Steps:</strong> (1) <code>cordon</code> ‚Äî mark node unschedulable. (2) <code>drain</code> ‚Äî evict all pods (use <code>--ignore-daemonsets</code> for DaemonSet pods, <code>--delete-emptydir-data</code> for emptyDir). (3) After maintenance, <code>uncordon</code> to allow scheduling again.</p>
          <p><strong>Verify:</strong> During drain, pods should reschedule to other nodes. <code>kubectl get nodes</code> ‚Äî drained node shows <code>SchedulingDisabled</code>.</p>
          <pre><code>kubectl cordon worker-1
kubectl drain worker-1 --ignore-daemonsets --delete-emptydir-data
# After maintenance:
kubectl uncordon worker-1</code></pre>
          <button class="copy-cmd copy-btn">Copy all</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    const COMMANDS = {
      'Pods': [
        ['kubectl get pods', 'List pods (default ns)'],
        ['kubectl get pods -A', 'All namespaces'],
        ['kubectl get pods -o wide', 'With node + IP'],
        ['kubectl get pods -w', 'Watch live'],
        ['kubectl describe pod <name>', 'Events + status'],
        ['kubectl logs <pod> -f', 'Stream logs'],
        ['kubectl logs <pod> --previous', 'Crashed container logs'],
        ['kubectl exec -it <pod> -- /bin/sh', 'Exec into pod'],
        ['kubectl run nginx --image=nginx', 'Create pod imperatively'],
        ['kubectl run nginx --image=nginx --dry-run=client -o yaml', 'Generate YAML'],
        ['kubectl delete pod <name>', 'Delete pod'],
      ],
      'Deployments': [
        ['kubectl create deployment myapp --image=nginx --replicas=3', 'Create deployment'],
        ['kubectl get deploy', 'List deployments'],
        ['kubectl scale deployment myapp --replicas=5', 'Scale'],
        ['kubectl set image deployment/myapp nginx=nginx:1.25', 'Update image'],
        ['kubectl rollout status deployment/myapp', 'Check rollout'],
        ['kubectl rollout history deployment/myapp', 'View history'],
        ['kubectl rollout undo deployment/myapp', 'Rollback'],
        ['kubectl rollout undo deployment/myapp --to-revision=2', 'Rollback to revision'],
      ],
      'Services': [
        ['kubectl expose deployment myapp --port=80', 'ClusterIP (default)'],
        ['kubectl expose deployment myapp --port=80 --type=NodePort', 'NodePort'],
        ['kubectl expose deployment myapp --port=80 --type=LoadBalancer', 'LoadBalancer'],
        ['kubectl get svc', 'List services'],
        ['kubectl get endpoints', 'Service endpoints'],
      ],
      'ConfigMap & Secret': [
        ['kubectl create configmap app-cm --from-literal=KEY=val', 'Create ConfigMap'],
        ['kubectl create configmap app-cm --from-file=config.txt', 'From file'],
        ['kubectl create secret generic my-secret --from-literal=pass=xxx', 'Create Secret'],
        ['kubectl get configmap,secret', 'List CM + Secrets'],
      ],
      'Storage': [
        ['kubectl get pv,pvc', 'List PV + PVC'],
        ['kubectl get storageclass', 'List StorageClasses'],
      ],
      'RBAC': [
        ['kubectl create role pod-reader --verb=get,list --resource=pods -n dev', 'Create Role'],
        ['kubectl create rolebinding jane-pod-reader --role=pod-reader --user=jane -n dev', 'RoleBinding'],
        ['kubectl create clusterrole pod-reader --verb=get,list --resource=pods', 'ClusterRole'],
        ['kubectl create clusterrolebinding ... --clusterrole=pod-reader --user=jane', 'ClusterRoleBinding'],
        ['kubectl auth can-i get pods --as=user -n dev', 'Check permission'],
      ],
      'Nodes & Scheduling': [
        ['kubectl get nodes', 'List nodes'],
        ['kubectl describe node <name>', 'Node details'],
        ['kubectl cordon <node>', 'Mark unschedulable'],
        ['kubectl drain <node> --ignore-daemonsets --delete-emptydir-data', 'Drain node'],
        ['kubectl uncordon <node>', 'Mark schedulable'],
      ],
      'Namespaces': [
        ['kubectl get ns', 'List namespaces'],
        ['kubectl create namespace dev', 'Create ns'],
        ['kubectl get pods -n dev', 'Pods in namespace'],
      ],
      'Troubleshooting': [
        ['kubectl get events -A --sort-by=.lastTimestamp', 'Recent events'],
        ['kubectl get pods -A | grep -v Running', 'Non-running pods'],
        ['kubectl describe pod <name>', 'Pod events'],
        ['kubectl logs <pod> -c <container>', 'Multi-container logs'],
      ],
      'JSONPath & Output': [
        ['kubectl get pods -o jsonpath=\'{.items[*].metadata.name}\'', 'Extract names'],
        ['kubectl get pods -o custom-columns=NAME:.metadata.name,NODE:.spec.nodeName', 'Custom columns'],
        ['kubectl get pods -o yaml', 'YAML output'],
        ['kubectl get pods -o json', 'JSON output'],
      ],
      'Job & CronJob': [
        ['kubectl create job myjob --image=busybox -- echo hello', 'Create Job'],
        ['kubectl create cronjob myjob --image=busybox --schedule="0 * * * *" -- echo hi', 'Create CronJob'],
        ['kubectl get jobs,cronjobs', 'List jobs'],
      ],
      'NetworkPolicy': [
        ['kubectl get networkpolicy', 'List NetworkPolicies'],
        ['kubectl describe networkpolicy <name>', 'Describe policy'],
      ],
      'etcd & Backup': [
        ['ETCDCTL_API=3 etcdctl snapshot save snapshot.db', 'Backup etcd'],
        ['etcdutl snapshot restore snapshot.db --data-dir=/var/lib/etcd-restore', 'Restore etcd'],
      ],
      'kubeadm': [
        ['kubeadm init --pod-network-cidr=10.244.0.0/16', 'Init control plane'],
        ['kubeadm join <master>:6443 --token <t> --discovery-token-ca-cert-hash sha256:<h>', 'Join node'],
        ['kubeadm upgrade plan', 'Check upgrade path'],
        ['kubeadm upgrade apply v1.28.0', 'Upgrade cluster'],
      ],
    };

    function renderCmdRef() {
      const el = document.getElementById('cmd-reference');
      let html = '';
      const cats = Object.entries(COMMANDS);
      cats.forEach(([cat, cmds], i) => {
        const collapsed = ' collapsed';
        html += `<div class="cmd-cat${collapsed}">
          <div class="cmd-cat-header"><span>${cat}</span><span class="arrow">‚ñº</span></div>
          <div class="cmd-list">`;
        cmds.forEach(([cmd]) => {
          html += `<div class="cmd-item"><code>${escapeHtml(cmd)}</code><button class="copy-btn" title="Copy">Copy</button></div>`;
        });
        html += '</div></div>';
      });
      el.innerHTML = html;
      el.querySelectorAll('.cmd-cat-header').forEach(h => {
        h.addEventListener('click', () => h.parentElement.classList.toggle('collapsed'));
      });
      el.querySelectorAll('.cmd-item').forEach(item => {
        const code = item.querySelector('code');
        const cmd = () => code ? code.textContent : item.dataset.cmd || '';
        item.querySelector('.copy-btn').addEventListener('click', e => { e.stopPropagation(); copyToClipboard(cmd()); });
        item.addEventListener('click', () => copyToClipboard(cmd()));
      });
      document.querySelectorAll('.scenario-card').forEach(card => {
        const pre = card.querySelector('pre code');
        const btn = card.querySelector('.copy-cmd');
        if (btn && pre) {
          btn.addEventListener('click', () => copyToClipboard(pre.textContent));
        }
      });
    }

    function copyToClipboard(text) {
      const t = text.replace(/\\n/g, '\n');
      navigator.clipboard.writeText(t).then(() => {
        const toast = document.createElement('div');
        toast.textContent = '‚úì Copied';
        toast.style.cssText = 'position:fixed;bottom:20px;right:20px;background:var(--accent);color:white;padding:0.5rem 1rem;border-radius:6px;font-size:0.9rem;z-index:9999;animation:fadeIn 0.2s;';
        document.body.appendChild(toast);
        setTimeout(() => toast.remove(), 1500);
      });
    }

    function escapeHtml(s) {
      const d = document.createElement('div');
      d.textContent = s;
      return d.innerHTML;
    }

    renderCmdRef();
  </script>
</body>
</html>
