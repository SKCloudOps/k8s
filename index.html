<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CKA Exam Study Guide | Certified Kubernetes Administrator (CKA) Preparation &amp; Cheat Sheet</title>
  <meta name="description"
    content="Free CKA study guide: cluster architecture, scheduling, networking, storage, RBAC, troubleshooting. Commands, YAML examples &amp; diagrams for Certified Kubernetes Administrator exam.">
  <meta name="keywords"
    content="CKA, Certified Kubernetes Administrator, Kubernetes certification, CKA exam, CKA study guide, CKA preparation, Kubernetes admin, kubectl, K8s certification">
  <meta name="author" content="CKA Study Guide">
  <meta name="robots" content="index, follow">
  <!-- Replace with your real page URL when you publish the site -->
  <link rel="canonical" href="https://example.com/cka-preparation.html">
  <!-- Open Graph -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="CKA Exam Study Guide | Certified Kubernetes Administrator Preparation">
  <meta property="og:description"
    content="Free CKA study guide with commands, YAML examples and diagrams. Covers cluster architecture, scheduling, networking, storage, security and troubleshooting for the CKA exam.">
  <meta property="og:url" content="https://example.com/cka-preparation.html">
  <meta property="og:locale" content="en_US">
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="CKA Exam Study Guide | Certified Kubernetes Administrator">
  <meta name="twitter:description"
    content="Free CKA study guide: commands, YAML snippets and diagrams for Certified Kubernetes Administrator (CKA) exam preparation.">
  <meta name="theme-color" content="#ffffff">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600&family=Outfit:wght@400;500;600;700&display=swap"
    rel="stylesheet">
  <style>
    :root {
      --bg: #ffffff;
      --surface: #f6f8fa;
      --surface2: #eaeef2;
      --text: #1f2328;
      --text-muted: #656d76;
      --accent: #1a7f37;
      --accent2: #0969da;
      --border: #d0d7de;
      --code-bg: #f6f8fa;
      --nav-width: 260px;
      --content-max: 720px;
      --header-h: 40px;
    }

    *,
    *::before,
    *::after {
      box-sizing: border-box;
    }

    html {
      font-size: 16px;
      overflow: hidden;
      /* Prevent default scrollbars, main content scrolls independently */
    }

    /* Content blocks: only one open at a time */
    .content-block {
      display: none;
      overflow: hidden;
      animation: blockOpen 0.4s ease-out;
    }

    .content-block.is-open {
      display: block;
    }

    @keyframes blockOpen {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    body {
      margin: 0;
      font-family: 'Outfit', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.65;
      -webkit-font-smoothing: antialiased;
      overflow: hidden;
      /* Double ensure no body scroll */
    }

    .site-header {
      position: sticky;
      top: 0;
      z-index: 100;
      height: var(--header-h);
      background: var(--surface);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      padding: 0 1.25rem;
    }

    .site-header h1 {
      margin: 0;
      font-size: clamp(1rem, 2.5vw, 1.25rem);
      font-weight: 600;
      color: var(--text);
    }

    .site-header .badge {
      margin-left: 0.5rem;
      font-size: 0.7rem;
      padding: 0.2em 0.5em;
      background: var(--accent);
      color: var(--bg);
      border-radius: 4px;
      font-weight: 600;
    }

    .header-controls {
      margin-left: auto;
      display: flex;
      gap: 0.5rem;
    }

    .icon-btn {
      padding: 0.4rem;
      background: transparent;
      border: 1px solid var(--border);
      border-radius: 6px;
      color: var(--text-muted);
      cursor: pointer;
      font-size: 1.1rem;
      line-height: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .icon-btn:hover {
      background: var(--surface2);
      color: var(--text);
    }

    .nav-toggle {
      display: none;
      /* Handled by header-controls on desktop, this is for mobile override logic if needed */
    }

    /* Layout toggles */
    .layout.nav-hidden nav {
      display: none;
    }

    .layout.sidebar-hidden .right-sidebar {
      display: none;
    }

    /* Make main content expand when sidebars are hidden */
    .layout.nav-hidden main {
      padding-left: clamp(1.5rem, 5vw, 4rem);
      /* Center it a bit more when wide */
    }

    .layout {
      display: flex;
      min-height: calc(100vh - var(--header-h));
    }

    nav {
      position: sticky;
      top: var(--header-h);
      width: var(--nav-width);
      min-width: var(--nav-width);
      height: calc(100vh - var(--header-h));
      overflow-y: auto;
      background: var(--surface);
      border-right: 1px solid var(--border);
      padding: 1.5rem 1rem;
      /* More padding for breathing room */
      flex-shrink: 0;
      /* Scrollbar styling */
      scrollbar-width: thin;
      scrollbar-color: var(--border) transparent;
    }

    nav::-webkit-scrollbar {
      width: 6px;
    }

    nav::-webkit-scrollbar-thumb {
      background-color: var(--border);
      border-radius: 3px;
    }

    nav a {
      display: block;
      padding: 0.6rem 1rem;
      margin-bottom: 0.1rem;
      color: var(--text-muted);
      text-decoration: none;
      font-size: 0.9rem;
      font-weight: 500;
      border-radius: 6px;
      border-left: none;
      transition: all 0.2s ease-in-out;
      position: relative;
    }

    nav a:hover,
    nav a.active {
      color: var(--accent2);
      background: var(--surface2);
      transform: translateX(3px);
      font-weight: 600;
    }

    /* Submenu styling */
    .nav-submenu {
      display: none;
      margin-bottom: 0.5rem;
      padding-left: 0.5rem;
    }

    .nav-item.active .nav-submenu {
      display: block;
      animation: fadeIn 0.3s ease;
    }

    .nav-sub-link {
      font-size: 0.8rem !important;
      padding: 0.35rem 1rem 0.35rem 1.5rem !important;
      color: var(--text-muted) !important;
      opacity: 0.85;
      font-weight: 400 !important;
      background: transparent !important;
    }

    .nav-sub-link:hover {
      color: var(--accent) !important;
      background: var(--surface2) !important;
      opacity: 1;
      transform: translateX(2px) !important;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(-5px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    nav .nav-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 0.5rem 0.5rem;
      /* Aligned with new padding */
      border-bottom: 2px solid var(--surface2);
      /* Subtle divider */
      margin-bottom: 1rem;
    }

    nav .nav-section {
      font-size: 0.75rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text);
      opacity: 0.8;
    }

    .nav-close {
      display: none;
      padding: 0.4rem;
      font-size: 1.25rem;
      line-height: 1;
      background: var(--surface2);
      border: none;
      border-radius: 50%;
      /* Circle button */
      color: var(--text);
      cursor: pointer;
      transition: background 0.2s;
    }

    .nav-close:hover {
      background: var(--border);
    }

    main {
      flex: 1;
      min-width: 0;
      padding: clamp(1.25rem, 4vw, 2.5rem) clamp(1.5rem, 5vw, 3rem) 4rem;
      /* Allow main content to scroll independently */
      height: calc(100vh - var(--header-h));
      overflow-y: auto;
      scrollbar-width: thin;
      scrollbar-color: var(--border) transparent;
    }

    main::-webkit-scrollbar {
      width: 8px;
    }

    main::-webkit-scrollbar-thumb {
      background-color: var(--border);
      border-radius: 4px;
    }

    .page-title {
      font-size: clamp(1.5rem, 4vw, 2rem);
      font-weight: 700;
      margin: 0 0 0.35rem;
      color: var(--text);
    }

    .subtitle {
      color: var(--text-muted);
      margin-bottom: 2rem;
      font-size: clamp(0.9rem, 1.5vw, 1.05rem);
      line-height: 1.5;
    }

    h2 {
      font-size: clamp(1.25rem, 2.5vw, 1.5rem);
      font-weight: 600;
      margin: 2.25rem 0 0.85rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid var(--border);
      color: var(--accent);
      scroll-margin-top: calc(var(--header-h) + 0.5rem);
    }

    h3 {
      font-size: clamp(1.05rem, 2vw, 1.2rem);
      font-weight: 600;
      margin: 1.5rem 0 0.6rem;
      color: var(--text);
    }

    h4 {
      font-size: 1rem;
      margin: 1rem 0 0.4rem;
      color: var(--text-muted);
      font-weight: 500;
    }

    p {
      margin: 0.65rem 0;
      max-width: 70ch;
    }

    ul,
    ol {
      margin: 0.65rem 0;
      padding-left: 1.5rem;
      max-width: 70ch;
    }

    li {
      margin: 0.3rem 0;
    }

    pre,
    code {
      font-family: 'JetBrains Mono', 'Consolas', monospace;
    }

    code {
      background: rgba(175, 184, 193, 0.2);
      border-radius: 6px;
      padding: 0.2em 0.4em;
      font-size: 0.875em;
      color: var(--text);
    }

    pre {
      padding: 1.25rem;
      overflow-x: auto;
      margin: 1.5rem 0;
      font-size: 0.9rem;
      max-width: 100%;
      background: #0d1117;
      /* High contrast dark bg */
      color: #c9d1d9;
      border: 1px solid #30363d;
      border-radius: 12px;
      box-shadow: 0 12px 24px -10px rgba(0, 0, 0, 0.3);
      position: relative;
    }

    /* Adding a subtle 'window controls' look to all code blocks */
    pre::before {
      content: "•••";
      display: block;
      font-size: 1.2rem;
      letter-spacing: -2px;
      color: #30363d;
      margin-bottom: 0.75rem;
      line-height: 0.5;
    }

    pre code {
      padding: 0;
      background: none;
      border: none;
      border-radius: 0;
      color: inherit;
      font-size: inherit;
    }

    .card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 1.25rem;
      margin: 1rem 0;
      max-width: 70ch;
    }

    .snippet-label {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-bottom: 0.35rem;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }

    .diagram {
      margin: 1.5rem 0;
      padding: 1.5rem;
      border: 1px solid var(--border);
      border-radius: 10px;
      background: var(--surface);
      text-align: center;
    }

    .diagram svg {
      display: block;
      max-width: 100%;
      height: auto;
      margin: 0 auto;
    }

    .diagram figcaption {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-top: 0.75rem;
      padding-top: 0.75rem;
      border-top: 1px solid var(--border);
      text-align: center;
      max-width: 56ch;
      margin-left: auto;
      margin-right: auto;
    }

    .step-list {
      list-style: none;
      padding-left: 0;
      max-width: 70ch;
    }

    .step-list li {
      position: relative;
      padding-left: 1.5rem;
      margin: 0.5rem 0;
    }

    .step-list li::before {
      content: "→";
      position: absolute;
      left: 0;
      color: var(--accent);
      font-weight: 600;
    }

    .site-footer {
      padding: 1rem 1.5rem;
      border-top: 1px solid var(--border);
      background: var(--surface);
      font-size: 0.8rem;
      color: var(--text-muted);
      text-align: center;
    }

    /* ── Responsive breakpoints ─────────────────────────────────────── */

    /* Large desktop — hide right sidebar when screen is tight */
    @media (max-width: 1400px) {
      .right-sidebar {
        display: none;
      }
    }

    /* Tablet landscape */
    @media (max-width: 992px) {
      nav {
        width: 220px;
        min-width: 220px;
      }

      main {
        padding-left: 1.5rem;
        padding-right: 1.5rem;
      }

      .cheat-grid {
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      }
    }

    /* Tablet portrait & small laptop — collapsing nav becomes a drawer */
    @media (max-width: 768px) {
      .nav-toggle {
        display: block;
      }

      .nav-close {
        display: block;
      }

      nav {
        display: none;
        /* Hidden by default on mobile */
        position: fixed;
        top: var(--header-h);
        left: 0;
        right: 0;
        width: 100%;
        min-width: 0;
        height: auto;
        max-height: calc(100vh - var(--header-h));
        /* Use full viewport height minus header */
        z-index: 999;
        overflow-y: auto;
        /* Ensure scrolling */
        -webkit-overflow-scrolling: touch;
        /* Smooth scrolling on iOS */
        border-right: none;
        border-bottom: 1px solid var(--border);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.18);
        background: var(--surface);
      }

      nav.is-open {
        display: block;
        /* Show when open */
        animation: slideDown 0.25s ease-out forwards;
      }

      @keyframes slideDown {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }

        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .layout {
        flex-direction: column;
      }

      main {
        padding: 1.25rem 1rem 3rem;
      }

      .cheat-grid {
        grid-template-columns: 1fr;
      }

      .diagram {
        overflow-x: auto;
      }

      .card {
        max-width: none;
      }
    }

    /* Mobile */
    /* Copy Button - Global */
    .copy-btn {
      position: sticky;
      float: right;
      top: 0;
      right: 0;
      margin-top: -0.5rem;
      margin-right: -0.5rem;
      background: transparent;
      border: 1px solid transparent;
      color: #8b949e;
      border-radius: 4px;
      padding: 0.25rem;
      cursor: pointer;
      opacity: 0;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
      backdrop-filter: blur(2px);
    }

    pre:hover .copy-btn {
      opacity: 1;
    }

    .copy-btn:hover {
      background: rgba(255, 255, 255, 0.1);
      color: #f0f6fc;
      border-color: rgba(255, 255, 255, 0.15);
    }

    .copy-btn.copied {
      color: #3fb950;
      border-color: rgba(63, 185, 80, 0.4);
      background: rgba(63, 185, 80, 0.1);
    }

    /* Mobile */
    /* Mobile override for pre */
    @media (max-width: 480px) {
      :root {
        --header-h: 50px;
      }

      .site-header {
        padding: 0 0.75rem;
      }

      .site-header h1 {
        font-size: 0.95rem;
      }

      main {
        padding: 0.75rem 0.65rem 2.5rem;
      }

      pre {
        padding: 0.65rem;
        font-size: 0.78rem;
        margin: 0.5rem -0.25rem;
        border-radius: 6px;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }

      /* Ensure copy btn is visible on touch for mobile if needed */
      pre .copy-btn {
        opacity: 1;
        background: rgba(255, 255, 255, 0.05);
      }

      h2 {
        font-size: 1.3rem;
      }

      h3 {
        font-size: 1.05rem;
      }

      .cheat-card {
        padding: 0.75rem;
      }

      .cheat-card pre {
        font-size: 0.75rem;
      }

      .mock-question,
      .playground-scenario {
        padding: 0.9rem 1rem;
      }
    }

    /* Challenge Mode CSS */
    .challenge-toggle-wrapper {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-right: 1rem;
    }

    .challenge-label {
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--text-muted);
    }

    .toggle-switch {
      position: relative;
      width: 40px;
      height: 20px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--surface2);
      transition: .4s;
      border-radius: 20px;
      border: 1px solid var(--border);
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 14px;
      width: 14px;
      left: 3px;
      bottom: 2px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }

    input:checked+.slider {
      background-color: var(--accent);
      border-color: var(--accent);
    }

    input:checked+.slider:before {
      transform: translateX(20px);
    }

    /* Challenge Mode Effects */
    /* Challenge Mode Effects */
    body.challenge-mode-active pre code,
    body.challenge-mode-active .diagram svg {
      filter: blur(5px);
      opacity: 0.7;
      pointer-events: none;
      user-select: none;
      transition: all 0.3s ease;
    }

    body.challenge-mode-active pre:hover code,
    body.challenge-mode-active .diagram:hover svg {
      filter: blur(0);
      opacity: 1;
      pointer-events: auto;
      user-select: auto;
    }

    body.challenge-mode-active pre,
    body.challenge-mode-active .diagram {
      position: relative;
    }

    body.challenge-mode-active pre::after,
    body.challenge-mode-active .diagram::after {
      content: "Hover to Reveal";
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      font-size: 0.8rem;
      pointer-events: none;
      opacity: 1;
      z-index: 10;
      white-space: nowrap;
    }

    body.challenge-mode-active pre:hover::after,
    body.challenge-mode-active .diagram:hover::after {
      opacity: 0;
    }

    /* Print */
    @media print {

      .site-header,
      nav,
      .nav-toggle,
      .right-sidebar,
      .site-footer {
        display: none !important;
      }

      body {
        background: #fff;
        color: #111;
      }

      main {
        padding: 0;
      }

      .content-block {
        display: block !important;
      }

      .diagram {
        break-inside: avoid;
      }

      pre {
        white-space: pre-wrap;
        word-break: break-word;
      }
    }

    /* Mock exam & playground */
    .mock-question,
    .playground-scenario {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 1.25rem 1.5rem;
      margin: 1rem 0;
    }

    .mock-question h4,
    .playground-scenario h4 {
      margin: 0 0 0.5rem;
      font-size: 1.05rem;
      color: var(--accent2);
    }

    .mock-context,
    .playground-context {
      color: var(--text-muted);
      margin: 0.5rem 0;
    }

    .mock-task,
    .playground-task {
      margin: 0.75rem 0;
      font-weight: 500;
    }

    .solution-toggle,
    .playground-toggle {
      display: inline-block;
      margin: 0.75rem 0 0;
      padding: 0.4rem 0.9rem;
      font-size: 0.9rem;
      font-family: inherit;
      font-weight: 600;
      color: var(--accent);
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.15s, color 0.15s;
    }

    .solution-toggle:hover,
    .playground-toggle:hover {
      background: var(--border);
      color: var(--text);
    }

    .mock-solution,
    .playground-solution {
      display: none;
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px dashed var(--border);
    }

    .mock-solution.is-open,
    .playground-solution.is-open {
      display: block;
    }

    .mock-solution pre,
    .playground-solution pre {
      margin: 0.5rem 0 0;
    }

    .playground-links {
      list-style: none;
      padding: 0;
      margin: 1rem 0;
    }

    .playground-links li {
      margin: 0.75rem 0;
      padding: 0.75rem 1rem;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
    }

    .playground-links a {
      font-weight: 600;
      color: var(--accent2);
      text-decoration: none;
    }

    .playground-links a:hover {
      text-decoration: underline;
    }

    .playground-links .link-desc {
      font-size: 0.9rem;
      color: var(--text-muted);
      margin-top: 0.25rem;
    }


    /* ── Cheat Sheet & Syntax Highlighting ────────────────────────── */
    .cheat-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(360px, 1fr));
      gap: 2rem;
      margin: 2.5rem 0;
    }

    .cheat-card {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 4px 24px rgba(0, 0, 0, 0.06);
      transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
      display: flex;
      flex-direction: column;
    }

    .cheat-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.12);
      border-color: var(--accent2);
    }

    .cheat-card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.6rem;
      background: linear-gradient(to right, var(--surface), var(--surface2));
      border-bottom: 1px solid var(--border);
      padding: 0.85rem 1.25rem;
    }

    .cheat-card-header h4 {
      margin: 0;
      font-size: 1rem;
      font-weight: 700;
      color: var(--text);
      letter-spacing: -0.01em;
    }

    .cheat-card-header::after {
      content: "";
      width: 40px;
      height: 4px;
      background: var(--accent2);
      border-radius: 2px;
      opacity: 0.5;
    }

    .cheat-card-body {
      padding: 0;
      background: #0d1117;
      flex: 1;
    }

    /* Override global pre inside cheat cards to remove extra padding/margin */
    .cheat-card pre {
      margin: 0;
      padding: 1.25rem;
      background: transparent;
      border: none;
      border-radius: 0;
      box-shadow: none;
      font-size: 0.88rem;
      line-height: 1.65;
      overflow-x: auto;
    }

    .cheat-card pre::before {
      display: none;
      /* Hide the window dots in cards as header serves that purpose */
    }

    /* Syntax colouring (Global) */
    .cs-str {
      color: #a5d6ff;
    }

    /* Light Blue */
    .cs-comment {
      color: #8b949e;
      font-style: italic;
    }

    /* Muted Grey */
    .cs-key {
      color: #7ee787;
    }

    /* Green */
    .cs-kw {
      color: #ff7b72;
      font-weight: bold;
    }

    /* Red/Pink */
    .cs-flag {
      color: #79c0ff;
    }

    /* Blue */
    .cs-val {
      color: #d2a8ff;
    }

    /* Purple */
    .cs-section {
      color: #bc8cff;
      font-weight: bold;
      border-bottom: 1px dashed #bc8cff;
    }

    /* Two-column on wide screens */
    @media (min-width: 1400px) {
      .cheat-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 768px) {
      .cheat-card pre {
        font-size: 0.8rem;
        padding: 1rem;
      }

      .cheat-grid {
        gap: 1.5rem;
      }
    }

    /* Right sidebar — Quick Links */
    .right-sidebar {
      position: sticky;
      top: var(--header-h);
      width: 240px;
      /* Slightly wider */
      min-width: 240px;
      height: calc(100vh - var(--header-h));
      overflow-y: auto;
      background: var(--surface);
      border-left: 1px solid var(--border);
      padding: 2rem 1.5rem;
      /* More generous padding */
      flex-shrink: 0;
    }

    .right-sidebar .sidebar-title {
      font-size: 0.8rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text);
      opacity: 0.6;
      margin: 0 0 1rem 0.5rem;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid var(--surface2);
    }

    .right-sidebar ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .right-sidebar li {
      margin: 0.25rem 0;
    }

    .right-sidebar a {
      display: block;
      padding: 0.5rem 1rem;
      font-size: 0.9rem;
      color: var(--text-muted);
      text-decoration: none;
      border-radius: 6px;
      transition: all 0.2s ease;
      position: relative;
    }

    .right-sidebar a:hover {
      color: var(--accent);
      background: var(--surface2);
      padding-left: 1.4rem;
      /* Slide effect */
    }

    .right-sidebar .link-note {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-top: 1.5rem;
      padding: 0.75rem;
      background: var(--surface2);
      border-radius: 6px;
      border: 1px solid var(--border);
      line-height: 1.5;
      font-style: italic;
    }

    /* Terminal Simulator CSS */
    .term-fab {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: var(--accent);
      color: white;
      border: none;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      font-size: 1.5rem;
      font-family: monospace;
      font-weight: bold;
      cursor: pointer;
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .term-fab:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
    }

    .term-container {
      position: fixed;
      bottom: 2rem;
      left: 2rem;
      width: 600px;
      height: 400px;
      background: #1e1e1e;
      border-radius: 8px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      z-index: 1001;
      display: none;
      flex-direction: column;
      border: 1px solid #444;
      font-family: 'Fira Code', 'Courier New', monospace;
      font-size: 0.9rem;
      overflow: hidden;
      transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
      transform: translateY(20px);
      opacity: 0;
    }

    .term-container.open {
      display: flex;
      transform: translateY(0);
      opacity: 1;
    }

    /* Mobile Terminal */
    @media (max-width: 640px) {
      .term-container {
        width: 100%;
        height: 50vh;
        bottom: 0;
        left: 0;
        border-radius: 8px 8px 0 0;
      }

      .term-fab {
        bottom: 1.5rem;
        left: 1.5rem;
      }
    }

    .term-header {
      background: #2d2d2d;
      padding: 0.5rem 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #333;
      color: #ccc;
      font-size: 0.8rem;
    }

    .term-controls span {
      margin-left: 1rem;
      cursor: pointer;
      font-weight: bold;
    }

    .term-controls span:hover {
      color: white;
    }

    .term-body {
      flex: 1;
      padding: 1rem;
      color: #d4d4d4;
      overflow-y: auto;
      background: #1e1e1e;
    }

    .term-line {
      margin-bottom: 0.25rem;
      line-height: 1.4;
      white-space: pre-wrap;
    }

    .term-line.output {
      color: #ce9178;
      /* Output color */
      margin-bottom: 0.75rem;
    }

    .term-input-line {
      display: flex;
      align-items: center;
    }

    .prompt {
      color: #4ec9b0;
      margin-right: 0.5rem;
    }

    .term-input {
      background: transparent;
      border: none;
      color: #d4d4d4;
      flex: 1;
      font-family: inherit;
      font-size: inherit;
      outline: none;
    }

    /* ══════════════════════════════════════════════════════════════════
       ADVANCED FEATURES CSS
       ══════════════════════════════════════════════════════════════════ */

    /* ── Dark Mode ────────────────────────────────────────────────────── */
    body.dark-mode {
      --bg: #0d1117;
      --surface: #161b22;
      --surface2: #21262d;
      --text: #e6edf3;
      --text-muted: #8b949e;
      --accent: #3fb950;
      --accent2: #58a6ff;
      --border: #30363d;
      --code-bg: #161b22;
    }

    body.dark-mode .site-header {
      background: var(--surface);
    }

    body.dark-mode nav {
      background: var(--surface);
    }

    body.dark-mode main {
      background: var(--bg);
    }

    body.dark-mode .card {
      background: var(--surface);
    }

    body.dark-mode .cheat-card {
      background: var(--surface2);
      border-color: var(--border);
    }

    body.dark-mode .right-sidebar {
      background: var(--surface);
    }

    body.dark-mode code {
      background: rgba(110, 118, 129, 0.4);
    }

    body.dark-mode .mock-question,
    body.dark-mode .playground-scenario {
      background: var(--surface);
      border-color: var(--border);
    }

    body.dark-mode .diagram {
      background: var(--surface);
    }

    body.dark-mode .diagram svg text {
      fill: var(--text) !important;
    }

    body.dark-mode .diagram svg rect[fill='#f6f8fa'],
    body.dark-mode .diagram svg rect[fill='#eaeef2'] {
      fill: var(--surface2) !important;
    }

    body.dark-mode .site-footer {
      background: var(--surface);
      color: var(--text-muted);
    }

    body.dark-mode .icon-btn {
      border-color: var(--border);
      color: var(--text-muted);
    }

    body.dark-mode .icon-btn:hover {
      background: var(--surface2);
      color: var(--text);
    }

    body.dark-mode .term-container {
      background: #010409;
      border-color: #30363d;
    }

    body.dark-mode .solution-toggle,
    body.dark-mode .playground-toggle {
      background: var(--surface2);
      border-color: var(--border);
    }

    body.dark-mode .nav-sub-link {
      color: var(--text-muted) !important;
    }

    body.dark-mode .icon-btn.active-toggle {
      background: rgba(88, 166, 255, 0.15);
      color: var(--accent2);
    }

    /* ── Reading Progress Bar ─────────────────────────────────────────── */
    #reading-progress {
      position: fixed;
      top: 0;
      left: 0;
      height: 3px;
      width: 0%;
      background: linear-gradient(90deg, var(--accent) 0%, var(--accent2) 100%);
      z-index: 9999;
      transition: width 0.1s linear;
      border-radius: 0 2px 2px 0;
      box-shadow: 0 0 8px rgba(26, 127, 55, 0.5);
    }

    /* ── Search Modal ─────────────────────────────────────────────────── */
    #search-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.65);
      backdrop-filter: blur(4px);
      z-index: 10000;
      align-items: flex-start;
      justify-content: center;
      padding-top: 10vh;
    }

    #search-overlay.open {
      display: flex;
      animation: fadeOverlay 0.15s ease;
    }

    @keyframes fadeOverlay {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    #search-box {
      width: min(680px, 90vw);
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 32px 64px rgba(0, 0, 0, 0.35);
    }

    #search-input-wrap {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 1rem 1.25rem;
      border-bottom: 1px solid var(--border);
    }

    #search-input-wrap svg {
      flex-shrink: 0;
      color: var(--text-muted);
    }

    #search-input {
      flex: 1;
      border: none;
      background: transparent;
      font-family: inherit;
      font-size: 1.05rem;
      color: var(--text);
      outline: none;
    }

    #search-input::placeholder {
      color: var(--text-muted);
    }

    #search-shortcut-hint {
      font-size: 0.75rem;
      color: var(--text-muted);
      padding: 0.2em 0.45em;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 4px;
      white-space: nowrap;
    }

    #search-results {
      max-height: 400px;
      overflow-y: auto;
      padding: 0.5rem;
    }

    .search-result-item {
      padding: 0.7rem 1rem;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.15s;
    }

    .search-result-item:hover,
    .search-result-item.is-selected {
      background: var(--surface2);
    }

    .search-result-item .res-title {
      font-weight: 600;
      font-size: 0.92rem;
      color: var(--text);
      margin-bottom: 0.2rem;
    }

    .search-result-item .res-snippet {
      font-size: 0.82rem;
      color: var(--text-muted);
      line-height: 1.4;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .search-result-item .res-snippet mark,
    .search-result-item .res-title mark {
      background: rgba(255, 213, 0, 0.35);
      color: inherit;
      border-radius: 2px;
      padding: 0 2px;
    }

    #search-empty {
      padding: 3rem;
      text-align: center;
      color: var(--text-muted);
      font-size: 0.9rem;
    }

    #search-footer {
      padding: 0.65rem 1.25rem;
      border-top: 1px solid var(--border);
      display: flex;
      gap: 1.25rem;
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    #search-footer kbd {
      display: inline-block;
      padding: 0.1em 0.4em;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 4px;
      font-family: inherit;
    }

    /* ── Progress Tracker ─────────────────────────────────────────────── */
    .nav-progress-bar-wrap {
      margin: 0 0 1.25rem;
      padding: 0.75rem 1rem;
      background: var(--surface2);
      border-radius: 8px;
    }

    .nav-progress-label {
      font-size: 0.72rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: var(--text-muted);
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.45rem;
    }

    .nav-progress-label span {
      color: var(--accent);
      font-size: 0.78rem;
    }

    .nav-progress-track {
      background: var(--border);
      border-radius: 4px;
      height: 5px;
      overflow: hidden;
    }

    .nav-progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      border-radius: 4px;
      transition: width 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
    }

    .nav-item-wrap {
      position: relative;
    }

    .nav-check {
      position: absolute;
      right: 0.5rem;
      top: 50%;
      transform: translateY(-50%);
      width: 16px;
      height: 16px;
      border-radius: 50%;
      border: 1.5px solid var(--border);
      background: transparent;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      flex-shrink: 0;
      z-index: 1;
    }

    .nav-check:hover {
      border-color: var(--accent);
    }

    .nav-check.done {
      background: var(--accent);
      border-color: var(--accent);
    }

    .nav-check.done::after {
      content: '✓';
      color: white;
      font-size: 9px;
      font-weight: 700;
    }

    /* ── Notes Panel ──────────────────────────────────────────────────── */
    #notes-panel {
      position: fixed;
      right: -420px;
      top: var(--header-h);
      width: 380px;
      height: calc(100vh - var(--header-h));
      background: var(--bg);
      border-left: 1px solid var(--border);
      box-shadow: -8px 0 32px rgba(0, 0, 0, 0.12);
      z-index: 5000;
      display: flex;
      flex-direction: column;
      transition: right 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    }

    #notes-panel.open {
      right: 0;
    }

    #notes-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem 1.25rem;
      border-bottom: 1px solid var(--border);
      background: var(--surface);
    }

    #notes-header h3 {
      margin: 0;
      font-size: 0.95rem;
      color: var(--text);
    }

    #notes-close {
      background: none;
      border: none;
      color: var(--text-muted);
      cursor: pointer;
      font-size: 1.3rem;
      line-height: 1;
      padding: 0.25rem;
      border-radius: 4px;
    }

    #notes-close:hover {
      background: var(--surface2);
      color: var(--text);
    }

    #notes-section-name {
      padding: 0.5rem 1.25rem;
      font-size: 0.78rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--accent2);
      background: var(--surface);
      border-bottom: 1px solid var(--border);
    }

    #notes-textarea {
      flex: 1;
      border: none;
      outline: none;
      resize: none;
      padding: 1.25rem;
      font-family: 'Outfit', sans-serif;
      font-size: 0.9rem;
      line-height: 1.7;
      color: var(--text);
      background: var(--bg);
    }

    #notes-footer {
      padding: 0.75rem 1.25rem;
      border-top: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--surface);
      font-size: 0.78rem;
      color: var(--text-muted);
    }

    #notes-save-btn {
      padding: 0.35rem 0.85rem;
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.82rem;
      font-weight: 600;
      font-family: inherit;
      transition: opacity 0.2s;
    }

    #notes-save-btn:hover {
      opacity: 0.85;
    }

    /* ── Pomodoro Timer ───────────────────────────────────────────────── */
    #pomodoro-fab {
      position: fixed;
      bottom: 6rem;
      right: 2rem;
      z-index: 1000;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      border: none;
      background: var(--surface2);
      border: 1.5px solid var(--border);
      color: var(--text);
      cursor: pointer;
      font-size: 1.4rem;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      transition: all 0.2s;
    }

    #pomodoro-fab:hover {
      transform: scale(1.1);
    }

    #pomodoro-widget {
      display: none;
      position: fixed;
      bottom: 11rem;
      right: 2rem;
      width: 230px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 1.25rem;
      z-index: 1002;
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.25);
      text-align: center;
    }

    #pomodoro-widget.open {
      display: block;
      animation: popIn 0.2s cubic-bezier(0.25, 0.8, 0.25, 1);
    }

    @keyframes popIn {
      from {
        transform: scale(0.85);
        opacity: 0;
      }

      to {
        transform: scale(1);
        opacity: 1;
      }
    }

    #pomo-label {
      font-size: 0.72rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
      margin-bottom: 0.5rem;
    }

    #pomo-time {
      font-size: 2.4rem;
      font-weight: 700;
      font-variant-numeric: tabular-nums;
      color: var(--text);
      line-height: 1.1;
      margin-bottom: 0.75rem;
      font-family: 'JetBrains Mono', monospace;
    }

    #pomo-time.pomo-break {
      color: var(--accent);
    }

    /* ── Pomodoro Timer (header-anchored) ───────────────────────────── */
    .pomo-wrap {
      position: relative;
    }

    #pomo-header-btn {
      position: relative;
    }

    #pomo-header-btn .pomo-tick {
      font-size: 0.55rem;
      font-family: 'JetBrains Mono', monospace;
      font-weight: 700;
      position: absolute;
      bottom: -1px;
      right: -1px;
      background: var(--accent2);
      color: white;
      border-radius: 3px;
      padding: 0 2px;
      display: none;
      line-height: 1.5;
    }

    #pomo-header-btn.running .pomo-tick {
      display: block;
    }

    #pomodoro-widget {
      display: none;
      position: absolute;
      top: calc(100% + 8px);
      right: 0;
      width: 240px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 1.25rem;
      z-index: 9000;
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.3);
      text-align: center;
    }

    #pomodoro-widget.open {
      display: block;
      animation: popIn 0.2s cubic-bezier(0.25, 0.8, 0.25, 1);
    }

    .pomo-ring {
      width: 80px;
      height: 80px;
      margin: 0 auto 0.75rem;
    }

    #pomo-progress-circle {
      transition: stroke-dashoffset 0.5s linear;
    }

    .pomo-btns {
      display: flex;
      gap: 0.5rem;
      justify-content: center;
      margin-bottom: 0.5rem;
    }

    .pomo-btn {
      padding: 0.4rem 0.9rem;
      border: 1px solid var(--border);
      border-radius: 6px;
      background: var(--surface2);
      color: var(--text);
      cursor: pointer;
      font-family: inherit;
      font-size: 0.82rem;
      font-weight: 600;
      transition: all 0.2s;
    }

    .pomo-btn:hover {
      background: var(--border);
    }

    .pomo-btn.primary {
      background: var(--accent2);
      color: white;
      border-color: var(--accent2);
    }

    .pomo-btn.primary:hover {
      opacity: 0.85;
    }

    #pomo-sessions {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-top: 0.25rem;
    }


    /* ── Study Streak ───────────────────────────────────────────────────── */
    #streak-badge {
      display: flex;
      align-items: center;
      gap: 0.3rem;
      padding: 0.25rem 0.55rem;
      border-radius: 20px;
      background: linear-gradient(135deg, #ff6b35, #f7c59f);
      color: white;
      font-size: 0.75rem;
      font-weight: 700;
      cursor: default;
      user-select: none;
      white-space: nowrap;
      box-shadow: 0 2px 8px rgba(255, 107, 53, 0.35);
    }

    /* Force header visibility when not in Zen mode */
    body:not(.zen-mode) .site-header {
      opacity: 1 !important;
      transform: none !important;
      pointer-events: auto !important;
      visibility: visible !important;
    }

    .dark #streak-badge {
      box-shadow: 0 2px 8px rgba(255, 107, 53, 0.5);
    }

    /* ── Copy Code Button ───────────────────────────────────────────────── */
    .code-wrap {
      position: relative;
    }

    .copy-btn {
      position: absolute;
      top: 0.45rem;
      right: 0.45rem;
      display: flex;
      align-items: center;
      gap: 0.3rem;
      padding: 0.22rem 0.55rem;
      border-radius: 5px;
      border: 1px solid var(--border);
      background: var(--surface2);
      color: var(--text-muted);
      font-family: inherit;
      font-size: 0.72rem;
      font-weight: 600;
      cursor: pointer;
      opacity: 0;
      transition: opacity 0.2s, background 0.15s, color 0.15s;
      z-index: 2;
    }

    .code-wrap:hover .copy-btn {
      opacity: 1;
    }

    .copy-btn:hover {
      background: var(--accent2);
      color: white;
      border-color: var(--accent2);
    }

    .copy-btn.copied {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
      opacity: 1;
    }

    /* ── Zen / Focus Mode ───────────────────────────────────────────────── */
    body.zen-mode .site-header {
      /* opacity: 0; */
      /* pointer-events: none; */
      /* transform: translateY(-100%); */
      transition: all 0.4s ease;
    }

    body.zen-mode:hover .site-header {
      opacity: 1;
      pointer-events: auto;
      transform: translateY(0);
    }

    body.zen-mode #nav {
      display: none;
    }

    body.zen-mode .right-sidebar {
      display: none;
    }

    body.zen-mode main {
      max-width: 860px;
      margin: 0 auto;
      padding: 2.5rem 2rem;
    }

    body.zen-mode .content-block {
      max-width: 100%;
    }

    #zen-btn.active {
      background: var(--accent2);
      color: white;
    }

    #zen-hint {
      position: fixed;
      bottom: 1.5rem;
      left: 50%;
      transform: translateX(-50%);
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 0.4rem 1rem;
      font-size: 0.75rem;
      color: var(--text-muted);
      z-index: 9999;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
      white-space: nowrap;
    }

    body.zen-mode #zen-hint {
      opacity: 1;
    }

    /* ── Text Highlighter ───────────────────────────────────────────────── */
    #highlight-toolbar {
      position: fixed;
      display: none;
      flex-direction: column;
      gap: 0.25rem;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 0.4rem 0.5rem;
      z-index: 9999;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
      align-items: center;
    }

    #highlight-toolbar.visible {
      display: flex;
    }

    #highlight-toolbar .hl-row {
      display: flex;
      gap: 0.3rem;
      align-items: center;
    }

    #highlight-toolbar .hl-label {
      font-size: 0.68rem;
      color: var(--text-muted);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .hl-swatch {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      border: 2px solid transparent;
      cursor: pointer;
      transition: transform 0.15s, border-color 0.15s;
    }

    .hl-swatch:hover {
      transform: scale(1.25);
      border-color: var(--border);
    }

    .hl-clear {
      font-size: 0.7rem;
      padding: 0.15rem 0.4rem;
      border: 1px solid var(--border);
      border-radius: 4px;
      background: var(--surface2);
      color: var(--text-muted);
      cursor: pointer;
      font-weight: 600;
    }

    .hl-clear:hover {
      background: #ef4444;
      color: white;
      border-color: #ef4444;
    }

    mark.hl-yellow {
      background: rgba(255, 220, 0, 0.45);
      color: inherit;
      border-radius: 2px;
      padding: 0 1px;
    }

    mark.hl-green {
      background: rgba(34, 197, 94, 0.35);
      color: inherit;
      border-radius: 2px;
      padding: 0 1px;
    }

    mark.hl-pink {
      background: rgba(244, 114, 182, 0.35);
      color: inherit;
      border-radius: 2px;
      padding: 0 1px;
    }

    mark.hl-blue {
      background: rgba(59, 130, 246, 0.35);
      color: inherit;
      border-radius: 2px;
      padding: 0 1px;
    }

    /* ── Mini Section TOC ───────────────────────────────────────────────── */
    #mini-toc {
      position: fixed;
      right: 1rem;
      top: 50%;
      transform: translateY(-50%);
      width: 200px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 0.75rem 0.6rem;
      z-index: 800;
      font-size: 0.76rem;
      display: none;
      box-shadow: 0 4px 18px rgba(0, 0, 0, 0.12);
      backdrop-filter: blur(4px);
    }

    .layout:not(.sidebar-hidden) #mini-toc {
      right: calc(var(--sidebar-w, 240px) + 1rem);
    }

    #mini-toc.visible {
      display: block;
    }

    #mini-toc-title {
      font-weight: 700;
      font-size: 0.68rem;
      text-transform: uppercase;
      letter-spacing: 0.07em;
      color: var(--text-muted);
      margin-bottom: 0.5rem;
      padding-bottom: 0.4rem;
      border-bottom: 1px solid var(--border);
    }

    #mini-toc ul {
      list-style: none;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      gap: 0.1rem;
    }

    #mini-toc ul li a {
      display: block;
      padding: 0.22rem 0.45rem;
      border-radius: 6px;
      color: var(--text-muted);
      text-decoration: none;
      transition: background 0.15s, color 0.15s;
      line-height: 1.35;
      border-left: 2px solid transparent;
    }

    #mini-toc ul li a:hover {
      background: var(--surface2);
      color: var(--text);
    }

    #mini-toc ul li a.toc-active {
      color: var(--accent2);
      border-left-color: var(--accent2);
      background: rgba(99, 102, 241, 0.08);
      font-weight: 600;
    }

    #mini-toc-toggle {
      position: fixed;
      right: 1rem;
      bottom: 5rem;
      z-index: 900;
      display: none;
    }

    #mini-toc-toggle.show {
      display: flex;
    }

    /* ── Export Notes CTA ───────────────────────────────────────────────── */
    #notes-export-btn {
      padding: 0.3rem 0.7rem;
      border: 1px solid var(--border);
      border-radius: 6px;
      background: var(--surface2);
      color: var(--text-muted);
      font-family: inherit;
      font-size: 0.78rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    #notes-export-btn:hover {
      background: var(--accent2);
      color: white;
      border-color: var(--accent2);
    }

    /* ── Flashcard Quiz Mode ────────────────────────────────────────────── */
    #quiz-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.7);
      z-index: 10001;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(6px);
    }

    #quiz-overlay.open {
      display: flex;
      animation: fadeOverlay 0.2s ease;
    }

    #quiz-box {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 20px;
      width: min(680px, 94vw);
      max-height: 88vh;
      overflow-y: auto;
      padding: 2rem;
      position: relative;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
    }

    #quiz-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1.5rem;
    }

    #quiz-header h2 {
      font-size: 1.1rem;
      font-weight: 700;
      margin: 0;
    }

    #quiz-close {
      background: none;
      border: none;
      font-size: 1.4rem;
      cursor: pointer;
      color: var(--text-muted);
      line-height: 1;
      padding: 0.2rem 0.4rem;
    }

    #quiz-progress-bar {
      height: 4px;
      background: var(--surface2);
      border-radius: 2px;
      margin-bottom: 1.5rem;
      overflow: hidden;
    }

    #quiz-progress-fill {
      height: 100%;
      background: var(--accent2);
      border-radius: 2px;
      transition: width 0.4s ease;
    }

    #quiz-question {
      font-size: 1.05rem;
      font-weight: 600;
      line-height: 1.55;
      margin-bottom: 1.2rem;
      color: var(--text);
    }

    .quiz-option {
      display: block;
      width: 100%;
      text-align: left;
      padding: 0.75rem 1rem;
      margin-bottom: 0.6rem;
      border-radius: 10px;
      border: 1.5px solid var(--border);
      background: var(--surface2);
      color: var(--text);
      font-family: inherit;
      font-size: 0.92rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .quiz-option:hover:not(:disabled) {
      border-color: var(--accent2);
      background: rgba(99, 102, 241, 0.08);
    }

    .quiz-option.correct {
      border-color: #22c55e;
      background: rgba(34, 197, 94, 0.15);
      color: #16a34a;
      font-weight: 600;
    }

    .quiz-option.wrong {
      border-color: #ef4444;
      background: rgba(239, 68, 68, 0.12);
      color: #dc2626;
    }

    #quiz-explanation {
      display: none;
      margin-top: 1rem;
      padding: 0.85rem 1rem;
      border-radius: 10px;
      background: var(--surface2);
      border-left: 3px solid var(--accent2);
      font-size: 0.88rem;
      line-height: 1.6;
      color: var(--text-muted);
    }

    #quiz-explanation.show {
      display: block;
    }

    #quiz-nav {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 1.25rem;
    }

    #quiz-score {
      font-size: 0.85rem;
      color: var(--text-muted);
      font-weight: 600;
    }

    #quiz-next {
      padding: 0.5rem 1.3rem;
      border-radius: 8px;
      border: none;
      background: var(--accent2);
      color: white;
      font-family: inherit;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      display: none;
      transition: opacity 0.2s;
    }

    #quiz-next:hover {
      opacity: 0.85;
    }

    #quiz-results {
      text-align: center;
      display: none;
    }

    #quiz-results .result-score {
      font-size: 3.5rem;
      font-weight: 800;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin: 1rem 0 0.5rem;
    }

    #quiz-results p {
      color: var(--text-muted);
      margin-bottom: 1.5rem;
    }

    #quiz-restart {
      padding: 0.6rem 1.6rem;
      border-radius: 8px;
      border: none;
      background: var(--accent2);
      color: white;
      font-family: inherit;
      font-size: 1rem;
      font-weight: 700;
      cursor: pointer;
    }

    /* ── Keyboard Shortcuts Panel ─────────────────────────────────────── */
    #shortcuts-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(4px);
      z-index: 10001;
      align-items: center;
      justify-content: center;
    }

    #shortcuts-overlay.open {
      display: flex;
    }

    #shortcuts-box {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 2rem;
      width: min(560px, 90vw);
      box-shadow: 0 32px 64px rgba(0, 0, 0, 0.3);
    }

    #shortcuts-box h2 {
      margin: 0 0 1.25rem;
      font-size: 1.1rem;
      border: none;
      padding: 0;
      color: var(--text);
    }

    .shortcut-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.5rem 1.5rem;
    }

    .shortcut-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.4rem 0;
      border-bottom: 1px solid var(--surface2);
    }

    .shortcut-row .sc-desc {
      font-size: 0.86rem;
      color: var(--text-muted);
    }

    .shortcut-row .sc-keys {
      display: flex;
      gap: 0.25rem;
    }

    .sc-key {
      display: inline-block;
      padding: 0.15em 0.5em;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 5px;
      font-size: 0.75rem;
      font-family: 'JetBrains Mono', monospace;
      color: var(--text);
      border-bottom-width: 2px;
    }

    #shortcuts-close-hint {
      margin-top: 1.25rem;
      text-align: center;
      font-size: 0.78rem;
      color: var(--text-muted);
    }

    /* ── Font Size Controls ───────────────────────────────────────────── */
    .font-size-controls {
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }

    .font-size-controls button {
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.85rem;
      font-weight: 700;
      color: var(--text-muted);
      transition: all 0.2s;
      font-family: inherit;
    }

    .font-size-controls button:hover {
      background: var(--border);
      color: var(--text);
    }

    /* ── Bookmark Button on code blocks ──────────────────────────────── */
    .bookmark-section-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      padding: 0.3rem 0.7rem;
      margin-left: 0.5rem;
      background: transparent;
      border: 1px solid var(--border);
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.78rem;
      color: var(--text-muted);
      font-family: inherit;
      transition: all 0.2s;
    }

    .bookmark-section-btn:hover {
      background: var(--surface2);
      color: var(--text);
    }

    .bookmark-section-btn.bookmarked {
      color: #f0883e;
      border-color: #f0883e;
      background: rgba(240, 136, 62, 0.08);
    }

    #bookmarks-list {
      margin-top: 0.5rem;
    }

    #bookmarks-list li {
      background: transparent;
      border: none;
      padding: 0.25rem 0.5rem;
    }

    #bookmarks-list a {
      color: var(--accent2);
      font-size: 0.82rem;
    }

    .bookmarks-empty {
      font-size: 0.8rem;
      color: var(--text-muted);
      font-style: italic;
      padding: 0.5rem 0.5rem;
    }

    /* ── Toast Notifications ─────────────────────────────────────────── */
    #toast-container {
      position: fixed;
      bottom: 2rem;
      left: 50%;
      transform: translateX(-50%);
      z-index: 20000;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      pointer-events: none;
    }

    .toast {
      padding: 0.6rem 1.2rem;
      background: var(--text);
      color: var(--bg);
      border-radius: 8px;
      font-size: 0.85rem;
      font-weight: 500;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
      animation: toastIn 0.2s ease, toastOut 0.3s ease 2s forwards;
      white-space: nowrap;
    }

    @keyframes toastIn {
      from {
        transform: translateY(12px);
        opacity: 0;
      }

      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    @keyframes toastOut {
      from {
        opacity: 1;
      }

      to {
        opacity: 0;
        transform: translateY(-8px);
      }
    }

    /* ── Nav Note Indicator ──────────────────────────────────────────── */
    .nav-note-dot {
      display: inline-block;
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--accent2);
      margin-left: 0.4rem;
      vertical-align: middle;
      flex-shrink: 0;
    }

    /* ── Section Action Bar ──────────────────────────────────────────── */
    .section-action-bar {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 1.25rem;
      padding: 0.6rem 0.9rem;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      flex-wrap: wrap;
    }

    .section-action-bar .sab-label {
      font-size: 0.75rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.06em;
      font-weight: 700;
    }

    .sab-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      padding: 0.28rem 0.65rem;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 5px;
      cursor: pointer;
      font-size: 0.78rem;
      color: var(--text-muted);
      font-family: inherit;
      transition: all 0.15s;
      white-space: nowrap;
    }

    .sab-btn:hover {
      background: var(--border);
      color: var(--text);
    }

    .sab-btn.active {
      color: var(--accent);
      border-color: var(--accent);
      background: rgba(26, 127, 55, 0.08);
    }

    .reading-time {
      margin-left: auto;
      font-size: 0.75rem;
      color: var(--text-muted);
      white-space: nowrap;
    }
  </style>
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "LearningResource",
    "name": "CKA Exam Study Guide | Certified Kubernetes Administrator Preparation",
    "description": "Free study guide for the Certified Kubernetes Administrator (CKA) exam. Covers cluster architecture, scheduling, workloads, networking, storage, security, and troubleshooting with commands, YAML examples and diagrams.",
    "learningResourceType": "Study Guide",
    "educationalLevel": "Professional",
    "teaches": ["Kubernetes", "Container orchestration", "kubectl", "CKA certification", "Cluster administration"],
    "about": [
      { "@type": "Thing", "name": "Certified Kubernetes Administrator" },
      { "@type": "Thing", "name": "Kubernetes" }
    ]
  }
  </script>
</head>

<body>
  <header class="site-header" style="z-index: 2000;">
    <div style="display: flex; align-items: center; gap: 0.5rem; flex: 1; min-width: 0;">
      <button type="button" class="icon-btn" id="toggle-left" title="Toggle Navigation">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="9" y1="3" x2="9" y2="21"></line>
        </svg>
      </button>
      <h1 style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">CKA Study Guide</h1>
      <span class="badge">CKA</span>
    </div>

    <div class="header-controls">
      <!-- Challenge Mode Toggle -->
      <div class="challenge-toggle-wrapper" title="Hide answers to test yourself">
        <span class="challenge-label" style="display: none;">Challenge</span>
        <label class="toggle-switch">
          <input type="checkbox" id="challenge-toggle">
          <span class="slider"></span>
        </label>
      </div>

      <!-- Font Size Controls -->
      <div class="font-size-controls" title="Font size">
        <button id="font-decrease" title="Decrease font size">A-</button>
        <button id="font-increase" title="Increase font size">A+</button>
      </div>

      <!-- Search Button -->
      <button type="button" class="icon-btn" id="search-btn" title="Search (Ctrl+K)">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round" stroke-linejoin="round">
          <circle cx="11" cy="11" r="8"></circle>
          <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        </svg>
      </button>

      <!-- Notes Button -->
      <button type="button" class="icon-btn" id="notes-btn" title="Section Notes (N)">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round" stroke-linejoin="round">
          <path d="M14 2H6a2 2 0 0 0-2 2v16c0 1.1.9 2 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="16" y1="13" x2="8" y2="13"></line>
          <line x1="16" y1="17" x2="8" y2="17"></line>
          <polyline points="10 9 9 9 8 9"></polyline>
        </svg>
      </button>

      <!-- Dark Mode -->
      <button type="button" class="icon-btn" id="dark-mode-btn" title="Toggle Dark Mode (D)">
        <svg id="dm-icon-moon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
          stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
        </svg>
        <svg id="dm-icon-sun" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
          stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:none">
          <circle cx="12" cy="12" r="5"></circle>
          <line x1="12" y1="1" x2="12" y2="3"></line>
          <line x1="12" y1="21" x2="12" y2="23"></line>
          <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
          <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
          <line x1="1" y1="12" x2="3" y2="12"></line>
          <line x1="21" y1="12" x2="23" y2="12"></line>
          <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
          <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
        </svg>
      </button>

      <!-- Keyboard Shortcuts -->
      <button type="button" class="icon-btn" id="shortcuts-btn" title="Keyboard Shortcuts (?)">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round" stroke-linejoin="round">
          <rect x="2" y="6" width="20" height="12" rx="2"></rect>
          <path d="M6 10h.01M10 10h.01M14 10h.01M18 10h.01M8 14h8"></path>
        </svg>
      </button>

      <!-- Pomodoro Timer -->
      <div class="pomo-wrap">
        <button type="button" class="icon-btn" id="pomo-header-btn" title="Pomodoro Timer (T)">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="13" r="8"></circle>
            <path d="M12 9v4l2 2"></path>
            <path d="M5 3L2 6"></path>
            <path d="M22 6l-3-3"></path>
          </svg>
          <span class="pomo-tick" id="pomo-header-tick">25:00</span>
        </button>
        <div id="pomodoro-widget">
          <div id="pomo-label">🎯 Focus Session</div>
          <svg class="pomo-ring" viewBox="0 0 80 80">
            <circle cx="40" cy="40" r="34" fill="none" stroke="var(--surface2)" stroke-width="6" />
            <circle id="pomo-progress-circle" cx="40" cy="40" r="34" fill="none" stroke="var(--accent2)"
              stroke-width="6" stroke-linecap="round" stroke-dasharray="213.6" stroke-dashoffset="0"
              transform="rotate(-90 40 40)" />
          </svg>
          <div id="pomo-time">25:00</div>
          <div class="pomo-btns">
            <button class="pomo-btn primary" id="pomo-start">Start</button>
            <button class="pomo-btn" id="pomo-reset">Reset</button>
          </div>
          <div id="pomo-sessions">Sessions today: <strong id="pomo-session-count">0</strong></div>
        </div>
      </div>


      <!-- Study Streak -->
      <div id="streak-badge" title="Study streak — days in a row studied">🔥 <span id="streak-count">1</span> day streak
      </div>

      <!-- Zen Mode -->
      <button type="button" class="icon-btn" id="zen-btn" title="Zen / Focus Mode (Z)">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"></circle>
          <path d="M8 12a4 4 0 0 1 8 0"></path>
          <line x1="12" y1="8" x2="12" y2="8.01"></line>
        </svg>
      </button>

      <!-- Quiz / Flashcards -->
      <button type="button" class="icon-btn" id="quiz-btn" title="CKA Quiz Mode (Q)">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round" stroke-linejoin="round">
          <path d="M9 11l3 3L22 4"></path>
          <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
        </svg>
      </button>

      <button type="button" class="icon-btn" id="toggle-right" title="Toggle Sidebar">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="15" y1="3" x2="15" y2="21"></line>
        </svg>
      </button>
      <button type="button" class="nav-toggle" aria-label="Open menu" id="nav-toggle">☰</button>
    </div>
  </header>
  <div class="layout">
    <nav id="nav" aria-label="Section navigation">
      <div class="nav-header">
        <span class="nav-section">CKA Preparation</span>
        <button type="button" class="nav-close" aria-label="Close menu" id="nav-close">×</button>
      </div>

      <a href="#section-01">01 Introduction</a>
      <a href="#section-02">02 Core Concepts</a>
      <a href="#section-03">03 Scheduling</a>
      <a href="#section-04">04 Logging & Monitoring</a>
      <a href="#section-05">05 Application Lifecycle</a>
      <a href="#section-06">06 Cluster Maintenance</a>
      <a href="#section-07">07 Security</a>
      <a href="#section-08">08 Storage</a>
      <a href="#section-09">09 Networking</a>
      <a href="#section-10">10 Design & Install</a>
      <a href="#section-11">11 kubeadm</a>
      <a href="#section-12">12 Troubleshooting</a>

    </nav>
    <main>
      <header id="intro">
        <h1 class="page-title">Certified Kubernetes Administrator (CKA)</h1>
        <p class="subtitle">Complete reference guide for the CKA exam. Use the navigation to jump between topics.</p>
      </header>

      <!-- 01 Introduction -->
      <h2 id="section-01">01 — Introduction</h2>
      <h3>Course focus</h3>
      <p>This material focuses on the <strong>administration</strong> part of Kubernetes, aligned with the CKA exam.</p>
      <h4>Pre-requisites</h4>
      <ul>
        <li>Docker</li>
        <li>Basics of Kubernetes (Pods, Deployments, Services)</li>
        <li>YAML</li>
        <li>Basic lab environment (e.g. VirtualBox)</li>
      </ul>
      <h4>Exam areas (weighted)</h4>
      <ul>
        <li><strong>Cluster Architecture, Installation & Validation</strong> (25%): Design, install, configure,
          validate, manage HA, etcd, upgrade.</li>
        <li><strong>Workloads & Scheduling</strong> (15%): Deployments, scaling, DaemonSets, resource limits, scheduling
          (manual, node selector, affinity, taints/tolerations), static pods.</li>
        <li><strong>Services & Networking</strong> (20%): Networking model, Services (ClusterIP, NodePort,
          LoadBalancer), DNS, CNI, Ingress.</li>
        <li><strong>Storage</strong> (10%): PV, PVC, StorageClass, volume mounts.</li>
        <li><strong>Troubleshooting</strong> (30%): Application, control plane, worker nodes, network.</li>
        <li>Plus: Security (RBAC, TLS, kubeconfig, NetworkPolicies), Logging/Monitoring, Application Lifecycle
          (rollouts, ConfigMaps, Secrets).</li>
        <li><strong>2025 curriculum additions:</strong> Helm and Kustomize for cluster components; Gateway API (with
          Ingress); CRDs and operators; extension interfaces (CNI, CSI, CRI); CoreDNS; workload autoscaling (HPA);
          PodDisruptionBudgets. See sections 05, 06, 09, and 13.</li>
      </ul>
      <h3>Certification</h3>
      <p>Certified Kubernetes Administrator (CKA): exam curriculum, candidate handbook, and exam tips are published by
        the Linux Foundation / CNCF. Use code <code>KUBERNETES15</code> when registering for CKA or CKAD for a 15%
        discount.</p>

      <!-- 02 Core Concepts -->
      <h2 id="section-02">02 — Core Concepts</h2>

      <h3>Cluster Architecture</h3>
      <p>A Kubernetes cluster consists of a <strong>Control Plane</strong> (the brain) and <strong>Worker Nodes</strong>
        (the muscle).</p>
      <ul>
        <li><strong>Control Plane:</strong> Manages the state of the cluster. It makes global decisions (scheduling),
          detects and responds to cluster events (starting new pods), and stores the cluster configuration.</li>
        <li><strong>Worker Node:</strong> A machine (VM or physical) that runs containerized applications. It hosts the
          Pods and communicates with the control plane via the kubelet.</li>
      </ul>

      <h3>Control Plane Components</h3>

      <h4>kube-apiserver</h4>
      <p>The <strong>front-end</strong> of the Kubernetes control plane. It exposes the Kubernetes API (REST). It is the
        <strong>only</strong> component that communicates directly with <strong>etcd</strong>.
        <br><em>Key function:</em> Authenticates, validates, and processes all REST requests (internal & external). It
        is designed to scale horizontally.
      </p>

      <h4>etcd</h4>
      <p>A consistent and highly-available <strong>key-value store</strong> used as Kubernetes' backing store for all
        cluster data.
        <br><em>Pro Tip:</em> It uses the <strong>RAFT algorithm</strong> for consensus. It is the "single source of
        truth" — if data is in etcd, it exists; otherwise, it does not.
      </p>

      <h4>kube-scheduler</h4>
      <p>Watches for newly created Pods with no assigned node and selects a node for them to run on.
        <br><em>Process:</em>
        <br>1. <strong>Filtering:</strong> Ruling out nodes that don't meet requirements (CPU/RAM, Taints, Affinity).
        <br>2. <strong>Scoring:</strong> Ranking the remaining nodes to find the best fit.
      </p>

      <h4>kube-controller-manager</h4>
      <p>A daemon that runs controller processes. Logically, each controller is a separate process, but they are
        compiled into a single binary.
        <br><em>Responsibility:</em> <strong>Reconciliation Loop</strong>. It continuously watches the <em>current
          state</em> and compares it to the <em>desired state</em>, making changes to match them.
        <br><em>Examples:</em> Node Controller (notices down nodes), Replication Controller (maintains pod count),
        Endpoints Controller.
      </p>

      <h4>cloud-controller-manager</h4>
      <p>Embeds cloud-specific control logic. It lets you link your cluster into your cloud provider's API (e.g., AWS,
        Azure, GCP). It handles things like Node instances (cloud VMs), LoadBalancers, and Routes.</p>

      <h3>Node Components</h3>

      <h4>kubelet</h4>
      <p>An agent that runs on each node. It registers the node with the API server and ensures that containers are
        running in a Pod.
        <br><em>Mechanism:</em> It takes a set of PodSpecs (from API server or static files) and ensures the containers
        described are running and healthy. It does <strong>not</strong> manage containers not created by Kubernetes.
      </p>

      <h4>kube-proxy</h4>
      <p>A network proxy running on each node. It maintains network rules that allow network communication to your Pods
        from inside or outside the cluster.
        <br><em>Implementation:</em> Commonly uses <strong>iptables</strong> or <strong>IPVS</strong> to forward traffic
        to backend Pods (Service abstraction).
      </p>

      <h4>Container Runtime</h4>
      <p>The software responsible for running containers. Kubernetes supports any runtime that adheres to the
        <strong>Container Runtime Interface (CRI)</strong>.
      </p>

      <h3>Docker vs ContainerD (CRI)</h3>
      <p><strong>Fact:</strong> Kubernetes removed the "dockershim" in v1.24. This means Kubernetes can no longer use
        the Docker Engine directly as a runtime. It now uses <strong>containerd</strong> or <strong>CRI-O</strong> via
        the CRI.</p>
      <ul>
        <li><strong>containerd:</strong> An industry-standard container runtime. It was part of Docker but is now
          independent.</li>
        <li><strong>crictl:</strong> A CLI tool for CRI-compatible container runtimes. Used mainly for debugging on the
          node.</li>
        <li><strong>nerdctl:</strong> A Docker-compatible CLI for containerd (supports <code>docker run</code> style
          commands).</li>
      </ul>
      <div class="snippet-label">Useful crictl commands</div>
      <pre><code>crictl ps -a                        # list all containers
crictl images                       # list images
crictl pods                         # list pods (sandbox containers)
crictl logs &lt;container-id&gt;          # view logs directly from runtime
crictl inspect &lt;container-id&gt;       # deep dive into container status</code></pre>

      <figure class="diagram">
        <svg viewBox="0 0 700 320" preserveAspectRatio="xMidYMid meet" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <marker id="arrow" markerWidth="8" markerHeight="8" refX="6" refY="4" orient="auto">
              <path d="M0 0 L8 4 L0 8 Z" fill="#0969da" />
            </marker>
          </defs>
          <!-- Title -->
          <text x="350" y="28" fill="#656d76" font-size="16" font-weight="600" text-anchor="middle">KUBERNETES
            ARCHITECTURE</text>

          <!-- Control Plane -->
          <rect x="40" y="50" width="620" height="110" rx="8" fill="#f6f8fa" stroke="#d0d7de" stroke-width="1.5" />
          <text x="350" y="75" fill="#1a7f37" font-size="15" font-weight="700" text-anchor="middle">CONTROL
            PLANE</text>

          <!-- Components -->
          <rect x="70" y="90" width="100" height="50" rx="6" fill="#ddf4ff" stroke="#0969da" stroke-width="1.5" />
          <text x="120" y="120" fill="#1f2328" font-size="13" font-weight="600" text-anchor="middle">API Server</text>

          <rect x="200" y="90" width="80" height="50" rx="6" fill="#fff8c5" stroke="#9a6700" stroke-width="1.5" />
          <text x="240" y="120" fill="#1f2328" font-size="13" font-weight="600" text-anchor="middle">etcd</text>

          <rect x="310" y="90" width="90" height="50" rx="6" fill="#eaeef2" stroke="#d0d7de" />
          <text x="355" y="120" fill="#1f2328" font-size="13" font-weight="600" text-anchor="middle">Scheduler</text>

          <rect x="430" y="90" width="100" height="50" rx="6" fill="#eaeef2" stroke="#d0d7de" />
          <text x="480" y="115" fill="#1f2328" font-size="12" font-weight="600" text-anchor="middle">Controller</text>
          <text x="480" y="130" fill="#1f2328" font-size="12" font-weight="600" text-anchor="middle">Manager</text>

          <rect x="560" y="90" width="70" height="50" rx="6" fill="#eaeef2" stroke="#d0d7de" />
          <text x="595" y="115" fill="#1f2328" font-size="11" font-weight="600" text-anchor="middle">Cloud</text>
          <text x="595" y="130" fill="#1f2328" font-size="11" font-weight="600" text-anchor="middle">CM</text>

          <!-- Interaction Line (Only API talks to etcd) -->
          <line x1="170" y1="115" x2="200" y2="115" stroke="#0969da" stroke-width="2" marker-end="url(#arrow)" />

          <!-- Worker Nodes -->
          <rect x="40" y="190" width="280" height="100" rx="8" fill="#f6f8fa" stroke="#d0d7de" stroke-width="1.5" />
          <text x="180" y="215" fill="#1a7f37" font-size="14" font-weight="700" text-anchor="middle">WORKER NODE
            1</text>
          <rect x="60" y="230" width="70" height="40" rx="4" fill="#eaeef2" stroke="#d0d7de" />
          <text x="95" y="255" fill="#1f2328" font-size="12" font-weight="600" text-anchor="middle">Kubelet</text>
          <rect x="145" y="230" width="70" height="40" rx="4" fill="#eaeef2" stroke="#d0d7de" />
          <text x="180" y="255" fill="#1f2328" font-size="12" font-weight="600" text-anchor="middle">Proxy</text>
          <rect x="230" y="230" width="70" height="40" rx="4" fill="#eaeef2" stroke="#d0d7de" />
          <text x="265" y="255" fill="#1f2328" font-size="12" font-weight="600" text-anchor="middle">Pods</text>

          <rect x="340" y="190" width="280" height="100" rx="8" fill="#f6f8fa" stroke="#d0d7de" stroke-width="1.5" />
          <text x="480" y="215" fill="#1a7f37" font-size="14" font-weight="700" text-anchor="middle">WORKER NODE
            2</text>
          <rect x="360" y="230" width="70" height="40" rx="4" fill="#eaeef2" stroke="#d0d7de" />
          <text x="395" y="255" fill="#1f2328" font-size="12" font-weight="600" text-anchor="middle">Kubelet</text>

          <!-- Arrows -->
          <line x1="120" y1="140" x2="120" y2="170" stroke="#0969da" stroke-width="1.5" />
          <line x1="120" y1="170" x2="95" y2="230" stroke="#0969da" stroke-width="1.5" marker-end="url(#arrow)" />
          <line x1="120" y1="170" x2="395" y2="230" stroke="#0969da" stroke-width="1.5" marker-end="url(#arrow)" />
        </svg>
        <figcaption>Architecture: The API Server is the central hub. Kubelet manages the node. Kube-proxy manages
          networking.</figcaption>
      </figure>

      <h3>Workloads</h3>

      <h4>Pods</h4>
      <p>The smallest deployable object in Kubernetes. A Pod determines how to run a container.
        <br><em>Key Concept:</em> Containers in a pod share the <strong>same network namespace</strong> (IP address),
        storage volumes, and process namespace (sometimes).
        <br><em>Life:</em> Pods are <strong>ephemeral</strong>. They are born, they run, and they die. They are not
        resurrected; a new one is created to replace them.
      </p>

      <div class="snippet-label">Run a pod (imperative)</div>
      <pre><code>kubectl run nginx --image nginx
kubectl get pods -wide</code></pre>

      <h4>ReplicaSet</h4>
      <p>Ensures a specified number of pod replicas are running at any given time.
        <br><em>Selector:</em> Uses <code>selector</code> to match Pod labels. If a pod dies, RS starts a new one.
      </p>

      <h4>Deployments</h4>
      <p>The standard way to manage stateless applications. A Deployment manages ReplicaSets and provides declarative
        updates (Rolling Updates, Rollbacks).
        <br><em>Capabilities:</em> Scaling, pausing/resuming updates, rolling back to previous revisions.
      </p>

      <div class="snippet-label">Create Deployment</div>
      <pre><code>kubectl create deployment webapp --image=nginx --replicas=3
kubectl get deploy,rs,po</code></pre>

      <p>Scale: <code>kubectl scale --replicas=5 deployment/webapp</code> or edit via
        <code>kubectl edit deploy webapp</code>.
      </p>

      <h3>Imperative commands — exam speed reference</h3>
      <p>In the CKA exam, speed matters. Use imperative commands with <code>--dry-run=client -o yaml</code> to
        generate
        YAML quickly, then edit as needed.</p>
      <div class="snippet-label">Generate YAML templates fast</div>
      <pre><code># Pod
kubectl run nginx --image=nginx --dry-run=client -o yaml > pod.yaml

# Deployment
kubectl create deployment nginx --image=nginx --replicas=3 --dry-run=client -o yaml > deploy.yaml

# Service (ClusterIP)
kubectl expose pod redis --port=6379 --name redis-service --dry-run=client -o yaml

# Service (NodePort)
kubectl create service nodeport nginx --tcp=80:80 --node-port=30080 --dry-run=client -o yaml

# Job
kubectl create job my-job --image=busybox --dry-run=client -o yaml -- echo hello

# CronJob
kubectl create cronjob my-cron --image=busybox --schedule="*/5 * * * *" --dry-run=client -o yaml -- echo hi

# ConfigMap
kubectl create configmap app-config --from-literal=KEY=VALUE --dry-run=client -o yaml

# Secret
kubectl create secret generic app-secret --from-literal=PASSWORD=pass --dry-run=client -o yaml

# ServiceAccount
kubectl create serviceaccount my-sa --dry-run=client -o yaml

# Namespace
kubectl create namespace dev

# Role & RoleBinding
kubectl create role pod-reader --verb=get,list --resource=pods -n dev
kubectl create rolebinding dev-read --role=pod-reader --user=jane -n dev

# ClusterRole & ClusterRoleBinding
kubectl create clusterrole node-reader --verb=get,list --resource=nodes
kubectl create clusterrolebinding node-read --clusterrole=node-reader --user=jane

# Ingress
kubectl create ingress my-ingress --rule="host/path=svc:80" --dry-run=client -o yaml</code></pre>
      <div class="snippet-label">Quick edit and apply pattern</div>
      <pre><code># Generate → Edit → Apply
kubectl run mypod --image=nginx --dry-run=client -o yaml > mypod.yaml
vi mypod.yaml   # add labels, resources, volumes, etc.
kubectl apply -f mypod.yaml

# Edit running resource
kubectl edit deployment nginx

# Replace (force update)
kubectl replace --force -f pod.yaml</code></pre>

      <h3>Namespaces</h3>
      <p>Objects live in a namespace (default is <code>default</code>). List pods in a namespace:
        <code>kubectl get pods --namespace=kube-system</code> or <code>-n kube-system</code>. Create in a namespace:
        <code>kubectl create -f pod-definition.yaml --namespace=dev</code>. Add <code>namespace: dev</code> under
        <code>metadata</code> in the YAML to fix the namespace.
      </p>
      <div class="snippet-label">Create namespace</div>
      <pre><code>apiVersion: v1
kind: Namespace
metadata:
  name: dev</code></pre>
      <pre><code>kubectl create -f namespace-dev.yaml
# or
kubectl create namespace dev</code></pre>
      <p>Switch default namespace:
        <code>kubectl config set-context $(kubectl config current-context) --namespace=dev</code>. All namespaces:
        <code>kubectl get pods --all-namespaces</code>.
      </p>
      <div class="snippet-label">ResourceQuota (limit resources in a namespace)</div>
      <pre><code>apiVersion: v1
kind: ResourceQuota
metadata:
  name: compute-quota
  namespace: dev
spec:
  hard:
    pods: "10"
    requests.cpu: "4"
    requests.memory: 5Gi
    limits.cpu: "10"
    limits.memory: 10Gi</code></pre>
      <pre><code>kubectl create -f compute-quota.yaml</code></pre>

      <h3>Services</h3>
      <p>Three types: <strong>NodePort</strong> (expose on node port), <strong>ClusterIP</strong> (virtual IP inside
        cluster), <strong>LoadBalancer</strong> (cloud load balancer).</p>
      <div class="snippet-label">NodePort service</div>
      <pre><code>apiVersion: v1
kind: Service
metadata:
  name: myapp-service
spec:
  type: NodePort
  ports:
  - targetPort: 80
    port: 80
    nodePort: 30008
  selector:
    app: myapp
    type: front-end</code></pre>
      <div class="snippet-label">ClusterIP service</div>
      <pre><code>apiVersion: v1
kind: Service
metadata:
  name: back-end
spec:
  type: ClusterIP
  ports:
  - targetPort: 80
    port: 80
  selector:
    app: myapp
    type: back-end</code></pre>
      <pre><code>kubectl create -f service-definition.yaml
kubectl get services
curl http://&lt;node-ip&gt;:30008   # for NodePort</code></pre>
      <figure class="diagram">
        <svg viewBox="0 0 540 160" preserveAspectRatio="xMidYMid meet" xmlns="http://www.w3.org/2000/svg">
          <rect x="20" y="20" width="155" height="120" rx="8" fill="#eaeef2" stroke="#d0d7de" />
          <text x="97" y="46" fill="#1a7f37" font-size="16" font-weight="600" text-anchor="middle">NodePort</text>
          <text x="97" y="66" fill="#656d76" font-size="13" text-anchor="middle">Node:30008 → :80</text>
          <text x="97" y="82" fill="#656d76" font-size="13" text-anchor="middle">→ Pod targetPort</text>
          <text x="97" y="106" fill="#1f2328" font-size="13" text-anchor="middle">External via</text>
          <text x="97" y="120" fill="#1f2328" font-size="13" text-anchor="middle">any node + nodePort</text>
          <rect x="192" y="20" width="155" height="120" rx="8" fill="#eaeef2" stroke="#d0d7de" />
          <text x="269" y="46" fill="#1a7f37" font-size="16" font-weight="600" text-anchor="middle">ClusterIP</text>
          <text x="269" y="66" fill="#656d76" font-size="13" text-anchor="middle">Virtual IP 10.96.x.x</text>
          <text x="269" y="82" fill="#656d76" font-size="13" text-anchor="middle">Cluster-internal</text>
          <text x="269" y="106" fill="#1f2328" font-size="13" text-anchor="middle">Frontend → Backend</text>
          <text x="269" y="120" fill="#1f2328" font-size="12" text-anchor="middle">svc.ns.svc.cluster.local</text>
          <rect x="364" y="20" width="155" height="120" rx="8" fill="#eaeef2" stroke="#d0d7de" />
          <text x="441" y="46" fill="#1a7f37" font-size="16" font-weight="600" text-anchor="middle">LoadBalancer</text>
          <text x="441" y="66" fill="#656d76" font-size="13" text-anchor="middle">Cloud LB → NodePort</text>
          <text x="441" y="82" fill="#656d76" font-size="13" text-anchor="middle">→ Service → Pods</text>
          <text x="441" y="106" fill="#1f2328" font-size="13" text-anchor="middle">External IP</text>
          <text x="441" y="120" fill="#1f2328" font-size="13" text-anchor="middle">(AWS/GCP/Azure)</text>
        </svg>
        <figcaption>Service types: NodePort (expose on node port), ClusterIP (internal VIP), LoadBalancer (cloud LB).
        </figcaption>
      </figure>

      <!-- 03 Scheduling -->
      <h2 id="section-03">03 &mdash; Scheduling</h2>
      <h3>How Scheduling Works</h3>
      <p>The kube-scheduler watches for newly created pods with no <code>nodeName</code>. It selects a node through two
        phases:</p>
      <ul>
        <li><strong>Filtering:</strong> Eliminates nodes that cannot satisfy the pod requirements (insufficient
          CPU/memory, taint mismatch, affinity rules).</li>
        <li><strong>Scoring:</strong> Ranks remaining nodes using plugins (LeastAllocated, ImageLocality, etc.) and
          picks the highest score.</li>
      </ul>
      <p>It then creates a <strong>Binding</strong> object setting <code>spec.nodeName</code> on the pod. The kubelet on
        that node pulls the image and starts the containers.</p>
      <figure class="diagram">
        <svg viewBox="0 0 560 110" preserveAspectRatio="xMidYMid meet" xmlns="http://www.w3.org/2000/svg">
          <rect x="10" y="20" width="110" height="56" rx="6" fill="#eaeef2" stroke="#0969da" />
          <text x="65" y="46" fill="#1f2328" font-size="13" text-anchor="middle">Pod created</text>
          <text x="65" y="62" fill="#656d76" font-size="11" text-anchor="middle">(nodeName empty)</text>
          <path d="M120 48 L148 48" stroke="#1a7f37" stroke-width="2" />
          <rect x="148" y="20" width="120" height="56" rx="6" fill="#eaeef2" stroke="#0969da" />
          <text x="208" y="44" fill="#1f2328" font-size="13" text-anchor="middle">Scheduler</text>
          <text x="208" y="60" fill="#656d76" font-size="11" text-anchor="middle">Filter &rarr; Score</text>
          <path d="M268 48 L296 48" stroke="#1a7f37" stroke-width="2" />
          <rect x="296" y="20" width="120" height="56" rx="6" fill="#eaeef2" stroke="#0969da" />
          <text x="356" y="44" fill="#1f2328" font-size="13" text-anchor="middle">Binding obj</text>
          <text x="356" y="60" fill="#656d76" font-size="11" text-anchor="middle">nodeName = node01</text>
          <path d="M416 48 L444 48" stroke="#1a7f37" stroke-width="2" />
          <rect x="444" y="20" width="100" height="56" rx="6" fill="#eaeef2" stroke="#1a7f37" />
          <text x="494" y="44" fill="#1f2328" font-size="13" text-anchor="middle">Kubelet</text>
          <text x="494" y="60" fill="#656d76" font-size="11" text-anchor="middle">runs pod</text>
        </svg>
        <figcaption>Scheduling flow: Filter + Score &rarr; Binding object &rarr; kubelet starts the pod.</figcaption>
      </figure>

      <h3>Manual Scheduling (nodeName)</h3>
      <p>Pin a pod to a specific node by setting <code>spec.nodeName</code>. This bypasses the scheduler entirely. Only
        works at <em>creation time</em>. To reschedule an existing pod, delete and recreate it.</p>
      <div class="snippet-label">Pod with hardcoded nodeName</div>
      <pre><code>apiVersion: v1
kind: Pod
metadata:
  name: nginx
spec:
  containers:
  - name: nginx
    image: nginx
    ports:
    - containerPort: 80
  nodeName: node02        # bypasses scheduler</code></pre>
      <div class="snippet-label">Binding object (alternative &mdash; POST to API)</div>
      <pre><code>apiVersion: v1
kind: Binding
metadata:
  name: nginx
target:
  apiVersion: v1
  kind: Node
  name: node02</code></pre>

      <h3>Labels and Selectors</h3>
      <p>Labels are key-value pairs on Kubernetes objects. Selectors filter objects by label. ReplicaSets, Services and
        Deployments use <code>selector.matchLabels</code> to target pods.</p>
      <div class="snippet-label">Pod with labels</div>
      <pre><code>apiVersion: v1
kind: Pod
metadata:
  name: simple-webapp
  labels:
    app: App1
    env: production
    tier: frontend
spec:
  containers:
  - name: simple-webapp
    image: simple-webapp
    ports:
    - containerPort: 8080</code></pre>
      <pre><code># Filter by single label
kubectl get pods --selector app=App1

# Filter by multiple labels (AND logic)
kubectl get pods --selector app=App1,env=production

# All resource types matching a label
kubectl get all --selector env=production</code></pre>
      <p><strong>Annotations</strong> (under <code>metadata.annotations</code>) store non-identifying info like build
        version &mdash; NOT used for selection.</p>

      <h3>Taints and Tolerations</h3>
      <p>Taints on <strong>nodes</strong> repel pods. Tolerations on <strong>pods</strong> allow them onto tainted
        nodes. <em>Tolerations do NOT guarantee placement &mdash; use Node Affinity for that.</em></p>
      <ul>
        <li><strong>NoSchedule:</strong> New pods without matching toleration will not be scheduled here.</li>
        <li><strong>PreferNoSchedule:</strong> Scheduler avoids placing pods here but it&rsquo;s not guaranteed.</li>
        <li><strong>NoExecute:</strong> New pods blocked AND existing pods evicted if they lack the toleration.</li>
      </ul>
      <pre><code># Apply a taint to a node
kubectl taint nodes node01 app=blue:NoSchedule

# Check taints on a node
kubectl describe node node01 | grep -i taint

# Remove a taint (trailing minus removes it)
kubectl taint nodes node01 app=blue:NoSchedule-</code></pre>
      <div class="snippet-label">Pod with toleration</div>
      <pre><code>apiVersion: v1
kind: Pod
metadata:
  name: myapp-pod
spec:
  containers:
  - name: nginx-container
    image: nginx
  tolerations:
  - key: "app"
    operator: "Equal"     # use "Exists" to match any value for the key
    value: "blue"
    effect: "NoSchedule"</code></pre>
      <p><strong>Control-plane taint:</strong> Master nodes automatically get
        <code>node-role.kubernetes.io/control-plane:NoSchedule</code> so workload pods are never placed there.
      </p>

      <h3>nodeSelector</h3>
      <p>The simplest node selection. Label a node, then reference it with <code>nodeSelector</code>. Limitation:
        equality matching only &mdash; no OR, no NOT. Use Node Affinity for complex rules.</p>
      <pre><code># Label a node
kubectl label nodes node01 size=Large

# Verify the label
kubectl get nodes --show-labels | grep size</code></pre>
      <div class="snippet-label">Pod with nodeSelector</div>
      <pre><code>apiVersion: v1
kind: Pod
metadata:
  name: data-processor
spec:
  containers:
  - name: data-processor
    image: data-processor
  nodeSelector:
    size: Large       # only scheduled on nodes with this label</code></pre>

      <h3>Node Affinity</h3>
      <p>More expressive than <code>nodeSelector</code>. Supports <code>In</code>, <code>NotIn</code>,
        <code>Exists</code>, <code>DoesNotExist</code> operators and both hard and soft rules.
      </p>
      <ul>
        <li><strong>requiredDuringSchedulingIgnoredDuringExecution:</strong> Hard rule. Pod stays Pending if no node
          matches. Running pods are NOT evicted if node labels change later.</li>
        <li><strong>preferredDuringSchedulingIgnoredDuringExecution:</strong> Soft rule. Scheduler tries to match but
          places pod elsewhere if needed.</li>
      </ul>
      <div class="snippet-label">Node Affinity YAML</div>
      <pre><code>apiVersion: v1
kind: Pod
metadata:
  name: data-processor
spec:
  containers:
  - name: data-processor
    image: data-processor
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: size
            operator: In
            values:
            - Large
            - Medium
      preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 50               # 1-100; higher = more preferred
        preference:
          matchExpressions:
          - key: disktype
            operator: In
            values:
            - ssd</code></pre>
      <p><strong>Tip:</strong> Use Taints+Tolerations <em>together</em> with Node Affinity to fully dedicate nodes:
        taints repel unwanted pods; affinity attracts your pods to those nodes.</p>

      <h3>Resource Requirements and Limits</h3>
      <p><strong>Requests</strong> &mdash; guaranteed allocation used by scheduler to pick a suitable node.<br>
        <strong>Limits</strong> &mdash; maximum a container can consume at runtime.
      </p>
      <ul>
        <li>CPU exceeds limit &rarr; <strong>throttled</strong> (never killed for CPU)</li>
        <li>Memory exceeds limit &rarr; container is <strong>OOMKilled</strong> and restarted</li>
        <li>No requests set &rarr; scheduler treats it as 0 (pod placed anywhere &mdash; risky for stability)</li>
      </ul>
      <div class="snippet-label">Pod with resource requests and limits</div>
      <pre><code>apiVersion: v1
kind: Pod
metadata:
  name: resource-demo
spec:
  containers:
  - name: app
    image: nginx
    resources:
      requests:
        memory: "64Mi"        # scheduler looks for node with &ge;64Mi free
        cpu: "250m"           # 0.25 vCPU (millicores)
      limits:
        memory: "128Mi"       # OOMKilled if exceeded
        cpu: "500m"           # throttled if exceeded</code></pre>

      <h3>LimitRange</h3>
      <p>Namespace-scoped policy that sets default requests/limits and enforces min/max bounds for containers. Applied
        at admission time &mdash; existing pods are NOT affected.</p>
      <div class="snippet-label">LimitRange YAML</div>
      <pre><code>apiVersion: v1
kind: LimitRange
metadata:
  name: mem-cpu-limits
  namespace: dev
spec:
  limits:
  - type: Container
    default:              # used when container omits limits
      cpu: "500m"
      memory: "128Mi"
    defaultRequest:       # used when container omits requests
      cpu: "250m"
      memory: "64Mi"
    max:                  # container cannot request/limit above this
      cpu: "2"
      memory: "1Gi"
    min:                  # container must request/limit at least this
      cpu: "100m"
      memory: "16Mi"</code></pre>
      <pre><code>kubectl apply -f limitrange.yaml
kubectl describe limitrange mem-cpu-limits -n dev</code></pre>

      <h3>DaemonSets</h3>
      <p>Ensures <strong>exactly one Pod</strong> copies runs on every node (or selected nodes). New nodes auto-receive
        the pod; deleted nodes clean it up. Common uses: log collectors (Fluentd, Filebeat), node monitoring
        (node-exporter), kube-proxy, CNI plugins.</p>
      <div class="snippet-label">DaemonSet YAML</div>
      <pre><code>apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: monitoring-daemon
  namespace: kube-system
spec:
  selector:
    matchLabels:
      app: monitoring-daemon       # must match template labels
  template:
    metadata:
      labels:
        app: monitoring-daemon     # must match selector
    spec:
      tolerations:
      - key: node-role.kubernetes.io/control-plane
        operator: Exists
        effect: NoSchedule         # also run on master nodes
      containers:
      - name: monitoring-agent
        image: prom/node-exporter
        ports:
        - containerPort: 9100
        resources:
          limits:
            memory: "200Mi"
            cpu: "100m"</code></pre>
      <pre><code>kubectl apply -f daemonset.yaml
kubectl get daemonsets -n kube-system
kubectl describe daemonset monitoring-daemon -n kube-system</code></pre>

      <h3>Static Pods</h3>
      <p>Pods managed <strong>directly by the kubelet</strong>, bypassing the API server. Kubelet watches a manifest
        directory and creates/deletes pods from files there. The API server shows them as read-only <em>mirror
          pods</em>.</p>
      <ul>
        <li>Default path: <code>/etc/kubernetes/manifests/</code></li>
        <li>Control-plane components (etcd, kube-apiserver, controller-manager, scheduler) are all static pods on master
        </li>
        <li>To delete: remove the manifest file &mdash; <code>kubectl delete pod</code> will NOT work (mirror pod
          recreates immediately)</li>
      </ul>
      <div class="snippet-label">Configure staticPodPath in kubelet</div>
      <pre><code># /var/lib/kubelet/config.yaml
staticPodPath: /etc/kubernetes/manifests

# OR as a kubelet start flag:
--pod-manifest-path=/etc/kubernetes/manifests

# Apply changes
systemctl daemon-reload &amp;&amp; systemctl restart kubelet</code></pre>
      <div class="snippet-label">Example static pod manifest (drop into manifests dir)</div>
      <pre><code>apiVersion: v1
kind: Pod
metadata:
  name: static-nginx
  namespace: kube-system
spec:
  containers:
  - name: nginx
    image: nginx:1.25
    ports:
    - containerPort: 80</code></pre>
      <pre><code># Static pods have the node name appended: kube-apiserver-controlplane
kubectl get pods -n kube-system

# Confirm it's static (ownerReferences.kind == Node)
kubectl get pod kube-apiserver-controlplane -n kube-system   -o jsonpath='{.metadata.ownerReferences[*].kind}'

# Locate the staticPodPath on a node
ps aux | grep kubelet | grep config</code></pre>

      <h3>Node Maintenance &mdash; Cordon, Drain, Uncordon</h3>
      <p>Safely move workloads off a node before maintenance (OS upgrade, reboot, hardware replacement).</p>
      <ul>
        <li><strong>cordon:</strong> Marks node <code>SchedulingDisabled</code>. No new pods placed; existing pods keep
          running.</li>
        <li><strong>drain:</strong> Cordon + graceful eviction of all pods (respects PodDisruptionBudgets). DaemonSet
          pods ignored by default.</li>
        <li><strong>uncordon:</strong> Re-enables scheduling after maintenance completes.</li>
      </ul>
      <pre><code># Mark as unschedulable only (pods keep running)
kubectl cordon node01

# Evict pods and mark unschedulable
kubectl drain node01 --ignore-daemonsets --delete-emptydir-data

# Re-enable scheduling after work is done
kubectl uncordon node01

# Check node status and conditions
kubectl get nodes
kubectl describe node node01 | grep -E "Taints|Unschedulable"</code></pre>

      <h3>Pod Priority and Preemption</h3>
      <p>When the cluster is full, high-priority pods can <strong>preempt</strong> (evict) lower-priority pods. Priority
        is defined by a <code>PriorityClass</code> resource.</p>
      <div class="snippet-label">PriorityClass definition</div>
      <pre><code>apiVersion: scheduling.k8s.io/v1
kind: PriorityClass
metadata:
  name: high-priority
value: 1000000              # higher = more important (system max ~2 billion)
globalDefault: false        # if true, applies to pods without a class
description: "Critical production workloads"
preemptionPolicy: PreemptLowerPriority   # or Never (no eviction)</code></pre>
      <div class="snippet-label">Pod using PriorityClass</div>
      <pre><code>apiVersion: v1
kind: Pod
metadata:
  name: critical-app
spec:
  priorityClassName: high-priority
  containers:
  - name: app
    image: nginx</code></pre>
      <pre><code>kubectl get priorityclasses
kubectl describe priorityclass high-priority</code></pre>

      <h3>Multiple Schedulers</h3>
      <p>Deploy a custom scheduler Pod/Deployment alongside the default. Give it a unique <code>schedulerName</code> in
        its config. Pods opt in with <code>spec.schedulerName</code>.</p>
      <div class="snippet-label">Custom scheduler Pod manifest</div>
      <pre><code>apiVersion: v1
kind: Pod
metadata:
  name: my-custom-scheduler
  namespace: kube-system
spec:
  serviceAccountName: my-scheduler        # needs RBAC to watch/bind pods
  containers:
  - name: kube-scheduler
    image: registry.k8s.io/kube-scheduler:v1.29.0
    command:
    - kube-scheduler
    - --config=/etc/kubernetes/my-scheduler-config.yaml
    volumeMounts:
    - name: config
      mountPath: /etc/kubernetes
  volumes:
  - name: config
    configMap:
      name: my-scheduler-config</code></pre>
      <div class="snippet-label">Pod assigned to custom scheduler</div>
      <pre><code>apiVersion: v1
kind: Pod
metadata:
  name: custom-scheduled-pod
spec:
  schedulerName: my-custom-scheduler    # must match name in scheduler config
  containers:
  - name: nginx
    image: nginx</code></pre>
      <pre><code># Verify which scheduler placed this pod
kubectl get events --field-selector reason=Scheduled
kubectl describe pod custom-scheduled-pod | grep "Node:"</code></pre>

      <h3>Scheduler Profiles</h3>
      <p>From Kubernetes 1.18+ you can run <strong>multiple profiles in a single scheduler binary</strong> rather than
        separate Pods. Each profile configures its own set of plugins per phase (QueueSort, Filter, Score, Bind).</p>
      <div class="snippet-label">KubeSchedulerConfiguration with two profiles</div>
      <pre><code>apiVersion: kubescheduler.config.k8s.io/v1
kind: KubeSchedulerConfiguration
profiles:
- schedulerName: default-scheduler
  plugins:
    score:
      disabled:
      - name: PodTopologySpread    # disable a score plugin for this profile
- schedulerName: high-throughput-scheduler
  plugins:
    filter:
      disabled:
      - name: TaintToleration      # relax taint check for this profile</code></pre>

      <!-- 04 Logging & Monitoring -->
      <h2 id="section-04">04 — Logging and Monitoring</h2>
      <h3>Application logs</h3>
      <p>Container stdout/stderr are captured by kubelet and exposed via the API. Use <code>kubectl logs</code>. For a
        <strong>multi-container</strong> pod you must specify the container name.
      </p>
      <pre><code>kubectl logs -f &lt;pod-name&gt;
kubectl logs -f &lt;pod-name&gt; &lt;container-name&gt;
kubectl logs &lt;pod-name&gt; --previous
kubectl logs &lt;pod-name&gt; -f --previous</code></pre>
      <p><code>-f</code> streams logs; <code>--previous</code> shows logs from the <strong>previous</strong> container
        instance (e.g. after a crash/restart).</p>
      <h3>Cluster metrics</h3>
      <p><strong>Metrics Server</strong> provides resource metrics (CPU/memory) for <code>kubectl top nodes</code> and
        <code>kubectl top pods</code>. It is not for long-term storage; use a monitoring stack (Prometheus, etc.) for
        that. Legacy Heapster is deprecated.
      </p>

      <!-- 05 Application Lifecycle -->
      <h2 id="section-05">05 — Application Lifecycle Management</h2>
      <h3>Rolling updates and rollback</h3>
      <p>Deployment strategies: <strong>Recreate</strong> (all down then up), <strong>RollingUpdate</strong>
        (default).
      </p>
      <pre><code>kubectl rollout status deployment/myapp-deployment
kubectl rollout history deployment/myapp-deployment
kubectl set image deployment/myapp-deployment nginx=nginx:1.9.1
kubectl apply -f deployment-definition.yaml
kubectl rollout undo deployment/myapp-deployment</code></pre>

      <h3>ConfigMaps</h3>
      <p>Create: imperative
        <code>kubectl create configmap app-config --from-literal=APP_COLOR=blue --from-literal=APP_MODE=prod</code> or
        from file <code>--from-file=app_config.properties</code>.
      </p>
      <div class="snippet-label">ConfigMap YAML</div>
      <pre><code>apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config
data:
  APP_COLOR: blue
  APP_MODE: prod</code></pre>
      <pre><code>kubectl create -f config-map.yaml
kubectl get configmaps
kubectl get cm
kubectl describe configmaps app-config</code></pre>
      <div class="snippet-label">Inject ConfigMap into pod (envFrom)</div>
      <pre><code>apiVersion: v1
kind: Pod
metadata:
  name: simple-webapp-color
spec:
  containers:
  - name: simple-webapp-color
    image: simple-webapp-color
    ports:
    - containerPort: 8080
    envFrom:
    - configMapRef:
        name: app-config</code></pre>

      <h3>Secrets</h3>
      <p>Store sensitive data (base64 in YAML). Create:
        <code>kubectl create secret generic app-secret --from-literal=DB_Host=mysql --from-literal=DB_User=root --from-literal=DB_Password=paswrd</code>.
        Encode for YAML: <code>echo -n "paswrd" | base64</code>.
      </p>
      <pre><code>apiVersion: v1
kind: Secret
metadata:
  name: app-secret
data:
  DB_Host: bX1zcWw=
  DB_User: cm9vdA==
  DB_Password: cGFzd3Jk</code></pre>
      <pre><code>kubectl create -f secret-data.yaml
kubectl get secrets
kubectl describe secret app-secret
kubectl get secret app-secret -o yaml</code></pre>
      <p>Decode: <code>echo -n "bX1zcWw=" | base64 --decode</code>. Inject into pod with
        <code>envFrom: - secretRef: name: app-secret</code> (same structure as configMapRef).
      </p>

      <h3>Commands and arguments</h3>
      <p>Override image <strong>CMD</strong> with <code>command</code> (args to entrypoint) and
        <strong>ENTRYPOINT</strong> with <code>args</code> in the container spec. In Kubernetes, <code>command</code>
        corresponds to Docker ENTRYPOINT and <code>args</code> to CMD. Example: <code>command: ["sleep"]</code>,
        <code>args: ["3600"]</code>.
      </p>
      <div class="snippet-label">Docker → Kubernetes mapping</div>
      <pre><code># Dockerfile          → Pod spec
# ENTRYPOINT ["python"] → command: ["python"]
# CMD ["app.py"]       → args: ["app.py"]

apiVersion: v1
kind: Pod
metadata:
  name: command-demo
spec:
  containers:
  - name: demo
    image: ubuntu
    command: ["sleep"]    # overrides ENTRYPOINT
    args: ["5000"]        # overrides CMD</code></pre>
      <h3>Environment variables</h3>
      <p>Set env vars directly, from ConfigMaps, or from Secrets. Three injection methods:</p>
      <pre><code>containers:
- name: app
  image: myapp
  env:
  # 1. Plain key-value
  - name: APP_COLOR
    value: pink
  # 2. From ConfigMap key
  - name: APP_ENV
    valueFrom:
      configMapKeyRef:
        name: app-config
        key: APP_ENV
  # 3. From Secret key
  - name: DB_PASSWORD
    valueFrom:
      secretKeyRef:
        name: app-secret
        key: DB_Password</code></pre>

      <h3>Multi-container pod design patterns</h3>
      <p>CKA tests multi-container pods. Three main patterns:</p>
      <ul>
        <li><strong>Sidecar:</strong> auxiliary container that enhances the main container (e.g. log shipper that
          reads
          shared volume, Istio proxy).</li>
        <li><strong>Ambassador:</strong> proxy container that handles connections to external services on behalf of
          the
          main container (e.g. localhost proxy to reach different DB environments).</li>
        <li><strong>Adapter:</strong> transforms data from the main container before exporting it (e.g. log format
          normaliser, metrics adapter).</li>
      </ul>
      <div class="snippet-label">Sidecar example (log streamer)</div>
      <pre><code>apiVersion: v1
kind: Pod
metadata:
  name: app-with-sidecar
spec:
  containers:
  - name: app
    image: busybox
    command: ['sh', '-c', 'while true; do echo "$(date) INFO app running" >> /var/log/app.log; sleep 5; done']
    volumeMounts:
    - name: log-volume
      mountPath: /var/log
  - name: sidecar
    image: busybox
    command: ['sh', '-c', 'tail -f /var/log/app.log']
    volumeMounts:
    - name: log-volume
      mountPath: /var/log
  volumes:
  - name: log-volume
    emptyDir: {}</code></pre>
      <h3>Init containers</h3>
      <p>Run to completion before main containers start. Use for one-time setup or waiting for dependencies. If an
        init
        container fails, the pod is restarted (all init containers re-run). Order: initContainers run sequentially;
        then
        main containers start.</p>
      <pre><code>apiVersion: v1
kind: Pod
metadata:
  name: myapp-pod
  labels:
    app: myapp
spec:
  containers:
  - name: myapp-container
    image: busybox:1.28
    command: ['sh', '-c', 'echo The app is running! && sleep 3600']
  initContainers:
  - name: init-myservice
    image: busybox:1.28
    command: ['sh', '-c', 'until nslookup myservice; do echo waiting for myservice; sleep 2; done;']
  - name: init-mydb
    image: busybox:1.28
    command: ['sh', '-c', 'until nslookup mydb; do echo waiting for mydb; sleep 2; done;']</code></pre>

      <h3>Liveness and readiness probes</h3>
      <p>Probes make deployments <strong>self-healing</strong>. <strong>livenessProbe</strong>: if it fails, the
        container is restarted. <strong>readinessProbe</strong>: if it fails, the pod is removed from Service
        endpoints
        (no traffic until ready). Types: <code>httpGet</code> (HTTP path), <code>exec</code> (command),
        <code>tcpSocket</code> (port open).
      </p>
      <div class="snippet-label">Probes example</div>
      <pre><code>containers:
- name: app
  image: myapp:1.0
  livenessProbe:
    httpGet:
      path: /healthz
      port: 8080
    initialDelaySeconds: 15
    periodSeconds: 20
  readinessProbe:
    httpGet:
      path: /ready
      port: 8080
    initialDelaySeconds: 5
    periodSeconds: 10</code></pre>

      <h3>HorizontalPodAutoscaler (HPA)</h3>
      <p><strong>Workload autoscaling</strong>: HPA scales a Deployment/ReplicaSet based on CPU (or custom metrics).
        Requires <strong>Metrics Server</strong> in the cluster for <code>kubectl top</code> and CPU-based scaling.
        Set
        <code>resources.requests</code> on the deployment so HPA can compute utilization.
      </p>
      <div class="snippet-label">HPA YAML</div>
      <pre><code>apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: myapp-hpa
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: myapp-deployment
  minReplicas: 2
  maxReplicas: 10
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 80</code></pre>
      <pre><code>kubectl autoscale deployment myapp-deployment --min=2 --max=10 --cpu-percent=80
kubectl get hpa
kubectl describe hpa myapp-hpa</code></pre>

      <!-- 06 Cluster Maintenance -->
      <h2 id="section-06">06 — Cluster Maintenance</h2>
      <h3>OS upgrades and node maintenance</h3>
      <p><strong>Important:</strong> If a node is down for <strong>more than 5 minutes</strong>, the control plane may
        terminate pods that were on that node (they will be recreated elsewhere if managed by a controller).</p>
      <ul>
        <li><strong>kubectl drain &lt;node&gt;</strong>: Evicts workloads from the node (pods are rescheduled
          elsewhere)
          and marks the node <strong>unschedulable</strong> (cordon). Use before OS upgrade or maintenance.</li>
        <li><strong>kubectl uncordon &lt;node&gt;</strong>: Marks the node schedulable again after it is back.</li>
        <li><strong>kubectl cordon &lt;node&gt;</strong>: Only marks the node unschedulable; does <strong>not</strong>
          evict existing pods.</li>
      </ul>
      <figure class="diagram">
        <svg viewBox="0 0 420 120" preserveAspectRatio="xMidYMid meet" xmlns="http://www.w3.org/2000/svg">
          <rect x="20" y="20" width="118" height="80" rx="8" fill="#eaeef2" stroke="#d0d7de" />
          <text x="79" y="48" fill="#1a7f37" font-size="15" font-weight="600" text-anchor="middle">cordon</text>
          <text x="79" y="68" fill="#656d76" font-size="13" text-anchor="middle">No new pods</text>
          <text x="79" y="84" fill="#656d76" font-size="13" text-anchor="middle">Pods stay</text>
          <rect x="151" y="20" width="118" height="80" rx="8" fill="#eaeef2" stroke="#d0d7de" />
          <text x="210" y="48" fill="#0969da" font-size="15" font-weight="600" text-anchor="middle">drain</text>
          <text x="210" y="68" fill="#656d76" font-size="13" text-anchor="middle">Cordon + evict</text>
          <text x="210" y="84" fill="#656d76" font-size="13" text-anchor="middle">Pods move away</text>
          <rect x="282" y="20" width="118" height="80" rx="8" fill="#eaeef2" stroke="#d0d7de" />
          <text x="341" y="48" fill="#1a7f37" font-size="15" font-weight="600" text-anchor="middle">uncordon</text>
          <text x="341" y="68" fill="#656d76" font-size="13" text-anchor="middle">Allow scheduling</text>
          <text x="341" y="84" fill="#656d76" font-size="13" text-anchor="middle">again</text>
        </svg>
        <figcaption>cordon = no new pods; drain = cordon + evict; uncordon = allow scheduling again.</figcaption>
      </figure>

      <h3>Kubernetes versions</h3>
      <p>Kubernetes supports the last 3 minor versions. Upgrade one minor version at a time. kubeadm, kubelet, and
        control-plane components can be at different versions during upgrade.</p>

      <h3>Cluster upgrade (kubeadm)</h3>
      <p><strong>Master:</strong></p>
      <pre><code>kubeadm upgrade plan
apt-get upgrade -y kubeadm=1.12.0-00
kubeadm upgrade apply v1.12.0
apt-get upgrade kubelet=1.12.0-00
systemctl restart kubelet
kubectl get nodes</code></pre>
      <p><strong>Workers:</strong> drain, upgrade kubeadm and kubelet, update node config, restart kubelet, uncordon.
      </p>
      <pre><code>kubectl drain node-1
apt-get upgrade -y kubeadm=1.12.0-00 kubelet=1.12.0-00
kubeadm upgrade node config --kubelet-version v1.12.0
systemctl restart kubelet
kubectl uncordon node-1</code></pre>

      <h3>Backup and restore</h3>
      <p><strong>Resource configs:</strong> store YAML in Git; or
        <code>kubectl get all --all-namespaces -o yaml &gt; all-deploy-services.yaml</code> (partial). Tools like
        Velero
        can backup/restore resources.
      </p>
      <p><strong>ETCD snapshot:</strong></p>
      <pre><code>ETCDCTL_API=3 etcdctl snapshot save snapshot.db
ETCDCTL_API=3 etcdctl snapshot status snapshot.db</code></pre>
      <p>With kubeadm, etcd runs as a pod; use the correct endpoint and certs. Example (adjust paths/endpoints for
        your
        setup):</p>
      <pre><code>ETCDCTL_API=3 etcdctl snapshot save snapshot.db \
  --endpoints=https://127.0.0.1:2379 \
  --cacert=/etc/kubernetes/pki/etcd/ca.crt \
  --cert=/etc/kubernetes/pki/etcd/server.crt \
  --key=/etc/kubernetes/pki/etcd/server.key</code></pre>
      <p>Restore: <code>etcdctl snapshot restore snapshot.db --data-dir=/var/lib/etcd-from-backup</code>, then point
        etcd to the new data-dir and restart control-plane components.</p>

      <h3>PodDisruptionBudget (PDB)</h3>
      <p>PDB limits voluntary disruptions (e.g. <code>kubectl drain</code>, node upgrades) so that a minimum number of
        pods stay available. <strong>minAvailable</strong>: at least N pods (number or percentage).
        <strong>maxUnavailable</strong>: at most N pods down (number or percentage). Drain respects PDBs and may block
        until pods can be rescheduled.
      </p>
      <div class="snippet-label">PDB example (minAvailable)</div>
      <pre><code>apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: myapp-pdb
spec:
  minAvailable: 2
  selector:
    matchLabels:
      app: myapp</code></pre>
      <div class="snippet-label">PDB with maxUnavailable</div>
      <pre><code>spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app: myapp</code></pre>
      <pre><code>kubectl get pdb
kubectl describe pdb myapp-pdb</code></pre>

      <!-- 07 Security -->
      <h2 id="section-07">07 — Security</h2>

      <h3>Kubernetes security primitives</h3>
      <p>Security starts with the <strong>API server</strong> — it is the gatekeeper. Two key questions: <strong>who
          can
          access?</strong> (authentication) and <strong>what can they do?</strong> (authorization). All access goes
        through the API server, making it the single chokepoint for security.</p>

      <h3>Authentication</h3>
      <p>Kubernetes does <strong>not</strong> manage user accounts natively (no User object). It relies on external
        mechanisms. Two types of accounts:</p>
      <ul>
        <li><strong>Users</strong> (humans): admins, developers — managed externally (certificates, LDAP, OIDC
          tokens).
        </li>
        <li><strong>Service Accounts</strong> (machines): used by pods and processes — managed by Kubernetes.</li>
      </ul>
      <p>Authentication methods: <strong>static password/token files</strong> (deprecated),
        <strong>certificates</strong> (most common with kubeadm), <strong>OIDC</strong>, <strong>webhook</strong>. All
        requests are authenticated by the API server before authorization.
      </p>

      <h3>Service Accounts</h3>
      <p>ServiceAccounts are namespace-scoped. Every namespace has a <code>default</code> SA. Pods automatically mount
        the SA token. Use custom SAs to give pods specific RBAC permissions.</p>
      <pre><code># Create
kubectl create serviceaccount dashboard-sa
kubectl get serviceaccount

# Use in pod
apiVersion: v1
kind: Pod
metadata:
  name: my-dashboard
spec:
  serviceAccountName: dashboard-sa
  automountServiceAccountToken: false   # opt-out of auto-mount
  containers:
  - name: dashboard
    image: my-dashboard:v1</code></pre>
      <p>Since Kubernetes 1.24, ServiceAccount tokens are no longer auto-created as Secrets. Use
        <code>kubectl create token &lt;sa-name&gt;</code> for short-lived tokens, or create a Secret with annotation
        <code>kubernetes.io/service-account.name</code>.
      </p>

      <h3>TLS in Kubernetes</h3>
      <p>Cluster components use <strong>TLS</strong>: servers use <strong>server certificates</strong>, clients use
        <strong>client certificates</strong> for authentication. API server, etcd, kubelet, and other control-plane
        components each have certs (typically under <code>/etc/kubernetes/pki/</code> on kubeadm). Certificate API can
        issue signed certs for users; the controller manager handles signing.
      </p>
      <h4>Key certificate files (kubeadm)</h4>
      <ul>
        <li><code>ca.crt / ca.key</code> — Cluster CA (root of trust)</li>
        <li><code>apiserver.crt / apiserver.key</code> — API server TLS</li>
        <li><code>apiserver-kubelet-client.crt</code> — API → kubelet client cert</li>
        <li><code>apiserver-etcd-client.crt</code> — API → etcd client cert</li>
        <li><code>etcd/ca.crt, etcd/server.crt</code> — etcd TLS</li>
        <li><code>front-proxy-ca.crt</code> — Aggregation layer</li>
      </ul>

      <h3>Viewing certificates</h3>
      <pre><code>openssl x509 -in /etc/kubernetes/pki/apiserver.crt -text -noout</code></pre>
      <p>Check subject, issuer, validity (not after), SANs (Subject Alternative Names). Same for other certs in
        <code>/etc/kubernetes/pki/</code> (ca.crt, apiserver-kubelet-client.crt, etc.).
      </p>

      <h3>Certificate API — CSR workflow</h3>
      <p>Kubernetes has a built-in <strong>Certificate Signing Request (CSR)</strong> API for issuing client
        certificates. The controller manager signs the certificates using the cluster CA.</p>
      <div class="snippet-label">Create and approve a user certificate</div>
      <pre><code># 1. User generates key and CSR
openssl genrsa -out jane.key 2048
openssl req -new -key jane.key -subj "/CN=jane" -out jane.csr

# 2. Admin creates CSR object (base64-encode the CSR)
cat jane.csr | base64 | tr -d '\n'</code></pre>
      <pre><code># 3. CSR YAML
apiVersion: certificates.k8s.io/v1
kind: CertificateSigningRequest
metadata:
  name: jane
spec:
  request: &lt;base64-encoded-csr&gt;
  signerName: kubernetes.io/kube-apiserver-client
  usages:
  - client auth</code></pre>
      <pre><code># 4. Approve and extract certificate
kubectl create -f jane-csr.yaml
kubectl get csr
kubectl certificate approve jane
kubectl get csr jane -o jsonpath='{.status.certificate}' | base64 --decode > jane.crt

# 5. Deny a CSR
kubectl certificate deny bad-user</code></pre>
      <h3>kubeconfig</h3>
      <p>kubeconfig holds clusters (API server URL, CA), users (credentials: cert/key or token), and
        <strong>contexts</strong> (which cluster + which user + optional namespace). Default file:
        <code>~/.kube/config</code>.
      </p>
      <pre><code>kubectl config view
kubectl config view --kubeconfig=my-custom-config
kubectl config use-context &lt;context-name&gt;
kubectl config current-context
kubectl get pods --kubeconfig config</code></pre>
      <p>To set default namespace for current context:
        <code>kubectl config set-context $(kubectl config current-context) --namespace=dev</code>.
      </p>
      <h3>RBAC — Role and RoleBinding</h3>
      <p>Role: apiGroups, resources, verbs. RoleBinding: links subject (user/group/serviceaccount) to Role. Both are
        namespace-scoped.</p>
      <pre><code>apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: developer
rules:
- apiGroups: [""]
  resources: ["pods"]
  verbs: ["get", "list", "update", "delete", "create"]
- apiGroups: [""]
  resources: ["configmaps"]
  verbs: ["create"]</code></pre>
      <pre><code>apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: devuser-developer-binding
subjects:
- kind: User
  name: dev-user
  apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: Role
  name: developer
  apiGroup: rbac.authorization.k8s.io</code></pre>
      <pre><code>kubectl create -f developer-role.yaml
kubectl create -f devuser-developer-binding.yaml
kubectl get roles
kubectl get rolebindings
kubectl describe role developer
kubectl describe rolebinding devuser-developer-binding
kubectl auth can-i create pods --as=dev-user -n default</code></pre>

      <h3>ClusterRole and ClusterRoleBinding</h3>
      <p>ClusterRole can define access to cluster-scoped resources (e.g. nodes) or to namespaced resources across all
        namespaces.</p>
      <pre><code>apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: cluster-administrator
rules:
- apiGroups: [""]
  resources: ["nodes"]
  verbs: ["get", "list", "delete", "create"]</code></pre>
      <pre><code>apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: cluster-admin-role-binding
subjects:
- kind: User
  name: cluster-admin
  apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: ClusterRole
  name: cluster-administrator
  apiGroup: rbac.authorization.k8s.io</code></pre>
      <pre><code>kubectl create -f cluster-admin-role.yaml
kubectl create -f cluster-admin-role-binding.yaml
kubectl api-resources --namespaced=true
kubectl api-resources --namespaced=false</code></pre>

      <h3>Network policy</h3>
      <p>Controls ingress/egress to pods by selector. Default: no restrictions. Once a NetworkPolicy selects a pod,
        that
        pod denies traffic not allowed by any policy.</p>
      <pre><code>apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: db-policy
spec:
  podSelector:
    matchLabels:
      role: db
  policyTypes:
  - Ingress
  ingress:
  - from:
    - podSelector:
        matchLabels:
          role: api-pod
    ports:
    - protocol: TCP
      port: 3306</code></pre>
      <pre><code>kubectl create -f policy-definition.yaml</code></pre>
      <h3>Image security</h3>
      <p>Default image registry is <strong>docker.io</strong>. Image <code>nginx</code> is really
        <code>docker.io/library/nginx</code>. For private registries, create a <code>docker-registry</code> secret and
        reference it in the pod spec.
      </p>
      <div class="snippet-label">Pull from private registry</div>
      <pre><code># Create registry secret
kubectl create secret docker-registry regcred \
  --docker-server=private-registry.io \
  --docker-username=registry-user \
  --docker-password=registry-password \
  --docker-email=registry-user@org.com</code></pre>
      <pre><code># Use in pod
apiVersion: v1
kind: Pod
metadata:
  name: private-app
spec:
  containers:
  - name: app
    image: private-registry.io/apps/internal-app
  imagePullSecrets:
  - name: regcred</code></pre>

      <h3>Security context</h3>
      <p>Restrict pod/container behavior: run as non-root user, read-only root filesystem, drop capabilities. Set at
        <code>spec.securityContext</code> (pod) or <code>spec.containers[].securityContext</code> (container).
        Container-level settings override pod-level. Capabilities can only be set at <strong>container</strong> level.
      </p>
      <pre><code>spec:
  securityContext:
    runAsUser: 1000
    runAsGroup: 3000
    fsGroup: 2000
  containers:
  - name: ubuntu
    image: ubuntu
    securityContext:
      runAsUser: 1000
      runAsNonRoot: true
      readOnlyRootFilesystem: true
      capabilities:
        add: ["NET_ADMIN", "SYS_TIME"]
        drop: ["ALL"]</code></pre>
      <pre><code># Check who's running inside the container
kubectl exec my-pod -- whoami
kubectl exec my-pod -- id</code></pre>
      <figure class="diagram">
        <svg viewBox="0 0 400 110" preserveAspectRatio="xMidYMid meet" xmlns="http://www.w3.org/2000/svg">
          <rect x="24" y="24" width="100" height="62" rx="6" fill="#eaeef2" stroke="#0969da" />
          <text x="74" y="48" fill="#1f2328" font-size="14" font-weight="600" text-anchor="middle">Role</text>
          <text x="74" y="64" fill="#656d76" font-size="12" text-anchor="middle">apiGroups, resources</text>
          <text x="74" y="78" fill="#656d76" font-size="12" text-anchor="middle">verbs</text>
          <path d="M124 55 L148 55" stroke="#1a7f37" stroke-width="2" />
          <rect x="148" y="24" width="104" height="62" rx="6" fill="#eaeef2" stroke="#0969da" />
          <text x="200" y="48" fill="#1f2328" font-size="14" font-weight="600" text-anchor="middle">RoleBinding</text>
          <text x="200" y="66" fill="#656d76" font-size="12" text-anchor="middle">subjects, roleRef</text>
          <path d="M252 55 L276 55" stroke="#1a7f37" stroke-width="2" />
          <rect x="276" y="24" width="100" height="62" rx="6" fill="#eaeef2" stroke="#1a7f37" />
          <text x="326" y="48" fill="#1f2328" font-size="14" font-weight="600" text-anchor="middle">User</text>
          <text x="326" y="66" fill="#656d76" font-size="12" text-anchor="middle">permissions</text>
        </svg>
        <figcaption>RBAC: Role defines permissions; RoleBinding binds Role to User/Group/ServiceAccount.</figcaption>
      </figure>

      <!-- 08 Storage -->
      <h2 id="section-08">08 — Storage</h2>
      <h3>Persistent Volume (PV) and Persistent Volume Claim (PVC)</h3>
      <p>PV is <strong>cluster-scoped</strong> storage (admin provisions); PVC is <strong>namespace-scoped</strong>
        (user requests storage). They bind when capacity and <code>accessModes</code> match. If no PV matches, PVC
        stays
        <strong>Pending</strong>. Access modes: ReadWriteOnce (RWO), ReadOnlyMany (ROX), ReadWriteMany (RWX).
      </p>
      <figure class="diagram">
        <svg viewBox="0 0 500 110" preserveAspectRatio="xMidYMid meet" xmlns="http://www.w3.org/2000/svg">
          <rect x="24" y="24" width="130" height="62" rx="6" fill="#eaeef2" stroke="#0969da" />
          <text x="89" y="48" fill="#1f2328" font-size="15" font-weight="600" text-anchor="middle">PV</text>
          <text x="89" y="66" fill="#656d76" font-size="13" text-anchor="middle">cluster-scoped</text>
          <path d="M154 55 L178 55" stroke="#1a7f37" stroke-width="2" />
          <rect x="178" y="24" width="130" height="62" rx="6" fill="#eaeef2" stroke="#0969da" />
          <text x="243" y="48" fill="#1f2328" font-size="15" font-weight="600" text-anchor="middle">PVC</text>
          <text x="243" y="66" fill="#656d76" font-size="13" text-anchor="middle">namespace-scoped</text>
          <path d="M308 55 L332 55" stroke="#1a7f37" stroke-width="2" />
          <rect x="332" y="24" width="130" height="62" rx="6" fill="#eaeef2" stroke="#1a7f37" />
          <text x="397" y="48" fill="#1f2328" font-size="15" font-weight="600" text-anchor="middle">Pod</text>
          <text x="397" y="66" fill="#656d76" font-size="13" text-anchor="middle">volumeMounts</text>
        </svg>
        <figcaption>Storage flow: PV (pool) → PVC (claim) → Pod (volumeMounts). PVC and Pod must be in same namespace.
        </figcaption>
      </figure>
      <div class="snippet-label">PV definition</div>
      <pre><code>kind: PersistentVolume
apiVersion: v1
metadata:
  name: pv-vol1
spec:
  accessModes: ["ReadWriteOnce"]
  capacity:
    storage: 1Gi
  hostPath:
    path: /tmp/data</code></pre>
      <div class="snippet-label">PVC definition</div>
      <pre><code>kind: PersistentVolumeClaim
apiVersion: v1
metadata:
  name: myclaim
spec:
  accessModes: ["ReadWriteOnce"]
  resources:
    requests:
      storage: 1Gi</code></pre>
      <pre><code>kubectl create -f pv-definition.yaml
kubectl create -f pvc-definition.yaml
kubectl get pv
kubectl get pvc
kubectl delete pvc myclaim
kubectl delete pv pv-vol1</code></pre>

      <h3>Using PVC in a pod</h3>
      <pre><code>apiVersion: v1
kind: Pod
metadata:
  name: mypod
spec:
  containers:
  - name: myfrontend
    image: nginx
    volumeMounts:
    - mountPath: "/var/www/html"
      name: web
  volumes:
  - name: web
    persistentVolumeClaim:
      claimName: myclaim</code></pre>
      <pre><code>kubectl create -f pod-definition.yaml
kubectl get pod,pvc,pv</code></pre>

      <h3>StorageClass (dynamic provisioning)</h3>
      <p>With a StorageClass, PVC can trigger automatic PV creation (no manual PV).</p>
      <pre><code>apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: google-storage
provisioner: kubernetes.io/gce-pd</code></pre>
      <pre><code>kubectl create -f sc-definition.yaml
kubectl get sc</code></pre>
      <p>In PVC add <code>storageClassName: google-storage</code>. Then create PVC and use <code>claimName</code> in
        pod
        volume as above.</p>

      <!-- 09 Networking -->
      <h2 id="section-09">09 — Networking</h2>

      <h3>Networking prerequisites — Linux basics</h3>
      <p>Understanding Linux networking is essential for the CKA. Key commands:</p>
      <div class="snippet-label">Switching, routing, gateways</div>
      <pre><code># List network interfaces
ip link
ip addr

# Assign IP address to interface
ip addr add 192.168.1.10/24 dev eth0

# View routing table
ip route show
route

# Add route
ip route add 192.168.2.0/24 via 192.168.1.1

# Default gateway
ip route add default via 192.168.1.1

# Enable IP forwarding (required for routing between networks)
cat /proc/sys/net/ipv4/ip_forward   # 0=disabled, 1=enabled
echo 1 > /proc/sys/net/ipv4/ip_forward
# Permanent: set net.ipv4.ip_forward=1 in /etc/sysctl.conf
sysctl --system</code></pre>
      <div class="snippet-label">Network namespaces (how containers get isolated networking)</div>
      <pre><code># Create network namespace
ip netns add red
ip netns add blue

# List namespaces
ip netns

# Run command in namespace
ip netns exec red ip link
ip -n red link

# Connect namespaces with veth pair
ip link add veth-red type veth peer name veth-blue
ip link set veth-red netns red
ip link set veth-blue netns blue
ip -n red addr add 192.168.15.1/24 dev veth-red
ip -n blue addr add 192.168.15.2/24 dev veth-blue
ip -n red link set veth-red up
ip -n blue link set veth-blue up</code></pre>

      <h3>Pod Networking &amp; CNI</h3>
      <p>Kubernetes uses the <strong>Container Network Interface (CNI)</strong> standard to manage networking.
        <br><em>Core Responsibilities of CNI Plugin:</em>
        <br>1. <strong>Connectivity:</strong> Insert a network interface into the container's namespace.
        <br>2. <strong>IPAM (IP Address Management):</strong> Assign an IP address to the pod from the Pod CIDR.
      </p>

      <p><em>Golden Rules:</em>
        <br>- Every Pod gets a unique IP.
        <br>- Pods on the same node talk via <code>localhost</code>/bridge.
        <br>- Pods on different nodes talk directly without NAT (Network Address Translation).
      </p>

      <pre><code># Check CNI configuration
ls /etc/cni/net.d/
cat /etc/cni/net.d/10-flannel.conflist

# Check CNI binaries
ls /opt/cni/bin/

# Identify Pod CIDR (allocated to node)
kubectl get node -o jsonpath='{.spec.podCIDR}'</code></pre>

      <h3>Service Networking (The "Magic" VIP)</h3>
      <p>A Service provides a stable <strong>ClusterIP</strong> (Virtual IP) that load balances traffic to dynamic Pod
        IPs.
        <br><strong>Service:</strong> The abstraction (stable VIP).
        <br><strong>Endpoints:</strong> The actual list of backend Pod IPs. Checked via
        <code>kubectl get endpoints</code>.
      </p>

      <p><em>Mechanism:</em> <strong>kube-proxy</strong> runs on every node and watches the API server. It updates
        node
        network rules (usually <strong>iptables</strong> or <strong>IPVS</strong>) to trap traffic destined for the
        Service IP and redirect it to a random backing Pod IP.</p>

      <pre><code># View iptables rules for a service
iptables-save | grep &lt;service-name&gt;

# Check kube-proxy mode
kubectl logs -n kube-system -l k8s-app=kube-proxy</code></pre>

      <h3>DNS (CoreDNS)</h3>
      <p><strong>CoreDNS</strong> is the cluster's internal DNS server. It watches the API server for new Services and
        Pods and creates DNS records.
        <br><em>Config:</em> The <strong>Corefile</strong> (inside a ConfigMap) defines behavior (plugins like
        <code>errors</code>, <code>health</code>, <code>kubernetes</code>, <code>forward</code>).
      </p>

      <p><strong>FQDN (Fully Qualified Domain Name) Structure:</strong>
        <br>Service: <code>my-svc.my-ns.svc.cluster.local</code>
        <br>Pod: <code>1-2-3-4.my-ns.pod.cluster.local</code> (IP with dashes)
      </p>

      <pre><code># Test DNS from a debug pod
kubectl run -it --rm debug --image=busybox:1.28 -- nslookup kubernetes
kubectl get configmap coredns -n kube-system -o yaml</code></pre>

      <h3>Ingress</h3>
      <p>Need an Ingress controller (e.g. nginx-ingress) and Ingress resources (rules). Ingress exposes HTTP/HTTPS
        routes to services.</p>
      <div class="snippet-label">Ingress with paths</div>
      <pre><code>apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: ingress-wear-watch
spec:
  rules:
  - http:
      paths:
      - path: /wear
        pathType: Prefix
        backend:
          service:
            name: wear-service
            port:
              number: 80
      - path: /watch
        pathType: Prefix
        backend:
          service:
            name: watch-service
            port:
              number: 80</code></pre>
      <div class="snippet-label">Ingress with host rules</div>
      <pre><code>apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: ingress-wear-watch
spec:
  rules:
  - host: wear.my-online-store.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: wear-service
            port:
              number: 80
  - host: watch.my-online-store.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: watch-service
            port:
              number: 80</code></pre>
      <pre><code>kubectl create -f ingress.yaml
kubectl get ingress
kubectl describe ingress ingress-wear-watch</code></pre>

      <h3>Gateway API</h3>
      <p>The <strong>Gateway API</strong> is the newer, more expressive way to expose HTTP/gRPC/TCP routes (successor
        concept to Ingress). Key resources: <code>Gateway</code> (infrastructure that receives traffic),
        <code>HTTPRoute</code> (rules for routing to backends). Install a Gateway controller (e.g. Gateway API
        implementation) and create Gateway + HTTPRoute resources. The exam may reference it; know it exists as the
        evolution of Ingress.
      </p>

      <!-- 10 Design & Install -->
      <h2 id="section-10">10 — Design and Install Kubernetes Cluster</h2>
      <p><strong>Design:</strong> Plan control-plane count (HA = multiple masters), etcd (stacked with API server or
        external cluster), load balancer in front of API servers. Choose node sizing and networking (pod CIDR, service
        CIDR).</p>
      <p><strong>High availability:</strong> Multiple API server replicas behind a load balancer; etcd cluster (odd
        number, 3 or 5); scheduler and controller manager can run as active/standby (only one active).</p>

      <!-- 11 kubeadm -->
      <h2 id="section-11">11 — Install Kubernetes the kubeadm Way</h2>
      <p><strong>kubeadm</strong> bootstraps the control plane and generates certs, manifests, and kubeconfig. You
        then
        join worker nodes with <code>kubeadm join</code>. The exam rarely asks for a full install; <strong>upgrading
          an
          existing cluster</strong> (kubeadm upgrade plan / apply, drain/uncordon workers) is frequently tested.</p>
      <h4>kubeadm init steps (reference)</h4>
      <div class="snippet-label">Prerequisites on all nodes</div>
      <pre><code># Disable swap (required)
sudo swapoff -a
sed -i '/ swap / s/^/#/' /etc/fstab

# Enable kernel modules
cat &lt;&lt;EOF | sudo tee /etc/modules-load.d/k8s.conf
overlay
br_netfilter
EOF
sudo modprobe overlay
sudo modprobe br_netfilter

# Sysctl params
cat &lt;&lt;EOF | sudo tee /etc/sysctl.d/k8s.conf
net.bridge.bridge-nf-call-iptables  = 1
net.bridge.bridge-nf-call-ip6tables = 1
net.ipv4.ip_forward                 = 1
EOF
sudo sysctl --system

# Install containerd, kubeadm, kubelet, kubectl
# (follow official docs for your OS)
sudo apt-get update
sudo apt-get install -y kubelet kubeadm kubectl
sudo apt-mark hold kubelet kubeadm kubectl</code></pre>
      <div class="snippet-label">Control plane init</div>
      <pre><code># Initialize control plane
sudo kubeadm init --pod-network-cidr=10.244.0.0/16 --apiserver-advertise-address=&lt;master-ip&gt;

# Copy kubeconfig
mkdir -p $HOME/.kube
sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
sudo chown $(id -u):$(id -g) $HOME/.kube/config

# Install CNI (e.g. Flannel)
kubectl apply -f https://raw.githubusercontent.com/flannel-io/flannel/master/Documentation/kube-flannel.yml</code></pre>
      <div class="snippet-label">Join workers</div>
      <pre><code># On worker nodes (use token from kubeadm init output):
sudo kubeadm join &lt;master-ip&gt;:6443 --token &lt;token&gt; --discovery-token-ca-cert-hash sha256:&lt;hash&gt;

# If token expired, create a new one on master:
kubeadm token create --print-join-command</code></pre>

      <!-- 12 Troubleshooting -->
      <h2 id="section-12">12 — Troubleshooting</h2>
      <h3>Application failure — step-by-step</h3>
      <ul class="step-list">
        <li><strong>Is the service reachable?</strong> <code>curl http://&lt;node-ip&gt;:&lt;nodePort&gt;</code> or
          from
          inside cluster <code>curl http://&lt;svc-name&gt;.&lt;ns&gt;.svc.cluster.local:port</code>.</li>
        <li><strong>Does the service have endpoints?</strong> <code>kubectl get endpoints &lt;service-name&gt;</code>.
          If empty, the service selector does not match any pod (wrong labels or pods not ready).</li>
        <li><strong>Compare selector with pod labels:</strong> <code>kubectl describe service &lt;name&gt;</code> (see
          Selector) and <code>kubectl get pods --show-labels</code>. Fix selector or pod labels.</li>
        <li><strong>Pod status:</strong> <code>kubectl get pods</code>,
          <code>kubectl describe pod &lt;pod-name&gt;</code>. Check events (image pull, CrashLoopBackOff, etc.).
        </li>
        <li><strong>Container logs:</strong> <code>kubectl logs &lt;pod-name&gt;</code>,
          <code>kubectl logs &lt;pod-name&gt; -c &lt;container&gt;</code>,
          <code>kubectl logs &lt;pod-name&gt; --previous</code> for crashed container.
        </li>
      </ul>
      <pre><code>kubectl get pods -o wide
kubectl describe pod &lt;pod-name&gt;
kubectl logs &lt;pod-name&gt; -f --previous</code></pre>

      <h3>Control plane failure</h3>
      <p>Verify nodes are Ready, then check control-plane components. With kubeadm they are pods in
        <code>kube-system</code>; with manual install they are often systemd services.
      </p>
      <pre><code>kubectl get nodes
kubectl get pods -n kube-system
service kube-apiserver status
service kube-controller-manager status
service kube-scheduler status
service kubelet status
kubectl logs kube-apiserver-master -n kube-system
sudo journalctl -u kube-apiserver</code></pre>

      <h3>Worker node failure</h3>
      <p>If a node is <strong>NotReady</strong>, check <code>kubectl describe node &lt;node&gt;</code> (conditions,
        LastHeartbeatTime). On the node: kubelet status, logs, and cert validity (kubelet may have expired cert).</p>
      <pre><code>kubectl get nodes
kubectl describe node worker-1
service kubelet status
sudo journalctl -u kubelet
openssl x509 -in /var/lib/kubelet/worker-1.crt -text</code></pre>
      <h4>Common worker node issues checklist</h4>
      <ul>
        <li><code>kubelet</code> not running → <code>systemctl start kubelet</code>, check
          <code>journalctl -u kubelet</code>
        </li>
        <li>Config error → check <code>/var/lib/kubelet/config.yaml</code> and
          <code>/etc/kubernetes/kubelet.conf</code>
        </li>
        <li>Expired certificates → check cert dates with <code>openssl x509 -in &lt;cert&gt; -text -noout</code></li>
        <li>Node conditions: <code>MemoryPressure</code>, <code>DiskPressure</code>, <code>PIDPressure</code> → check
          resources</li>
        <li>Container runtime down → <code>systemctl status containerd</code></li>
      </ul>

      <h3>Network troubleshooting</h3>
      <p>When pods cannot communicate across nodes or DNS fails:</p>
      <ul class="step-list">
        <li><strong>Check CNI plugin:</strong> <code>kubectl get pods -n kube-system</code> — are Calico/Flannel/Weave
          pods running? Check logs.</li>
        <li><strong>CoreDNS running?</strong> <code>kubectl get pods -n kube-system -l k8s-app=kube-dns</code>. If
          CrashLooping, check <code>kubectl logs &lt;coredns-pod&gt; -n kube-system</code>.</li>
        <li><strong>DNS resolution:</strong>
          <code>kubectl run test --image=busybox:1.28 --rm -it --restart=Never -- nslookup kubernetes</code>
        </li>
        <li><strong>kube-proxy running?</strong> <code>kubectl get ds kube-proxy -n kube-system</code>. Check iptables
          rules: <code>iptables -L -t nat | grep &lt;svc&gt;</code></li>
        <li><strong>Node networking:</strong> <code>ip link</code>, <code>ip addr</code>, <code>ip route</code> on
          affected node. Check IP forwarding: <code>cat /proc/sys/net/ipv4/ip_forward</code></li>
        <li><strong>Firewall/port issues:</strong> Ensure required ports are open (6443, 2379-2380, 10250-10252,
          30000-32767)</li>
      </ul>
      <pre><code># Debug networking from inside a pod
kubectl run netshoot --image=nicolaka/netshoot -it --rm --restart=Never -- bash
# Inside: ping, nslookup, curl, traceroute, tcpdump, iperf, etc.

# Test service from inside cluster
kubectl run test --image=busybox:1.28 --rm -it --restart=Never -- wget -qO- http://&lt;svc&gt;.&lt;ns&gt;.svc.cluster.local:&lt;port&gt;</code></pre>

      <!-- 13 Other Topics -->
      <h2 id="section-13">13 — Other Topics</h2>
      <h3>JSON path and custom columns</h3>
      <pre><code>kubectl get nodes -o json
kubectl get pods -o json
kubectl get pods -o=jsonpath='{.items[0].spec.containers[0].image}'
kubectl get pods -o=jsonpath='{.items[*].metadata.name}'
kubectl get nodes -o=custom-columns=NODE:.metadata.name,CPU:.status.capacity.cpu
kubectl get nodes --sort-by=.metadata.name
kubectl get nodes --sort-by=.status.capacity.cpu</code></pre>

      <h3>2025 curriculum: Helm and Kustomize</h3>
      <p><strong>Helm</strong> packages Kubernetes manifests into <strong>charts</strong>. Use for cluster components
        and repeatable installs. Common commands: <code>helm install &lt;release&gt; &lt;chart&gt;</code>,
        <code>helm upgrade</code>, <code>helm list</code>, <code>helm uninstall</code>. Add repos:
        <code>helm repo add &lt;name&gt; &lt;url&gt;</code>, <code>helm repo update</code>.
      </p>
      <p><strong>Kustomize</strong> customizes base YAML (overlays, patches, common labels). Built into kubectl:
        <code>kubectl apply -k &lt;dir&gt;</code> or <code>kustomize build &lt;dir&gt; | kubectl apply -f -</code>.
        Typical layout: <code>base/</code> (resources) + <code>kustomization.yaml</code>; overlays (e.g.
        <code>dev/</code>, <code>prod/</code>) reference the base and add patches.
      </p>

      <h3>CRDs and operators</h3>
      <p><strong>Custom Resource Definitions (CRDs)</strong> extend the API with custom resources. After defining a
        CRD,
        you get new resource types (e.g. <code>kubectl get myresource</code>). <strong>Operators</strong> are
        controllers that manage custom resources and their lifecycle (install, upgrade, backup). They use CRDs + a
        controller process. List CRDs: <code>kubectl get crd</code>.</p>

      <h3>Extension interfaces: CNI, CSI, CRI</h3>
      <p>Kubernetes uses pluggable interfaces. <strong>CNI</strong> (Container Network Interface): pod networking;
        plugins (Calico, Flannel, Weave) implement the pod network. <strong>CSI</strong> (Container Storage
        Interface):
        storage drivers for PVs; dynamic provisioning via StorageClass uses a CSI driver. <strong>CRI</strong>
        (Container Runtime Interface): container runtimes (containerd, CRI-O); kubelet talks to the runtime via CRI.
        Configure/validate these when installing or troubleshooting the cluster.</p>

      <!-- 14 Playground & Labs -->
      <h2 id="section-14">14 — Playground &amp; Lightning Labs</h2>
      <p>Use the links below to practice in a real cluster, then try the scenarios on your own before revealing the
        solution.</p>

      <h3>Online playgrounds</h3>
      <ul class="playground-links">
        <li>
          <a href="https://killercoda.com/kubernetes" target="_blank" rel="noopener noreferrer">Killercoda —
            Kubernetes</a>
          <div class="link-desc">Free browser-based Kubernetes labs; no local install. Multiple CKA-focused scenarios.
          </div>
        </li>
        <li>
          <a href="https://www.katacoda.com/courses/kubernetes" target="_blank" rel="noopener noreferrer">Katacoda
            (legacy)</a>
          <div class="link-desc">Kubernetes playgrounds (some scenarios may be deprecated; Killercoda is the
            successor).
          </div>
        </li>
        <li>
          <a href="https://labs.play-with-k8s.com/" target="_blank" rel="noopener noreferrer">Play with Kubernetes</a>
          <div class="link-desc">Spin up a temporary cluster in the browser; good for quick tests.</div>
        </li>
        <li>
          <a href="https://kubernetes.io/docs/tutorials/kubernetes-basics/" target="_blank"
            rel="noopener noreferrer">Kubernetes Basics (official)</a>
          <div class="link-desc">Official interactive tutorial with an in-browser terminal.</div>
        </li>
      </ul>

      <h3>Practice scenarios (try yourself, then reveal solution)</h3>

      <div class="playground-scenario">
        <h4>Scenario 1: Deployment and Service</h4>
        <p class="playground-context">Namespace <code>app</code> exists. Create a deployment and expose it.</p>
        <p class="playground-task"><strong>Task:</strong> Create a deployment named <code>nginx-deploy</code> with
          image
          <code>nginx:1.21</code>, 3 replicas. Expose it as a ClusterIP service <code>nginx-svc</code> on port 80. Use
          namespace <code>app</code>.
        </p>
        <button type="button" class="playground-toggle" aria-expanded="false">Show solution</button>
        <div class="playground-solution">
          <pre><code>kubectl create deployment nginx-deploy --image=nginx:1.21 --replicas=3 -n app
kubectl expose deployment nginx-deploy --name=nginx-svc --port=80 -n app
kubectl get deploy,svc -n app</code></pre>
        </div>
      </div>

      <div class="playground-scenario">
        <h4>Scenario 2: ConfigMap and Pod</h4>
        <p class="playground-context">You need a pod that reads a config value from a ConfigMap.</p>
        <p class="playground-task"><strong>Task:</strong> Create a ConfigMap <code>app-cm</code> with
          <code>APP_ENV=production</code>. Create a pod <code>busybox-cm</code> (image <code>busybox:1.28</code>) that
          runs <code>sleep 3600</code> and has environment variable <code>APP_ENV</code> from the ConfigMap.
        </p>
        <button type="button" class="playground-toggle" aria-expanded="false">Show solution</button>
        <div class="playground-solution">
          <pre><code>kubectl create configmap app-cm --from-literal=APP_ENV=production
kubectl run busybox-cm --image=busybox:1.28 --restart=Never -- sleep 3600 --overrides='
{"spec":{"containers":[{"name":"busybox-cm","image":"busybox:1.28","command":["sleep","3600"],"env":[{"name":"APP_ENV","valueFrom":{"configMapKeyRef":{"name":"app-cm","key":"APP_ENV"}}}]}]}}'</code></pre>
          <p style="margin-top:0.75rem;font-size:0.9rem;">Or create a YAML file with <code>env</code> and
            <code>valueFrom.configMapKeyRef</code> and <code>kubectl apply -f</code>.
          </p>
        </div>
      </div>

      <div class="playground-scenario">
        <h4>Scenario 3: Node selector and drain</h4>
        <p class="playground-context">Node <code>worker-1</code> has label <code>disk=ssd</code>. You need to run a
          pod
          there and later drain the node.</p>
        <p class="playground-task"><strong>Task:</strong> Create a pod <code>ssd-pod</code> (image
          <code>nginx:alpine</code>) that is scheduled only on nodes with <code>disk=ssd</code>. Then cordon and drain
          <code>worker-1</code> (ignore DaemonSet pods).
        </p>
        <button type="button" class="playground-toggle" aria-expanded="false">Show solution</button>
        <div class="playground-solution">
          <pre><code>kubectl run ssd-pod --image=nginx:alpine --restart=Never --overrides='
{"spec":{"nodeSelector":{"disk":"ssd"}}}'
kubectl cordon worker-1
kubectl drain worker-1 --ignore-daemonsets --delete-emptydir-data</code></pre>
        </div>
      </div>

      <!-- 15 Mock Exams -->
      <h2 id="section-15">15 — Mock Exams</h2>
      <p>Time yourself (e.g. 10–15 minutes per question). Complete the task in your cluster or playground, then check
        the solution.</p>

      <div class="mock-question">
        <h4>Mock 1: RBAC — read-only pods in a namespace</h4>
        <p class="mock-context">Namespace <code>dev</code> exists. A user/service account should only list and get
          pods
          in <code>dev</code>, no create/delete.</p>
        <p class="mock-task"><strong>Task:</strong> Create a Role that allows <code>get</code>, <code>list</code> on
          <code>pods</code> in namespace <code>dev</code>. Create a RoleBinding binding that Role to a user named
          <code>jane</code>.
        </p>
        <button type="button" class="solution-toggle" aria-expanded="false">Show solution</button>
        <div class="mock-solution">
          <pre><code>kubectl create role pod-reader --verb=get,list --resource=pods -n dev
kubectl create rolebinding jane-pod-reader --role=pod-reader --user=jane -n dev</code></pre>
          <p style="margin-top:0.5rem;font-size:0.9rem;">Or apply YAML with <code>kind: Role</code> (rules with
            apiGroups <code>[""]</code>, resources <code>["pods"]</code>, verbs <code>["get","list"]</code>) and
            <code>kind: RoleBinding</code> (roleRef, subjects with name <code>jane</code>).
          </p>
        </div>
      </div>

      <div class="mock-question">
        <h4>Mock 2: Multi-container pod and logs</h4>
        <p class="mock-context">A pod has two containers: <code>main</code> and <code>sidecar</code>. It is failing
          and
          you need to inspect the previous instance’s logs.</p>
        <p class="mock-task"><strong>Task:</strong> Write the exact <code>kubectl logs</code> command to stream logs
          from the <strong>previous</strong> instance of the <code>sidecar</code> container in pod
          <code>myapp-pod</code> (namespace <code>default</code>).
        </p>
        <button type="button" class="solution-toggle" aria-expanded="false">Show solution</button>
        <div class="mock-solution">
          <pre><code>kubectl logs myapp-pod -c sidecar --previous -f</code></pre>
          <p style="margin-top:0.5rem;font-size:0.9rem;"><code>-c sidecar</code> selects the container,
            <code>--previous</code> shows the crashed/previous instance, <code>-f</code> streams.
          </p>
        </div>
      </div>

      <div class="mock-question">
        <h4>Mock 3: Static pod</h4>
        <p class="mock-context">The control plane uses static pods. You need to run a static pod that runs
          <code>busybox</code> with <code>sleep 3600</code>.
        </p>
        <p class="mock-task"><strong>Task:</strong> Create a static pod manifest (YAML) named
          <code>static-busybox</code> on the control plane node. Assume the static pod path is
          <code>/etc/kubernetes/manifests</code>. Provide the manifest path and key fields.
        </p>
        <button type="button" class="solution-toggle" aria-expanded="false">Show solution</button>
        <div class="mock-solution">
          <pre><code># File: /etc/kubernetes/manifests/static-busybox.yaml
apiVersion: v1
kind: Pod
metadata:
  name: static-busybox
  namespace: default
spec:
  containers:
  - name: busybox
    image: busybox:1.28
    command: ["sleep", "3600"]</code></pre>
          <p style="margin-top:0.5rem;font-size:0.9rem;">Copy this file to the control plane node at
            <code>/etc/kubernetes/manifests/</code>. Kubelet will create the pod. No <code>kubectl apply</code>
            needed.
          </p>
        </div>
      </div>

      <div class="mock-question">
        <h4>Mock 4: Service and endpoints</h4>
        <p class="mock-context">A service <code>web-svc</code> in namespace <code>prod</code> is not getting traffic.
          Pods are running with label <code>app=web</code>.</p>
        <p class="mock-task"><strong>Task:</strong> (1) Check if the service has endpoints. (2) If empty, fix the
          service so it targets pods with label <code>app=web</code>. Assume the service exists but has the wrong
          selector.</p>
        <button type="button" class="solution-toggle" aria-expanded="false">Show solution</button>
        <div class="mock-solution">
          <pre><code>kubectl get endpoints web-svc -n prod
kubectl get svc web-svc -n prod -o yaml   # inspect selector
# Fix: patch or edit so selector is app=web
kubectl patch svc web-svc -n prod -p '{"spec":{"selector":{"app":"web"}}}'
# Or kubectl edit svc web-svc -n prod and set spec.selector.app: web
kubectl get endpoints web-svc -n prod     # should list pod IPs now</code></pre>
        </div>
      </div>

      <div class="mock-question">
        <h4>Mock 5: etcd backup</h4>
        <p class="mock-context">You need to take a snapshot of etcd for disaster recovery. The cluster was set up with
          kubeadm; etcd runs as a pod and listens on <code>https://127.0.0.1:2379</code> with certs under
          <code>/etc/kubernetes/pki/etcd/</code>.
        </p>
        <p class="mock-task"><strong>Task:</strong> Run the <code>etcdctl snapshot save</code> command with the
          correct
          API version, endpoint, and cert flags. Save to <code>/tmp/etcd-snapshot.db</code>.</p>
        <button type="button" class="solution-toggle" aria-expanded="false">Show solution</button>
        <div class="mock-solution">
          <pre><code>ETCDCTL_API=3 etcdctl snapshot save /tmp/etcd-snapshot.db \
  --endpoints=https://127.0.0.1:2379 \
  --cacert=/etc/kubernetes/pki/etcd/ca.crt \
  --cert=/etc/kubernetes/pki/etcd/server.crt \
  --key=/etc/kubernetes/pki/etcd/server.key</code></pre>
          <p style="margin-top:0.5rem;font-size:0.9rem;">Run from the control plane node (or from inside the etcd
            pod).
            Verify with <code>ETCDCTL_API=3 etcdctl snapshot status /tmp/etcd-snapshot.db</code>.</p>
        </div>
      </div>

      <div class="mock-question">
        <h4>Mock 6: PV and PVC binding</h4>
        <p class="mock-context">You need to create a PersistentVolume and a PersistentVolumeClaim, then mount it in a
          pod.</p>
        <p class="mock-task"><strong>Task:</strong> Create a PV named <code>pv-log</code> with 100Mi capacity,
          accessMode <code>ReadWriteMany</code>, hostPath <code>/pv/log</code>. Create a PVC named
          <code>claim-log-1</code> requesting 50Mi with <code>ReadWriteMany</code>. Create a pod <code>logger</code>
          (image <code>nginx</code>) mounting the PVC at <code>/var/log/nginx</code>.
        </p>
        <button type="button" class="solution-toggle" aria-expanded="false">Show solution</button>
        <div class="mock-solution">
          <pre><code># pv.yaml
apiVersion: v1
kind: PersistentVolume
metadata:
  name: pv-log
spec:
  capacity:
    storage: 100Mi
  accessModes:
  - ReadWriteMany
  hostPath:
    path: /pv/log
---
# pvc.yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: claim-log-1
spec:
  accessModes:
  - ReadWriteMany
  resources:
    requests:
      storage: 50Mi
---
# pod.yaml
apiVersion: v1
kind: Pod
metadata:
  name: logger
spec:
  containers:
  - name: nginx
    image: nginx
    volumeMounts:
    - mountPath: /var/log/nginx
      name: log-vol
  volumes:
  - name: log-vol
    persistentVolumeClaim:
      claimName: claim-log-1</code></pre>
          <pre><code>kubectl apply -f pv.yaml -f pvc.yaml -f pod.yaml
kubectl get pv,pvc,pod</code></pre>
        </div>
      </div>

      <div class="mock-question">
        <h4>Mock 7: NetworkPolicy — deny all ingress</h4>
        <p class="mock-context">Namespace <code>secure</code> exists with pods labeled <code>app=db</code>. You need
          to
          deny all ingress traffic except from pods labeled <code>app=api</code> on port 5432.</p>
        <p class="mock-task"><strong>Task:</strong> Create a NetworkPolicy in namespace <code>secure</code> that
          selects
          pods with label <code>app=db</code>, denies all ingress, and only allows ingress from pods with
          <code>app=api</code> on TCP port 5432.
        </p>
        <button type="button" class="solution-toggle" aria-expanded="false">Show solution</button>
        <div class="mock-solution">
          <pre><code>apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: db-policy
  namespace: secure
spec:
  podSelector:
    matchLabels:
      app: db
  policyTypes:
  - Ingress
  ingress:
  - from:
    - podSelector:
        matchLabels:
          app: api
    ports:
    - protocol: TCP
      port: 5432</code></pre>
          <pre><code>kubectl apply -f netpol.yaml
kubectl get networkpolicy -n secure
kubectl describe netpol db-policy -n secure</code></pre>
        </div>
      </div>

      <div class="mock-question">
        <h4>Mock 8: Cluster upgrade (kubeadm)</h4>
        <p class="mock-context">Your cluster runs v1.30.0. You need to upgrade the control plane to v1.31.0.</p>
        <p class="mock-task"><strong>Task:</strong> Upgrade kubeadm, then the control plane, then kubelet and kubectl
          on
          the control plane node. Show the commands in order.</p>
        <button type="button" class="solution-toggle" aria-expanded="false">Show solution</button>
        <div class="mock-solution">
          <pre><code># 1. Upgrade kubeadm
sudo apt-mark unhold kubeadm
sudo apt-get update && sudo apt-get install -y kubeadm=1.31.0-*
sudo apt-mark hold kubeadm

# 2. Plan and apply
sudo kubeadm upgrade plan
sudo kubeadm upgrade apply v1.31.0

# 3. Drain the node
kubectl drain &lt;control-plane-node&gt; --ignore-daemonsets

# 4. Upgrade kubelet and kubectl
sudo apt-mark unhold kubelet kubectl
sudo apt-get install -y kubelet=1.31.0-* kubectl=1.31.0-*
sudo apt-mark hold kubelet kubectl
sudo systemctl daemon-reload
sudo systemctl restart kubelet

# 5. Uncordon
kubectl uncordon &lt;control-plane-node&gt;
kubectl get nodes</code></pre>
        </div>
      </div>

      <div class="mock-question">
        <h4>Mock 9: Ingress with TLS</h4>
        <p class="mock-context">Service <code>webapp-svc</code> exists on port 80 in namespace <code>apps</code>. You
          have a TLS cert and key.</p>
        <p class="mock-task"><strong>Task:</strong> Create a TLS secret <code>webapp-tls</code> and an Ingress
          <code>webapp-ingress</code> that terminates TLS on host <code>webapp.example.com</code> and routes to
          <code>webapp-svc</code>.
        </p>
        <button type="button" class="solution-toggle" aria-expanded="false">Show solution</button>
        <div class="mock-solution">
          <pre><code># Create TLS secret
kubectl create secret tls webapp-tls --cert=tls.crt --key=tls.key -n apps

# Ingress YAML
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: webapp-ingress
  namespace: apps
spec:
  tls:
  - hosts:
    - webapp.example.com
    secretName: webapp-tls
  rules:
  - host: webapp.example.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: webapp-svc
            port:
              number: 80</code></pre>
        </div>
      </div>

      <div class="mock-question">
        <h4>Mock 10: JSONPath and sorting</h4>
        <p class="mock-context">You need to extract specific information from the cluster using JSONPath.</p>
        <p class="mock-task"><strong>Task:</strong> (1) List all node names sorted by CPU capacity. (2) Output a
          custom-columns table showing pod name and container image for all pods in all namespaces. (3) Get the
          InternalIP of all nodes.</p>
        <button type="button" class="solution-toggle" aria-expanded="false">Show solution</button>
        <div class="mock-solution">
          <pre><code># 1. Nodes sorted by CPU
kubectl get nodes --sort-by=.status.capacity.cpu

# 2. Custom columns: pod name + image
kubectl get pods -A -o=custom-columns='NAME:.metadata.name,IMAGE:.spec.containers[*].image'

# 3. InternalIP of all nodes
kubectl get nodes -o jsonpath='{.items[*].status.addresses[?(@.type=="InternalIP")].address}'

# Alternative using range for formatted output:
kubectl get nodes -o jsonpath='{range .items[*]}{.metadata.name}{"\t"}{.status.addresses[?(@.type=="InternalIP")].address}{"\n"}{end}'</code></pre>
        </div>
      </div>

      <h2 id="section-16">16 — Ultimate Mocks</h2>
      <p>Extended scenario-based mocks: multi-step troubleshooting, storage (PV/PVC), networking (NetworkPolicy,
        Ingress), and cluster upgrades. Use the same format: try the scenario in a playground, then compare with the
        solutions in the course docs or your notes.</p>
      <p><strong>Ultimate mock strategy:</strong> Set a 2-hour timer, attempt all questions sequentially. Flag hard
        questions and return to them. Prioritize high-weight questions (troubleshooting = 30%). Practice with
        Killer.sh
        (free retake included with CKA exam purchase).</p>

      <h2 id="section-17">17 — Tips and Tricks</h2>
      <h3>Exam environment setup (do this first!)</h3>
      <p>The CKA exam uses a browser-based terminal. Set up shortcuts immediately:</p>
      <div class="snippet-label">Shell aliases and settings (~/.bashrc)</div>
      <pre><code># Essential aliases — set these at the START of the exam
alias k=kubectl
alias kn='kubectl config set-context --current --namespace'
alias kgp='kubectl get pods'
alias kgs='kubectl get svc'
alias kgn='kubectl get nodes'
alias kga='kubectl get all'
alias kaf='kubectl apply -f'
alias kdp='kubectl describe pod'
alias kl='kubectl logs'
alias ke='kubectl exec -it'

# Enable kubectl autocompletion
source <(kubectl completion bash)
complete -o default -F __start_kubectl k

# Set default editor
export KUBE_EDITOR=vi
# or
export EDITOR=vi</code></pre>
      <div class="snippet-label">Vim settings (~/.vimrc)</div>
      <pre><code># Paste this into ~/.vimrc for YAML editing
set tabstop=2
set shiftwidth=2
set expandtab
set number
set autoindent</code></pre>

      <h3>Time management</h3>
      <ul>
        <li><strong>2 hours, ~17 questions.</strong> Average ~7 minutes per question.</li>
        <li><strong>Don't get stuck:</strong> Flag difficult questions, move on, come back.</li>
        <li><strong>High-weight first:</strong> Prioritize questions worth more marks.</li>
        <li><strong>Use imperative commands:</strong> Faster than writing YAML from scratch.</li>
        <li><strong>Bookmark the docs:</strong> Kubernetes.io docs are allowed. Pre-bookmark key pages.</li>
      </ul>

      <h3>Essential bookmarks for the exam</h3>
      <ul>
        <li><a href="https://kubernetes.io/docs/reference/kubectl/cheatsheet/" target="_blank" rel="noopener">kubectl
            Cheat Sheet</a></li>
        <li><a href="https://kubernetes.io/docs/concepts/" target="_blank" rel="noopener">Concepts</a> → Workloads,
          Services, Storage, Config</li>
        <li><a href="https://kubernetes.io/docs/tasks/" target="_blank" rel="noopener">Tasks</a> → Administer a
          Cluster,
          Manage TLS, Configure Pods</li>
        <li><a href="https://kubernetes.io/docs/reference/" target="_blank" rel="noopener">API Reference</a></li>
      </ul>

      <h3>Test pods for networking</h3>
      <p>Run a temporary pod for DNS/connectivity tests:
        <code>kubectl run dnsutils --image=busybox:1.28 --restart=Never --rm -it -- nslookup kubernetes.default.svc.cluster.local</code>.
        For a long-lived debug pod:
        <code>kubectl run debug --image=nicolaka/netshoot -it --rm --restart=Never -- bash</code>.
      </p>

      <h3>Useful one-liners</h3>
      <pre><code># All pods with node info
kubectl get pods -A -o wide

# Events sorted by time
kubectl get events -A --sort-by='.lastTimestamp'

# Node resource usage
kubectl describe node | grep -A5 "Allocated resources"

# Set default namespace
kubectl config set-context --current --namespace=&lt;ns&gt;

# Find which node a pod runs on
kubectl get pod &lt;name&gt; -o jsonpath='{.spec.nodeName}'

# Watch pods (live updates)
kubectl get pods -w

# Delete a pod stuck in Terminating
kubectl delete pod &lt;name&gt; --force --grace-period=0

# Get all images running in the cluster
kubectl get pods -A -o jsonpath='{range .items[*]}{.spec.containers[*].image}{"\n"}{end}' | sort | uniq

# Check component statuses
kubectl get componentstatuses   # may be deprecated
kubectl get --raw='/readyz?verbose'

# Quick pod for testing
kubectl run tmp --image=busybox:1.28 --rm -it --restart=Never -- sh

# Decode a secret
kubectl get secret &lt;name&gt; -o jsonpath='{.data.password}' | base64 --decode

# Find static pod manifests path
ps aux | grep kubelet | grep config
grep staticPodPath /var/lib/kubelet/config.yaml</code></pre>

      <h3>Common exam mistakes to avoid</h3>
      <ul>
        <li>❌ Forgetting to switch context (<code>kubectl config use-context &lt;context&gt;</code>) — each question
          may
          use a different cluster</li>
        <li>❌ Wrong namespace — always check the question for namespace and use <code>-n &lt;ns&gt;</code></li>
        <li>❌ YAML indentation errors — use <code>kubectl apply -f file.yaml</code> and read the error</li>
        <li>❌ Not verifying the answer — always run <code>kubectl get</code> / <code>kubectl describe</code> to
          confirm
        </li>
        <li>❌ Spending too long on one question — flag it and move on</li>
        <li>❌ Forgetting <code>--dry-run=client -o yaml</code> — the fastest way to generate templates</li>
      </ul>

      <!--18 Cheat Sheet -->
      <h2 id="section-18">18 — CKA Exam Cheat Sheet</h2>
      <p>Quick-reference cards for every exam domain. Print this section or keep it open during practice sessions.
        Each
        card contains the most commonly tested commands and YAML patterns from exam dumps.</p>

      <div class="cheat-grid">

        <div class="cheat-card">
          <div class="cheat-card-header">
            <h4>kubectl Quick Reference</h4>
          </div>
          <div class="cheat-card-body">
            <pre><code># Create resources fast
k run pod1 --image=nginx
k create deploy d1 --image=nginx --replicas=3
k expose deploy d1 --port=80 --name=d1-svc
k create ns dev
k create sa my-sa
k create cm cfg --from-literal=k=v
k create secret generic s1 --from-literal=p=s
k create job j1 --image=busybox -- echo hi
k create cronjob cj --image=b --schedule="* * * * *" -- sh

# Generate YAML
k run x --image=nginx --dry-run=client -o yaml > x.yaml
k create deploy x --image=nginx --dry-run=client -o yaml

# Inspect
k get pods -A -o wide
k describe pod &lt;name&gt;
k logs &lt;pod&gt; -c &lt;container&gt; --previous
k exec -it &lt;pod&gt; -- sh
k get events --sort-by='.lastTimestamp'

# Edit / Patch / Replace
k edit deploy &lt;name&gt;
k patch svc s1 -p '{"spec":{"type":"NodePort"}}'
k replace --force -f pod.yaml
k delete pod x --force --grace-period=0

# Context & Namespace
k config use-context &lt;ctx&gt;
k config set-context --current --namespace=dev</code></pre>
          </div>
        </div>


        <div class="cheat-card">
          <div class="cheat-card-header">
            <h4>Pod Skeleton</h4>
          </div>
          <div class="cheat-card-body">
            <pre><code>apiVersion: v1
kind: Pod
metadata:
  name: mypod
  namespace: default
  labels:
    app: myapp
spec:
  serviceAccountName: my-sa     # optional
  nodeSelector:                  # optional
    disk: ssd
  tolerations:                   # optional
  - key: "node-role"
    operator: "Exists"
    effect: "NoSchedule"
  initContainers:                # optional
  - name: init
    image: busybox
    command: ['sh','-c','sleep 5']
  containers:
  - name: app
    image: nginx:1.21
    ports:
    - containerPort: 80
    env:
    - name: KEY
      value: val
    envFrom:
    - configMapRef:
        name: my-cm
    - secretRef:
        name: my-secret
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 500m
        memory: 256Mi
    livenessProbe:
      httpGet:
        path: /healthz
        port: 80
      initialDelaySeconds: 10
    readinessProbe:
      httpGet:
        path: /ready
        port: 80
    volumeMounts:
    - name: data
      mountPath: /data
    securityContext:
      runAsUser: 1000
      runAsNonRoot: true
      capabilities:
        drop: ["ALL"]
  volumes:
  - name: data
    persistentVolumeClaim:
      claimName: my-pvc
  # OR emptyDir:
  # - name: tmp
  #   emptyDir: {}</code></pre>
          </div>
        </div>


        <div class="cheat-card">
          <div class="cheat-card-header">
            <h4>Deployment + Service</h4>
          </div>
          <div class="cheat-card-body">
            <pre><code>apiVersion: apps/v1
kind: Deployment
metadata:
  name: webapp
spec:
  replicas: 3
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 0
  selector:
    matchLabels:
      app: webapp
  template:
    metadata:
      labels:
        app: webapp
    spec:
      containers:
      - name: webapp
        image: nginx:1.21
        ports:
        - containerPort: 80
        resources:
          requests:
            cpu: 100m
            memory: 128Mi
---
apiVersion: v1
kind: Service
metadata:
  name: webapp-svc
spec:
  type: NodePort        # or ClusterIP
  selector:
    app: webapp
  ports:
  - port: 80
    targetPort: 80
    nodePort: 30080     # only for NodePort</code></pre>
          </div>
        </div>


        <div class="cheat-card">
          <div class="cheat-card-header">
            <h4>RBAC Pattern</h4>
          </div>
          <div class="cheat-card-body">
            <pre><code># Imperative (fastest in exam)
k create role dev-role \
  --verb=get,list,create,delete \
  --resource=pods -n dev

k create rolebinding dev-bind \
  --role=dev-role --user=jane -n dev

k create clusterrole node-viewer \
  --verb=get,list --resource=nodes

k create clusterrolebinding node-bind \
  --clusterrole=node-viewer --user=jane

# Check permissions
k auth can-i create pods --as=jane -n dev
k auth can-i '*' '*' --as=system:serviceaccount:default:my-sa

# ServiceAccount in pod
spec:
  serviceAccountName: my-sa</code></pre>
          </div>
        </div>


        <div class="cheat-card">
          <div class="cheat-card-header">
            <h4>ETCD Backup & Restore</h4>
          </div>
          <div class="cheat-card-body">
            <pre><code># BACKUP
ETCDCTL_API=3 etcdctl snapshot save /tmp/etcd.db \
  --endpoints=https://127.0.0.1:2379 \
  --cacert=/etc/kubernetes/pki/etcd/ca.crt \
  --cert=/etc/kubernetes/pki/etcd/server.crt \
  --key=/etc/kubernetes/pki/etcd/server.key

# Verify
ETCDCTL_API=3 etcdctl snapshot status /tmp/etcd.db

# RESTORE
ETCDCTL_API=3 etcdctl snapshot restore /tmp/etcd.db \
  --data-dir=/var/lib/etcd-restored

# Then update etcd manifest:
vi /etc/kubernetes/manifests/etcd.yaml
# Change: hostPath.path → /var/lib/etcd-restored
# Wait for etcd pod to restart

# Find etcd certs (from pod spec)
k describe pod etcd-master -n kube-system | grep -A5 cert</code></pre>
          </div>
        </div>


        <div class="cheat-card">
          <div class="cheat-card-header">
            <h4>Cluster Upgrade Sequence</h4>
          </div>
          <div class="cheat-card-body">
            <pre><code># === CONTROL PLANE ===
apt-mark unhold kubeadm
apt-get update && apt-get install -y kubeadm=1.XX.0-*
apt-mark hold kubeadm
kubeadm upgrade plan
kubeadm upgrade apply v1.XX.0
kubectl drain &lt;cp-node&gt; --ignore-daemonsets
apt-mark unhold kubelet kubectl
apt-get install -y kubelet=1.XX.0-* kubectl=1.XX.0-*
apt-mark hold kubelet kubectl
systemctl daemon-reload && systemctl restart kubelet
kubectl uncordon &lt;cp-node&gt;

# === WORKER NODES ===
kubectl drain &lt;worker&gt; --ignore-daemonsets
# SSH to worker:
apt-mark unhold kubeadm kubelet
apt-get install -y kubeadm=1.XX.0-* kubelet=1.XX.0-*
kubeadm upgrade node
systemctl daemon-reload && systemctl restart kubelet
apt-mark hold kubeadm kubelet
# Back on control plane:
kubectl uncordon &lt;worker&gt;</code></pre>
          </div>
        </div>


        <div class="cheat-card">
          <div class="cheat-card-header">
            <h4>Storage: PV + PVC + SC</h4>
          </div>
          <div class="cheat-card-body">
            <pre><code># PersistentVolume
apiVersion: v1
kind: PersistentVolume
metadata:
  name: pv1
spec:
  capacity:
    storage: 1Gi
  accessModes: [ReadWriteOnce]
  persistentVolumeReclaimPolicy: Retain
  hostPath:
    path: /mnt/data
---
# PersistentVolumeClaim
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: pvc1
spec:
  accessModes: [ReadWriteOnce]
  resources:
    requests:
      storage: 500Mi
  storageClassName: ""   # empty = static binding
---
# StorageClass (dynamic)
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: fast
provisioner: kubernetes.io/gce-pd
parameters:
  type: pd-ssd
reclaimPolicy: Delete
allowVolumeExpansion: true

# Mount in pod:
  volumes:
  - name: data
    persistentVolumeClaim:
      claimName: pvc1
  containers:
  - volumeMounts:
    - mountPath: /data
      name: data</code></pre>
          </div>
        </div>


        <div class="cheat-card">
          <div class="cheat-card-header">
            <h4>Networking Cheat Sheet</h4>
          </div>
          <div class="cheat-card-body">
            <pre><code># NetworkPolicy (allow specific ingress)
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-api
  namespace: prod
spec:
  podSelector:
    matchLabels:
      app: db
  policyTypes: [Ingress, Egress]
  ingress:
  - from:
    - podSelector:
        matchLabels:
          app: api
    - namespaceSelector:
        matchLabels:
          env: prod
    ports:
    - port: 3306
  egress:
  - to:
    - podSelector:
        matchLabels:
          app: cache
    ports:
    - port: 6379

# Ingress
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: app-ingress
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
spec:
  rules:
  - host: app.example.com
    http:
      paths:
      - path: /api
        pathType: Prefix
        backend:
          service:
            name: api-svc
            port:
              number: 80</code></pre>
          </div>
        </div>


        <div class="cheat-card">
          <div class="cheat-card-header">
            <h4>Troubleshooting Checklist</h4>
          </div>
          <div class="cheat-card-body">
            <pre><code># 1. Check nodes
k get nodes
k describe node &lt;node&gt;  # conditions, taints

# 2. Check control plane pods
k get pods -n kube-system
k logs kube-apiserver-master -n kube-system
k logs kube-scheduler-master -n kube-system

# 3. Check kubelet (on node)
systemctl status kubelet
journalctl -u kubelet -f
cat /var/lib/kubelet/config.yaml

# 4. Check service &amp; endpoints
k get svc,endpoints &lt;svc-name&gt;
# If endpoints empty → wrong selector

# 5. Pod debugging
k get pods -o wide
k describe pod &lt;name&gt;   # check Events
k logs &lt;pod&gt; --previous
k exec -it &lt;pod&gt; -- sh

# 6. DNS test
k run dns-test --image=busybox:1.28 --rm -it \
  --restart=Never -- nslookup kubernetes

# 7. Network test
k run net-test --image=nicolaka/netshoot \
  --rm -it --restart=Never -- bash

# 8. Certificate check
openssl x509 -in /etc/kubernetes/pki/apiserver.crt \
  -text -noout | grep -A2 Validity</code></pre>
          </div>
        </div>


        <div class="cheat-card">
          <div class="cheat-card-header">
            <h4>DaemonSet / Job / CronJob</h4>
          </div>
          <div class="cheat-card-body">
            <pre><code># DaemonSet
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: log-agent
spec:
  selector:
    matchLabels:
      app: log-agent
  template:
    metadata:
      labels:
        app: log-agent
    spec:
      containers:
      - name: agent
        image: fluentd
---
# Job (run to completion)
apiVersion: batch/v1
kind: Job
metadata:
  name: pi-job
spec:
  completions: 3
  parallelism: 2
  backoffLimit: 4
  template:
    spec:
      containers:
      - name: pi
        image: perl
        command: ["perl","-Mbignum=bpi",
                  "-wle","print bpi(2000)"]
      restartPolicy: Never
---
# CronJob
apiVersion: batch/v1
kind: CronJob
metadata:
  name: backup
spec:
  schedule: "0 2 * * *"
  successfulJobsHistoryLimit: 3
  failedJobsHistoryLimit: 1
  jobTemplate:
    spec:
      template:
        spec:
          containers:
          - name: backup
            image: busybox
            command: ["/bin/sh","-c","date"]
          restartPolicy: OnFailure</code></pre>
          </div>
        </div>


        <div class="cheat-card">
          <div class="cheat-card-header">
            <h4>JSONPath & Output</h4>
          </div>
          <div class="cheat-card-body">
            <pre><code># Single value
k get pod x -o jsonpath='{.spec.nodeName}'

# All pod names
k get pods -o jsonpath='{.items[*].metadata.name}'

# Range (formatted)
k get nodes -o jsonpath='
{range .items[*]}
  {.metadata.name}{"\t"}
  {.status.capacity.cpu}{"\n"}
{end}'

# Filter with condition
k get nodes -o jsonpath='
{.items[*].status.addresses
[?(@.type=="InternalIP")].address}'

# Custom columns
k get pods -A -o custom-columns=\
NAME:.metadata.name,\
NODE:.spec.nodeName,\
IMAGE:.spec.containers[0].image

# Sort
k get pods --sort-by=.metadata.creationTimestamp
k get pv --sort-by=.spec.capacity.storage

# Output to file (exam pattern)
k get nodes -o json > /opt/output.json
k get nodes -o jsonpath='{.items[*].status.nodeInfo.osImage}' > /opt/os.txt

# Count
k get pods -A --no-headers | wc -l</code></pre>
          </div>
        </div>


        <div class="cheat-card">
          <div class="cheat-card-header">
            <h4>CSR / Certificates</h4>
          </div>
          <div class="cheat-card-body">
            <pre><code># Generate key + CSR
openssl genrsa -out user.key 2048
openssl req -new -key user.key \
  -subj "/CN=user/O=group" -out user.csr

# Create K8s CSR object
cat user.csr | base64 | tr -d '\n'

apiVersion: certificates.k8s.io/v1
kind: CertificateSigningRequest
metadata:
  name: user
spec:
  request: &lt;base64-csr&gt;
  signerName: kubernetes.io/kube-apiserver-client
  usages: [client auth]

# Approve &amp; extract
k certificate approve user
k get csr user -o jsonpath='{.status.certificate}' \
  | base64 -d > user.crt

# Add to kubeconfig
k config set-credentials user \
  --client-certificate=user.crt \
  --client-key=user.key
k config set-context user-ctx \
  --cluster=kubernetes --user=user
k config use-context user-ctx</code></pre>
          </div>

        </div><!-- end cheat-grid -->

    </main>
    <aside class="right-sidebar" id="right-sidebar">
      <div class="sidebar-title">Quick Links</div>
      <ul>
        <!-- Add your own links below -->
        <li><a href="#section-13">Other Topics</a></li>
        <li><a href="#section-14">Lightning Labs</a></li>
        <li><a href="#section-15">Mock Exams</a></li>
        <li><a href="#section-16">Ultimate Mocks</a></li>
        <li><a href="#section-17">Tips & Tricks</a></li>
        <li><a href="#section-18">Cheat Sheet</a></li>

      </ul>

    </aside>
  </div>
  <footer class="site-footer">
    CKA Study Guide — Reference for Certified Kubernetes Administrator exam preparation.
    &nbsp;·&nbsp; <span id="footer-stats"></span>
  </footer>

  <!-- Reading Progress Bar -->
  <div id="reading-progress"></div>

  <!-- Toast Container -->
  <div id="toast-container"></div>

  <!-- Search Overlay -->
  <div id="search-overlay" role="dialog" aria-modal="true" aria-label="Search">
    <div id="search-box">
      <div id="search-input-wrap">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round" stroke-linejoin="round">
          <circle cx="11" cy="11" r="8"></circle>
          <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        </svg>
        <input type="text" id="search-input" placeholder="Search topics, commands, concepts…" autocomplete="off"
          spellcheck="false">
        <span id="search-shortcut-hint">ESC to close</span>
      </div>
      <div id="search-results">
        <div id="search-empty">Type to search across all sections…</div>
      </div>
      <div id="search-footer">
        <span><kbd>↑↓</kbd> navigate</span>
        <span><kbd>↵</kbd> open</span>
        <span><kbd>ESC</kbd> close</span>
      </div>
    </div>
  </div>

  <!-- Keyboard Shortcuts Overlay -->
  <div id="shortcuts-overlay" role="dialog" aria-modal="true">
    <div id="shortcuts-box">
      <h2>⌨️ Keyboard Shortcuts</h2>
      <div class="shortcut-grid">
        <div class="shortcut-row"><span class="sc-desc">Search</span><span class="sc-keys"><kbd
              class="sc-key">Ctrl</kbd><kbd class="sc-key">K</kbd></span></div>
        <div class="shortcut-row"><span class="sc-desc">Dark Mode</span><span class="sc-keys"><kbd
              class="sc-key">D</kbd></span></div>
        <div class="shortcut-row"><span class="sc-desc">Next Section</span><span class="sc-keys"><kbd
              class="sc-key">→</kbd></span></div>
        <div class="shortcut-row"><span class="sc-desc">Prev Section</span><span class="sc-keys"><kbd
              class="sc-key">←</kbd></span></div>
        <div class="shortcut-row"><span class="sc-desc">Notes Panel</span><span class="sc-keys"><kbd
              class="sc-key">N</kbd></span></div>
        <div class="shortcut-row"><span class="sc-desc">This panel</span><span class="sc-keys"><kbd
              class="sc-key">?</kbd></span></div>
        <div class="shortcut-row"><span class="sc-desc">Mark Complete</span><span class="sc-keys"><kbd
              class="sc-key">C</kbd></span></div>
        <div class="shortcut-row"><span class="sc-desc">Bookmark Section</span><span class="sc-keys"><kbd
              class="sc-key">B</kbd></span></div>
        <div class="shortcut-row"><span class="sc-desc">Font Bigger</span><span class="sc-keys"><kbd
              class="sc-key">+</kbd></span></div>
        <div class="shortcut-row"><span class="sc-desc">Font Smaller</span><span class="sc-keys"><kbd
              class="sc-key">-</kbd></span></div>
        <div class="shortcut-row"><span class="sc-desc">Pomodoro Timer</span><span class="sc-keys"><kbd
              class="sc-key">T</kbd></span></div>
        <div class="shortcut-row"><span class="sc-desc">Close / Back</span><span class="sc-keys"><kbd
              class="sc-key">ESC</kbd></span></div>
      </div>
      <div id="shortcuts-close-hint">Press <kbd class="sc-key">ESC</kbd> or click outside to close</div>
    </div>
  </div>

  <!-- Notes Slide-in Panel -->
  <div id="notes-panel" role="complementary" aria-label="Section Notes">
    <div id="notes-header">
      <h3>📝 Section Notes</h3>
      <button id="notes-close" title="Close notes">×</button>
    </div>
    <div id="notes-section-name">No section selected</div>
    <textarea id="notes-textarea"
      placeholder="Write your notes for this section… They're saved automatically."></textarea>
    <div id="notes-footer">
      <span id="notes-char-count">0 characters</span>
      <button id="notes-export-btn" title="Export all notes as Markdown">⬇ Export</button>
      <button id="notes-save-btn">Save ✓</button>
    </div>
  </div>



  <!-- Zen Mode Hint -->
  <div id="zen-hint">Press <kbd>Z</kbd> or move mouse to top to show header &nbsp;·&nbsp; Press <kbd>Z</kbd> again to
    exit Zen Mode</div>

  <!-- Text Highlight Toolbar -->
  <div id="highlight-toolbar">
    <div class="hl-label">Highlight</div>
    <div class="hl-row">
      <div class="hl-swatch" data-color="hl-yellow" style="background:#fde047" title="Yellow"></div>
      <div class="hl-swatch" data-color="hl-green" style="background:#86efac" title="Green"></div>
      <div class="hl-swatch" data-color="hl-pink" style="background:#f9a8d4" title="Pink"></div>
      <div class="hl-swatch" data-color="hl-blue" style="background:#93c5fd" title="Blue"></div>
      <button class="hl-clear" id="hl-clear-btn" title="Remove highlight">✕</button>
    </div>
  </div>

  <!-- Mini Section TOC -->
  <div id="mini-toc">
    <div id="mini-toc-title">📍 On this page</div>
    <ul id="mini-toc-list"></ul>
  </div>

  <!-- CKA Quiz Overlay -->
  <div id="quiz-overlay" role="dialog" aria-modal="true" aria-label="CKA Quiz">
    <div id="quiz-box">
      <div id="quiz-header">
        <h2>⚡ CKA Quick Quiz</h2>
        <button id="quiz-close" title="Close quiz">×</button>
      </div>
      <div id="quiz-progress-bar">
        <div id="quiz-progress-fill" style="width:0%"></div>
      </div>
      <div id="quiz-question"></div>
      <div id="quiz-options"></div>
      <div id="quiz-explanation"></div>
      <div id="quiz-nav">
        <span id="quiz-score">Question 1 of 15</span>
        <button id="quiz-next">Next →</button>
      </div>
      <div id="quiz-results">
        <div class="result-score" id="quiz-final-score"></div>
        <p id="quiz-result-msg"></p>
        <button id="quiz-restart">🔄 Try Again</button>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // ── Core Variables ────────────────────────────────────────────────
      var main = document.querySelector('main');
      var headerH = 56;

      // ── Helper Functions ──────────────────────────────────────────────
      function smoothScrollTo(el) {
        if (!el) return;
        // Immediate snap to top with offset for header (40px) + buffer (10px)
        var offset = 50;
        var targetY = el.getBoundingClientRect().top + main.scrollTop - offset;

        main.scrollTo({
          top: targetY,
          behavior: 'auto'
        });
      }

      function wrapContentBlocks() {
        if (!main) return;
        var intro = document.getElementById('intro');
        if (intro && !document.getElementById('block-intro')) {
          var blockIntro = document.createElement('div');
          blockIntro.id = 'block-intro';
          blockIntro.className = 'content-block is-open';
          intro.parentNode.insertBefore(blockIntro, intro);
          blockIntro.appendChild(intro);
        }
        main.querySelectorAll('h2[id^="section-"]').forEach(function (h2) {
          var id = h2.getAttribute('id');
          if (document.getElementById('block-' + id)) return; // already wrapped

          var block = document.createElement('div');
          block.id = 'block-' + id;
          block.className = 'content-block';
          var nodes = [h2];
          var next = h2.nextElementSibling;
          while (next && next.tagName !== 'H2') {
            nodes.push(next);
            next = next.nextElementSibling;
          }
          h2.parentNode.insertBefore(block, h2);
          nodes.forEach(function (node) { block.appendChild(node); });
        });
      }

      function openBlock(block, skipScroll) {
        if (!block) return;

        // 1. Instantly hide ALL other blocks
        main.querySelectorAll('.content-block').forEach(function (b) {
          if (b !== block) {
            b.classList.remove('is-open');
            b.style.display = 'none'; // Force hide immediately
          }
        });

        // 2. Open current block
        if (!block.classList.contains('is-open')) {
          block.style.display = 'block';
          block.classList.add('is-open');
        }

        // 3. Scroll to top (only if not skipping)
        if (!skipScroll) {
          main.scrollTop = 0; // Reset scroll for cleaner jump
        }
      }

      // ── Initialization & Event Listeners ──────────────────────────────
      document.addEventListener('DOMContentLoaded', function () {

        // 1. Wrap Content
        wrapContentBlocks();

        // 2. Mobile Nav Controls
        var navToggle = document.getElementById('nav-toggle');
        var navClose = document.getElementById('nav-close');
        var nav = document.getElementById('nav');

        function closeMobileNav() {
          nav.classList.remove('is-open');
          if (navToggle) navToggle.setAttribute('aria-label', 'Open menu');
        }

        if (navClose) navClose.addEventListener('click', closeMobileNav);
        if (navToggle && nav) {
          navToggle.addEventListener('click', function (e) {
            e.stopPropagation(); // Prevent immediate close
            nav.classList.toggle('is-open');
            var isOpen = nav.classList.contains('is-open');
            navToggle.setAttribute('aria-label', isOpen ? 'Close menu' : 'Open menu');
            navToggle.setAttribute('aria-expanded', isOpen);
          });
          // Close mob nav when clicking outside
          document.addEventListener('click', function (e) {
            if (nav.classList.contains('is-open') && !nav.contains(e.target) && e.target !== navToggle && !navToggle.contains(e.target))
              closeMobileNav();
          });
        }

        // 3. Desktop Focus Mode Toggles
        const layout = document.querySelector('.layout');
        const toggleLeftBtn = document.getElementById('toggle-left');
        const toggleRightBtn = document.getElementById('toggle-right');

        if (toggleLeftBtn) {
          toggleLeftBtn.addEventListener('click', () => {
            layout.classList.toggle('nav-hidden');
            toggleLeftBtn.classList.toggle('active-toggle');
            // Recalc scroll position if needed
          });
        }

        if (toggleRightBtn) {
          toggleRightBtn.addEventListener('click', () => {
            layout.classList.toggle('sidebar-hidden');
            toggleRightBtn.classList.toggle('active-toggle');
          });
        }

        // 4. Generate Submenus & Attach Listeners
        const navMap = {};
        document.querySelectorAll('h2[id^="section-"]').forEach(h2 => {
          const sectionId = h2.getAttribute('id');
          navMap[sectionId] = [];

          // Use the wrapping block div (if already wrapped) or fall back to
          // sibling-walk. querySelectorAll on the block finds H3s at any depth.
          const blockEl = document.getElementById('block-' + sectionId);
          const searchRoot = blockEl || h2.parentNode;
          searchRoot.querySelectorAll('h3').forEach(h3 => {
            if (!h3.id) {
              const text = h3.textContent.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)/g, '');
              h3.id = sectionId + '-' + text;
            }
            navMap[sectionId].push({ id: h3.id, text: h3.textContent });
          });
        });

        // Loop through MAIN nav links to wrap + add listeners
        nav.querySelectorAll('a[href^="#"]').forEach(link => {
          const href = link.getAttribute('href');
          if (href === '#') return;
          const id = href.substring(1);

          // Main Link Click Handler (Accordion Behavior)
          link.addEventListener('click', function (e) {
            e.preventDefault();
            closeMobileNav();

            // handle active state styling
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            if (this.parentNode.classList.contains('nav-item')) {
              this.parentNode.classList.add('active');
            }

            // Open Block
            var blockId = id === 'intro' ? 'block-intro' : 'block-' + id;
            var block = document.getElementById(blockId);
            if (block) openBlock(block);
          });

          // Submenu Generation (only for #section- links)
          if (id.startsWith('section-')) {
            if (link.parentNode.classList.contains('nav-item')) return; // already processed

            const wrapper = document.createElement('div');
            wrapper.className = 'nav-item';
            link.parentNode.insertBefore(wrapper, link);
            wrapper.appendChild(link);

            if (navMap[id] && navMap[id].length > 0) {
              const subMenu = document.createElement('div');
              subMenu.className = 'nav-submenu';
              navMap[id].forEach(item => {
                const subLink = document.createElement('a');
                subLink.href = '#' + item.id;
                subLink.className = 'nav-sub-link';
                subLink.textContent = item.text;
                subLink.addEventListener('click', (e) => {
                  e.preventDefault();
                  closeMobileNav();
                  e.stopPropagation(); // prevent bubbling to parent

                  // Ensure parent block is open, but DON'T scroll to top yet
                  const blockId = 'block-' + id;
                  const block = document.getElementById(blockId);

                  if (block) {
                    openBlock(block, true); // true = skip scroll to top

                    // Now scroll to the specific subsection
                    // Slight delay ensuring layout is stable
                    setTimeout(() => {
                      const target = document.getElementById(item.id);
                      smoothScrollTo(target);
                    }, 10);
                  }
                });
                subMenu.appendChild(subLink);
              });
              wrapper.appendChild(subMenu);
            }
          }
        });

        // Right Sidebar Links
        var rs = document.getElementById('right-sidebar');
        if (rs) {
          rs.querySelectorAll('a[href^="#"]').forEach(function (a) {
            a.addEventListener('click', function (ev) {
              ev.preventDefault();
              var href = a.getAttribute('href');
              var id = href.substring(1);
              var blockId = id === 'intro' ? 'block-intro' : 'block-' + id;
              var block = document.getElementById(blockId);
              if (block) openBlock(block);
            });
          });
        }

        // Challenge Mode Toggle
        var challengeToggle = document.getElementById('challenge-toggle');
        if (challengeToggle) {
          challengeToggle.addEventListener('change', function () {
            if (this.checked) {
              document.body.classList.add('challenge-mode-active');
            } else {
              document.body.classList.remove('challenge-mode-active');
            }
          });
        }

        // Code Highlighting
        highlightCodeBlocks();
        initSolutionToggles();
      });

      // ── Syntax Highlighter for ALL Code Blocks ───────────────────────
      function highlightCodeBlocks() {
        document.querySelectorAll('pre').forEach(function (preBlock) {
          // Check if already processed
          if (preBlock.querySelector('.copy-btn')) return;

          // Ensure relative positioning
          if (getComputedStyle(preBlock).position === 'static') {
            preBlock.style.position = 'relative';
          }

          // 1. Create Copy Button
          // 1. Create Copy Button
          const copyBtn = document.createElement('button');
          copyBtn.className = 'copy-btn';
          // Clean SVG Icons
          const iconCopy = '<svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" fill="currentColor"><path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path></svg>';
          const iconCheck = '<svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" fill="currentColor"><path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"></path></svg>';

          copyBtn.innerHTML = iconCopy;
          copyBtn.ariaLabel = 'Copy code to clipboard';
          copyBtn.title = 'Copy';

          copyBtn.addEventListener('click', () => {
            const codeEl = preBlock.querySelector('code');
            const codeText = codeEl ? codeEl.innerText : preBlock.innerText;

            navigator.clipboard.writeText(codeText).then(() => {
              copyBtn.innerHTML = iconCheck;
              copyBtn.classList.add('copied');
              setTimeout(() => {
                copyBtn.innerHTML = iconCopy;
                copyBtn.classList.remove('copied');
              }, 2000);
            }).catch(err => {
              console.error('Failed to copy!', err);
            });
          });

          // Append as FIRST child to ensure it sits on top-right correctly
          if (preBlock.firstChild) {
            preBlock.insertBefore(copyBtn, preBlock.firstChild);
          } else {
            preBlock.appendChild(copyBtn);
          }

          // 2. Highlight Logic
          const codeBlock = preBlock.querySelector('code');
          if (!codeBlock) return;

          var html = codeBlock.textContent;
          // 1. Strings (light blue)
          html = html.replace(/(".*?")/g, '<span class="cs-str">$1</span>');
          // 2. Comments (grey)
          html = html.replace(/(^|\s)(#.*$)/gm, '$1<span class="cs-comment">$2</span>');
          // 3. YAML Keys (green)
          html = html.replace(/^(\s*)([\w\-\.\/]+):/gm, '$1<span class="cs-key">$2</span>:');
          // 4. Keywords
          var kws = 'apiVersion|kind|metadata|spec|status|selector|containers|volumes|template|matchLabels|strategy|replicas|serviceAccountName|nodeSelector|tolerations|resources|requests|limits|livenessProbe|readinessProbe|securityContext|capabilities|env|envFrom|volumeMounts|image|name|kubectl|k'.split('|');
          var kwRegex = new RegExp('\\b(' + kws.join('|') + ')\\b', 'g');
          html = html.replace(kwRegex, '<span class="cs-kw">$1</span>');
          // 5. Flags
          html = html.replace(/(\s)(--[\w\-]+)/g, '$1<span class="cs-flag">$2</span>');
          // 6. Section Headers
          html = html.replace(/(^# ===.*===)/gm, '<span class="cs-section">$1</span>');

          codeBlock.innerHTML = html;
        });
      }

      function initSolutionToggles() {
        document.querySelectorAll('.solution-toggle, .playground-toggle').forEach(function (btn) {
          btn.addEventListener('click', function () {
            var solution = this.nextElementSibling;
            if (!solution) return;
            var isOpen = solution.classList.toggle('is-open');
            this.setAttribute('aria-expanded', isOpen);
            this.textContent = isOpen ? 'Hide solution' : 'Show solution';
          });
        });
      }

      // ─── INTERACTIVE TERMINAL SIMULATOR ─────────────────────────────
      function initTerminal() {
        const termBtn = document.createElement('button');
        termBtn.className = 'term-fab';
        termBtn.innerHTML = '>_';
        termBtn.title = 'Open Terminal Simulator';
        document.body.appendChild(termBtn);

        const termContainer = document.createElement('div');
        termContainer.className = 'term-container';
        termContainer.innerHTML = `
          <div class="term-header">
            <span>user@cka-lab:~$</span>
            <div class="term-controls">
              <span class="term-minimize">_</span>
              <span class="term-close">×</span>
            </div>
          </div>
          <div class="term-body" id="term-body">
            <div class="term-line">Welcome to CKA Simulator v1.0</div>
            <div class="term-line">Type 'help' for available commands.</div>
            <div class="term-input-line">
              <span class="prompt">user@cka-lab:~$</span>
              <input type="text" class="term-input" autofocus>
            </div>
          </div>
        `;
        document.body.appendChild(termContainer);

        const body = termContainer.querySelector('#term-body');
        const input = termContainer.querySelector('.term-input');

        // Toggle Visibility
        termBtn.addEventListener('click', () => {
          termContainer.classList.add('open');
          termBtn.style.display = 'none';
          input.focus();
        });

        termContainer.querySelector('.term-close').addEventListener('click', () => {
          termContainer.classList.remove('open');
          termBtn.style.display = 'flex';
        });

        termContainer.querySelector('.term-minimize').addEventListener('click', () => {
          termContainer.classList.remove('open');
          termBtn.style.display = 'flex';
        });

        // Command Logic
        input.addEventListener('keydown', (e) => {
          if (e.key === 'Enter') {
            const cmd = input.value.trim();
            const cmdLine = document.createElement('div');
            cmdLine.className = 'term-line';
            cmdLine.innerHTML = `<span class="prompt">user@cka-lab:~$</span> ${cmd}`;
            body.insertBefore(cmdLine, input.parentElement); // Insert before input line

            input.value = '';
            processCommand(cmd);

            // Scroll to bottom
            body.scrollTop = body.scrollHeight;
          }
        });

        function processCommand(cmd) {
          let output = '';
          const c = cmd.toLowerCase();

          if (c === 'help') {
            output = `Available commands:
  kubectl get pods
  kubectl get nodes
  kubectl run [name] --image=[image]
  kubectl get svc
  clear`;
          } else if (c === 'clear') {
            body.innerHTML = '';
            const inputLine = document.createElement('div');
            inputLine.className = 'term-input-line';
            inputLine.innerHTML = `<span class="prompt">user@cka-lab:~$</span><input type="text" class="term-input" autofocus>`;
            body.appendChild(inputLine);
            // Re-bind listener to new input (or just clear lines above input)
            // Simpler: Just remove all .term-line elements
            document.querySelectorAll('.term-body > .term-line').forEach(el => el.remove());
            return;
          } else if (c === 'kubectl get pods' || c === 'k get po') {
            output = `NAME      READY   STATUS    RESTARTS   AGE
nginx     1/1     Running   0          5m
webapp    1/1     Running   0          2m
db-pod    0/1     Pending   0          10s`;
          } else if (c === 'kubectl get nodes' || c === 'k get no') {
            output = `NAME       STATUS   ROLES           AGE   VERSION
control    Ready    control-plane   10d   v1.30.0
worker-1   Ready    <none>          10d   v1.30.0
worker-2   Ready    <none>          10d   v1.30.0`;
          } else if (c.startsWith('kubectl run') || c.startsWith('k run')) {
            const parts = c.split(' ');
            const name = parts[2] || 'pod';
            output = `pod/${name} created`;
          } else if (c === '') {
            return;
          } else {
            output = `bash: ${cmd.split(' ')[0]}: command not found`;
          }

          if (output) {
            const outDiv = document.createElement('div');
            outDiv.className = 'term-line output';
            outDiv.innerText = output;
            body.insertBefore(outDiv, input.parentElement);
          }
        }

        // Auto-focus input when clicking anywhere in terminal
        body.addEventListener('click', () => input.focus());
      }

      initTerminal();

      // ══════════════════════════════════════════════════════════════════
      //  ADVANCED FEATURES ENGINE
      // ══════════════════════════════════════════════════════════════════
      (function () {
        'use strict';

        // ── Storage helpers ──────────────────────────────────────────────
        const LS = {
          get: (k, def) => { try { const v = localStorage.getItem('cka_' + k); return v !== null ? JSON.parse(v) : def; } catch (e) { return def; } },
          set: (k, v) => { try { localStorage.setItem('cka_' + k, JSON.stringify(v)); } catch (e) { } }
        };

        // ── Toast ────────────────────────────────────────────────────────
        function toast(msg) {
          const t = document.createElement('div');
          t.className = 'toast';
          t.textContent = msg;
          document.getElementById('toast-container').appendChild(t);
          setTimeout(() => t.remove(), 2700);
        }

        // ── Section index ────────────────────────────────────────────────
        const SECTIONS = Array.from(document.querySelectorAll('h2[id^="section-"]')).map(h => ({
          id: h.id,
          title: h.textContent.trim()
        }));
        let currentSectionIdx = 0;

        function getCurrentBlock() {
          return document.querySelector('.content-block.is-open');
        }
        function getCurrentSectionId() {
          const b = getCurrentBlock();
          return b ? b.id.replace('block-', '') : null;
        }

        // ── Dark Mode ─────────────────────────────────────────────────────
        const dmBtn = document.getElementById('dark-mode-btn');
        const dmMoon = document.getElementById('dm-icon-moon');
        const dmSun = document.getElementById('dm-icon-sun');

        function setDarkMode(dark, save) {
          document.body.classList.toggle('dark-mode', dark);
          dmMoon.style.display = dark ? 'none' : '';
          dmSun.style.display = dark ? '' : 'none';
          if (save) { LS.set('dark', dark); toast(dark ? '🌙 Dark mode on' : '☀️ Light mode on'); }
        }
        setDarkMode(LS.get('dark', false));
        if (dmBtn) dmBtn.addEventListener('click', () => setDarkMode(!document.body.classList.contains('dark-mode'), true));

        // ── Font Size ─────────────────────────────────────────────────────
        let fontSize = LS.get('fontSize', 16);
        function applyFontSize() { document.documentElement.style.fontSize = fontSize + 'px'; LS.set('fontSize', fontSize); }
        applyFontSize();
        const fdBtn = document.getElementById('font-decrease');
        const fiBtn = document.getElementById('font-increase');
        if (fdBtn) fdBtn.addEventListener('click', () => { fontSize = Math.max(12, fontSize - 1); applyFontSize(); toast('Font: ' + fontSize + 'px'); });
        if (fiBtn) fiBtn.addEventListener('click', () => { fontSize = Math.min(22, fontSize + 1); applyFontSize(); toast('Font: ' + fontSize + 'px'); });

        // ── Reading Progress Bar ──────────────────────────────────────────
        const progressBar = document.getElementById('reading-progress');
        function updateReadingProgress() {
          const m = document.querySelector('main');
          if (!m || !progressBar) return;
          const pct = (m.scrollTop / (m.scrollHeight - m.clientHeight)) * 100;
          progressBar.style.width = Math.min(100, pct || 0) + '%';
        }
        const mainEl = document.querySelector('main');
        if (mainEl) mainEl.addEventListener('scroll', updateReadingProgress, { passive: true });

        // ── Progress Tracker ──────────────────────────────────────────────
        let completedSections = LS.get('completed', {});

        function updateProgressUI() {
          const total = SECTIONS.length;
          const done = SECTIONS.filter(s => completedSections[s.id]).length;
          const pct = total > 0 ? Math.round((done / total) * 100) : 0;
          const fill = document.getElementById('progress-fill');
          const pctEl = document.getElementById('progress-pct');
          if (fill) fill.style.width = pct + '%';
          if (pctEl) pctEl.textContent = pct + '%';
          // Update footer stats
          const fs = document.getElementById('footer-stats');
          if (fs) fs.textContent = done + '/' + total + ' sections complete';
          // Update nav check indicators
          document.querySelectorAll('.nav-check').forEach(btn => {
            const sid = btn.dataset.sid;
            btn.classList.toggle('done', !!completedSections[sid]);
          });
        }

        function toggleComplete(sid) {
          completedSections[sid] = !completedSections[sid];
          LS.set('completed', completedSections);
          updateProgressUI();
          updateSectionBar(sid);
          toast(completedSections[sid] ? '✅ Section marked complete!' : '⬜ Section unmarked');
        }

        // Inject check buttons into each .nav-item wrapper after nav is set up
        // We hook into the openBlock callback by observing DOM
        function injectNavChecks() {
          document.querySelectorAll('#nav .nav-item').forEach(wrapper => {
            if (wrapper.querySelector('.nav-check')) return;
            const link = wrapper.querySelector('a[data-sid]');
            const sid = link ? link.dataset.sid : null;
            if (!sid) return;
            const btn = document.createElement('button');
            btn.className = 'nav-check';
            btn.dataset.sid = sid;
            btn.title = 'Mark complete';
            btn.addEventListener('click', e => { e.stopPropagation(); e.preventDefault(); toggleComplete(sid); });
            wrapper.style.position = 'relative';
            wrapper.style.display = 'flex';
            wrapper.style.alignItems = 'center';
            const a = wrapper.querySelector('a');
            if (a) a.style.paddingRight = '1.75rem';
            wrapper.appendChild(btn);
          });
          updateProgressUI();
        }

        // ── Section Action Bar ────────────────────────────────────────────
        let bookmarks = LS.get('bookmarks', {});

        function updateBookmarkUI() {
          const bmList = document.getElementById('bookmarks-list');
          const bmCount = document.getElementById('bm-count');
          const keys = Object.keys(bookmarks).filter(k => bookmarks[k]);
          if (bmCount) bmCount.textContent = keys.length;
          if (!bmList) return;
          if (keys.length === 0) {
            bmList.innerHTML = '<li class="bookmarks-empty">No bookmarks yet</li>';
            return;
          }
          bmList.innerHTML = keys.map(sid => {
            const sec = SECTIONS.find(s => s.id === sid);
            return sec ? `<li><a href="#${sid}" data-bm-sid="${sid}">${sec.title}</a></li>` : '';
          }).join('');
          bmList.querySelectorAll('a[data-bm-sid]').forEach(a => {
            a.addEventListener('click', e => {
              e.preventDefault();
              const block = document.getElementById('block-' + a.dataset.bmSid);
              if (block && window.openBlockGlobal) window.openBlockGlobal(block);
            });
          });
        }

        function updateSectionBar(sid) {
          const bar = document.getElementById('sab-' + sid);
          if (!bar) return;
          const completeBtn = bar.querySelector('.sab-complete');
          const bookmarkBtn = bar.querySelector('.sab-bookmark');
          if (completeBtn) completeBtn.classList.toggle('active', !!completedSections[sid]);
          if (bookmarkBtn) {
            bookmarkBtn.classList.toggle('active', !!bookmarks[sid]);
            bookmarkBtn.innerHTML = (bookmarks[sid] ? '🔖' : '🔖') + ' ' + (bookmarks[sid] ? 'Bookmarked' : 'Bookmark');
          }
        }

        function injectSectionBars() {
          SECTIONS.forEach(sec => {
            const block = document.getElementById('block-' + sec.id);
            if (!block || block.querySelector('.section-action-bar')) return;

            // Estimate reading time
            const words = block.textContent.trim().split(/\s+/).length;
            const minutes = Math.max(1, Math.round(words / 200));

            const bar = document.createElement('div');
            bar.className = 'section-action-bar';
            bar.id = 'sab-' + sec.id;
            bar.innerHTML = `
              <span class="sab-label">Section</span>
              <button class="sab-btn sab-complete" title="Mark as complete (C)">✅ Complete</button>
              <button class="sab-btn sab-bookmark" title="Bookmark this section (B)">🔖 Bookmark</button>
              <button class="sab-btn sab-notes" title="Open notes (N)">📝 Notes</button>
              <span class="reading-time">~${minutes} min read</span>
            `;
            bar.querySelector('.sab-complete').addEventListener('click', () => toggleComplete(sec.id));
            bar.querySelector('.sab-bookmark').addEventListener('click', () => toggleBookmark(sec.id));
            bar.querySelector('.sab-notes').addEventListener('click', () => openNotes(sec.id, sec.title));

            // Insert after the h2
            const h2 = block.querySelector('h2');
            if (h2 && h2.nextSibling) {
              h2.parentNode.insertBefore(bar, h2.nextSibling);
            } else {
              block.prepend(bar);
            }
            updateSectionBar(sec.id);
          });
        }

        function toggleBookmark(sid) {
          bookmarks[sid] = !bookmarks[sid];
          LS.set('bookmarks', bookmarks);
          updateBookmarkUI();
          updateSectionBar(sid);
          toast(bookmarks[sid] ? '🔖 Section bookmarked!' : '🔖 Bookmark removed');
        }

        // ── Notes Panel ───────────────────────────────────────────────────
        const notesPanel = document.getElementById('notes-panel');
        const notesTextarea = document.getElementById('notes-textarea');
        const notesSecName = document.getElementById('notes-section-name');
        const notesCharCount = document.getElementById('notes-char-count');
        const notesSaveBtn = document.getElementById('notes-save-btn');
        const notesCloseBtn = document.getElementById('notes-close');
        const notesOpenBtn = document.getElementById('notes-btn');

        let currentNotesSid = null;

        function openNotes(sid, title) {
          currentNotesSid = sid;
          if (notesSecName) notesSecName.textContent = title || sid;
          const saved = LS.get('note_' + sid, '');
          if (notesTextarea) { notesTextarea.value = saved; updateNotesCount(); }
          if (notesPanel) notesPanel.classList.add('open');
          if (notesTextarea) notesTextarea.focus();
          updateNotesDots();
        }

        function closeNotes() { if (notesPanel) notesPanel.classList.remove('open'); }

        function saveNotes() {
          if (!currentNotesSid || !notesTextarea) return;
          LS.set('note_' + currentNotesSid, notesTextarea.value);
          toast('📝 Notes saved!');
          updateNotesDots();
        }

        function updateNotesCount() {
          if (notesTextarea && notesCharCount) notesCharCount.textContent = notesTextarea.value.length + ' characters';
        }

        function updateNotesDots() {
          document.querySelectorAll('#nav .nav-note-dot').forEach(d => d.remove());
          document.querySelectorAll('#nav a[data-sid]').forEach(a => {
            const hasNote = LS.get('note_' + a.dataset.sid, '').length > 0;
            if (hasNote && !a.querySelector('.nav-note-dot')) {
              const dot = document.createElement('span');
              dot.className = 'nav-note-dot';
              dot.title = 'Has notes';
              a.appendChild(dot);
            }
          });
        }

        if (notesCloseBtn) notesCloseBtn.addEventListener('click', () => { saveNotes(); closeNotes(); });
        if (notesSaveBtn) notesSaveBtn.addEventListener('click', saveNotes);
        if (notesTextarea) notesTextarea.addEventListener('input', updateNotesCount);
        if (notesOpenBtn) notesOpenBtn.addEventListener('click', () => {
          const sid = getCurrentSectionId();
          if (sid) {
            const sec = SECTIONS.find(s => s.id === sid);
            openNotes(sid, sec ? sec.title : sid);
          } else {
            openNotes('general', 'General Notes');
          }
        });

        // ── Search ────────────────────────────────────────────────────────
        const searchOverlay = document.getElementById('search-overlay');
        const searchInput = document.getElementById('search-input');
        const searchResults = document.getElementById('search-results');
        const searchBtn = document.getElementById('search-btn');

        // Build search index
        let searchIndex = [];
        function buildSearchIndex() {
          searchIndex = [];
          SECTIONS.forEach(sec => {
            const block = document.getElementById('block-' + sec.id);
            if (!block) return;
            // Index h3s
            block.querySelectorAll('h3').forEach(h3 => {
              searchIndex.push({ type: 'heading', sid: sec.id, sTitle: sec.title, title: h3.textContent.trim(), text: '', id: h3.id });
            });
            // Index paragraphs
            block.querySelectorAll('p, li').forEach(el => {
              const txt = el.textContent.trim();
              if (txt.length > 20) searchIndex.push({ type: 'text', sid: sec.id, sTitle: sec.title, title: sec.title, text: txt });
            });
            // Index code snippets
            block.querySelectorAll('pre code').forEach(el => {
              const txt = el.textContent.trim().slice(0, 200);
              searchIndex.push({ type: 'code', sid: sec.id, sTitle: sec.title, title: sec.title + ' — code', text: txt });
            });
          });
        }

        let searchSelIdx = -1;

        function highlight(str, query) {
          if (!query) return str;
          const re = new RegExp(query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'gi');
          return str.replace(re, m => '<mark>' + m + '</mark>');
        }

        function doSearch(q) {
          if (!q || q.length < 2) {
            searchResults.innerHTML = '<div id="search-empty">Type to search across all sections…</div>';
            searchSelIdx = -1;
            return;
          }
          const ql = q.toLowerCase();
          const hits = searchIndex.filter(item =>
            item.title.toLowerCase().includes(ql) || item.text.toLowerCase().includes(ql)
          ).slice(0, 20);

          if (hits.length === 0) {
            searchResults.innerHTML = '<div id="search-empty">No results for "' + q + '"</div>';
            searchSelIdx = -1;
            return;
          }

          searchResults.innerHTML = hits.map((h, i) => {
            const snippetRaw = h.text.slice(0, 120) + (h.text.length > 120 ? '…' : '');
            const titleH = highlight(h.title, q);
            const snipH = highlight(snippetRaw, q);
            const icon = h.type === 'code' ? '💻' : h.type === 'heading' ? '📌' : '📄';
            return `<div class="search-result-item" data-idx="${i}" data-sid="${h.sid}" data-id="${h.id || ''}">
              <div class="res-title">${icon} ${titleH} <small style="font-weight:400;color:var(--text-muted)">— ${h.sTitle}</small></div>
              ${snipH ? '<div class="res-snippet">' + snipH + '</div>' : ''}
            </div>`;
          }).join('');

          searchSelIdx = -1;
          searchResults.querySelectorAll('.search-result-item').forEach((el, i) => {
            el.addEventListener('mouseenter', () => { searchSelIdx = i; highlightSearchSel(); });
            el.addEventListener('click', () => openSearchResult(hits[i]));
          });
        }

        function highlightSearchSel() {
          searchResults.querySelectorAll('.search-result-item').forEach((el, i) => {
            el.classList.toggle('is-selected', i === searchSelIdx);
          });
        }

        function openSearchResult(hit) {
          closeSearch();
          const block = document.getElementById('block-' + hit.sid);
          if (block && window.openBlockGlobal) window.openBlockGlobal(block);
          if (hit.id) {
            setTimeout(() => {
              const target = document.getElementById(hit.id);
              if (target && mainEl) {
                const offset = 50;
                const y = target.getBoundingClientRect().top + mainEl.scrollTop - offset;
                mainEl.scrollTo({ top: y, behavior: 'smooth' });
              }
            }, 80);
          }
        }

        function openSearch() {
          buildSearchIndex();
          searchOverlay.classList.add('open');
          if (searchInput) { searchInput.value = ''; searchInput.focus(); }
          searchResults.innerHTML = '<div id="search-empty">Type to search across all sections…</div>';
        }

        function closeSearch() { searchOverlay.classList.remove('open'); }

        if (searchBtn) searchBtn.addEventListener('click', openSearch);
        if (searchOverlay) searchOverlay.addEventListener('click', e => { if (e.target === searchOverlay) closeSearch(); });
        if (searchInput) {
          searchInput.addEventListener('input', () => doSearch(searchInput.value));
          searchInput.addEventListener('keydown', e => {
            const items = searchResults.querySelectorAll('.search-result-item');
            if (e.key === 'ArrowDown') { e.preventDefault(); searchSelIdx = Math.min(searchSelIdx + 1, items.length - 1); highlightSearchSel(); items[searchSelIdx]?.scrollIntoView({ block: 'nearest' }); }
            else if (e.key === 'ArrowUp') { e.preventDefault(); searchSelIdx = Math.max(searchSelIdx - 1, 0); highlightSearchSel(); items[searchSelIdx]?.scrollIntoView({ block: 'nearest' }); }
            else if (e.key === 'Enter' && searchSelIdx >= 0) { e.preventDefault(); items[searchSelIdx]?.click(); }
            else if (e.key === 'Escape') closeSearch();
          });
        }

        // ── Shortcuts Panel ───────────────────────────────────────────────
        const shortcutsOverlay = document.getElementById('shortcuts-overlay');
        const shortcutsBtn = document.getElementById('shortcuts-btn');
        function openShortcuts() { shortcutsOverlay.classList.add('open'); }
        function closeShortcuts() { shortcutsOverlay.classList.remove('open'); }
        if (shortcutsBtn) shortcutsBtn.addEventListener('click', openShortcuts);
        if (shortcutsOverlay) shortcutsOverlay.addEventListener('click', e => { if (e.target === shortcutsOverlay) closeShortcuts(); });

        // ── Pomodoro Timer ────────────────────────────────────────────────
        const pomoHeaderBtn = document.getElementById('pomo-header-btn');
        const pomoWidget = document.getElementById('pomodoro-widget');
        const pomoTime = document.getElementById('pomo-time');
        const pomoLabel = document.getElementById('pomo-label');
        const pomoStartBtn = document.getElementById('pomo-start');
        const pomoResetBtn = document.getElementById('pomo-reset');
        const pomoCircle = document.getElementById('pomo-progress-circle');
        const pomoSessCount = document.getElementById('pomo-session-count');
        const pomoHeaderTick = document.getElementById('pomo-header-tick');

        const POMO_WORK = 25 * 60;
        const POMO_BREAK = 5 * 60;
        let pomoRunning = false;
        let pomoInterval = null;
        let pomoSecondsLeft = POMO_WORK;
        let pomoIsBreak = false;
        let pomoSessions = LS.get('pomoSessions', 0);
        const CIRCUMFERENCE = 213.6; // 2 * PI * 34

        if (pomoSessCount) pomoSessCount.textContent = pomoSessions;

        function pomoUpdateUI() {
          const total = pomoIsBreak ? POMO_BREAK : POMO_WORK;
          const m = Math.floor(pomoSecondsLeft / 60);
          const s = pomoSecondsLeft % 60;
          if (pomoTime) pomoTime.textContent = String(m).padStart(2, '0') + ':' + String(s).padStart(2, '0');
          if (pomoCircle) {
            const offset = CIRCUMFERENCE * (1 - pomoSecondsLeft / total);
            pomoCircle.style.strokeDashoffset = offset;
          }
          if (pomoLabel) pomoLabel.textContent = pomoIsBreak ? '☕ Break Time' : '🎯 Focus Session';
          if (pomoTime) pomoTime.className = pomoIsBreak ? 'pomo-break' : '';
          // Sync mini tick badge on header button
          if (pomoHeaderTick) pomoHeaderTick.textContent = String(m).padStart(2, '0') + ':' + String(s).padStart(2, '0');
          if (pomoHeaderBtn) pomoHeaderBtn.classList.toggle('running', pomoRunning);
        }

        function pomoStart() {
          if (pomoRunning) {
            clearInterval(pomoInterval);
            pomoRunning = false;
            if (pomoStartBtn) pomoStartBtn.textContent = 'Resume';
          } else {
            pomoRunning = true;
            if (pomoStartBtn) pomoStartBtn.textContent = 'Pause';
            pomoInterval = setInterval(() => {
              pomoSecondsLeft--;
              pomoUpdateUI();
              if (pomoSecondsLeft <= 0) {
                clearInterval(pomoInterval);
                pomoRunning = false;
                if (!pomoIsBreak) {
                  pomoSessions++;
                  LS.set('pomoSessions', pomoSessions);
                  if (pomoSessCount) pomoSessCount.textContent = pomoSessions;
                  toast('🎉 Pomodoro complete! Take a break.');
                } else {
                  toast('⚡ Break over! Back to work.');
                }
                pomoIsBreak = !pomoIsBreak;
                pomoSecondsLeft = pomoIsBreak ? POMO_BREAK : POMO_WORK;
                if (pomoStartBtn) pomoStartBtn.textContent = 'Start';
                pomoUpdateUI();
              }
            }, 1000);
          }
        }

        function pomoReset() {
          clearInterval(pomoInterval);
          pomoRunning = false;
          pomoSecondsLeft = POMO_WORK;
          pomoIsBreak = false;
          if (pomoStartBtn) pomoStartBtn.textContent = 'Start';
          pomoUpdateUI();
        }

        pomoUpdateUI();
        if (pomoHeaderBtn) pomoHeaderBtn.addEventListener('click', e => {
          e.stopPropagation();
          pomoWidget.classList.toggle('open');
        });
        if (pomoStartBtn) pomoStartBtn.addEventListener('click', pomoStart);
        if (pomoResetBtn) pomoResetBtn.addEventListener('click', pomoReset);
        // Close widget when clicking outside
        document.addEventListener('click', e => {
          if (pomoWidget && pomoWidget.classList.contains('open')) {
            if (!pomoWidget.contains(e.target) && e.target !== pomoHeaderBtn && !pomoHeaderBtn?.contains(e.target)) {
              pomoWidget.classList.remove('open');
            }
          }
        });

        // ── Global Keyboard Shortcuts ────────────────────────────────────
        document.addEventListener('keydown', function (e) {
          const tag = document.activeElement.tagName;
          const inInput = tag === 'INPUT' || tag === 'TEXTAREA' || document.activeElement.isContentEditable;

          // Ctrl+K / Cmd+K — Search
          if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
            e.preventDefault();
            if (searchOverlay.classList.contains('open')) closeSearch(); else openSearch();
            return;
          }

          if (inInput) return; // Don't fire other shortcuts in inputs

          // ESC — close any open panel
          if (e.key === 'Escape') {
            if (shortcutsOverlay.classList.contains('open')) { closeShortcuts(); return; }
            if (searchOverlay.classList.contains('open')) { closeSearch(); return; }
            if (notesPanel.classList.contains('open')) { saveNotes(); closeNotes(); return; }
            if (pomoWidget.classList.contains('open')) { pomoWidget.classList.remove('open'); return; }
          }

          // ? — shortcuts
          if (e.key === '?') { openShortcuts(); return; }

          // D — dark mode
          if (e.key === 'd' || e.key === 'D') { setDarkMode(!document.body.classList.contains('dark-mode'), true); return; }

          // N — notes
          if (e.key === 'n' || e.key === 'N') {
            const sid = getCurrentSectionId();
            if (sid) { const sec = SECTIONS.find(s => s.id === sid); openNotes(sid, sec ? sec.title : sid); }
            return;
          }

          // T — pomodoro
          if (e.key === 't' || e.key === 'T') { if (pomoWidget) pomoWidget.classList.toggle('open'); return; }

          // Arrow Right — next section
          if (e.key === 'ArrowRight') {
            const sids = SECTIONS.map(s => s.id);
            const cur = getCurrentSectionId();
            const idx = sids.indexOf(cur);
            if (idx < sids.length - 1) {
              const next = document.getElementById('block-' + sids[idx + 1]);
              if (next && window.openBlockGlobal) window.openBlockGlobal(next);
            }
            return;
          }

          // Arrow Left — prev section
          if (e.key === 'ArrowLeft') {
            const sids = SECTIONS.map(s => s.id);
            const cur = getCurrentSectionId();
            const idx = sids.indexOf(cur);
            if (idx > 0) {
              const prev = document.getElementById('block-' + sids[idx - 1]);
              if (prev && window.openBlockGlobal) window.openBlockGlobal(prev);
            }
            return;
          }

          // C — toggle complete
          if (e.key === 'c' || e.key === 'C') {
            const sid = getCurrentSectionId();
            if (sid) toggleComplete(sid);
            return;
          }

          // B — bookmark
          if (e.key === 'b' || e.key === 'B') {
            const sid = getCurrentSectionId();
            if (sid) toggleBookmark(sid);
            return;
          }

          // + / = — increase font
          if (e.key === '+' || e.key === '=') { fontSize = Math.min(22, fontSize + 1); applyFontSize(); toast('Font: ' + fontSize + 'px'); return; }

          // - — decrease font
          if (e.key === '-') { fontSize = Math.max(12, fontSize - 1); applyFontSize(); toast('Font: ' + fontSize + 'px'); return; }
        });

        // ── Hook into openBlock to update active section ──────────────────
        // We expose openBlock globally so our advanced JS can call it too
        // We wrap the DOMContentLoaded hook via a post-init observer
        const openBlockObserver = new MutationObserver(() => {
          const open = document.querySelector('.content-block.is-open');
          if (!open) return;
          // Update nav active highlight
          const sid = open.id.replace('block-', '');
          document.querySelectorAll('#nav a[data-sid]').forEach(a => {
            a.classList.toggle('active', a.dataset.sid === sid);
          });
        });
        openBlockObserver.observe(document.querySelector('main') || document.body, { attributes: true, subtree: true, attributeFilter: ['class'] });

        // Expose openBlock for bookmarks/search navigation
        // The main IIFE sets openBlock; we re-expose it
        setTimeout(() => {
          // Find openBlock from main IIFE scope via event delegation
          window.openBlockGlobal = function (block) {
            // Trigger a click on the corresponding nav link
            if (!block) return;
            const sid = block.id.replace('block-', '');
            const navLink = document.querySelector('#nav a[data-sid="' + sid + '"]');
            if (navLink) navLink.click();
          };
          // Init after main IIFE completes
          injectNavChecks();
          injectSectionBars();
          updateBookmarkUI();
          updateNotesDots();
          updateProgressUI();
        }, 100);


        // ── 6 ADVANCED FEATURES ──────────────────────────────────────────

        // ① Study Streak ─────────────────────────────────────────────────
        {
          const today = new Date().toDateString();
          const lastVisit = LS.get('streakLastVisit', null);
          let streak = LS.get('streakCount', 0);
          const yesterday = new Date(Date.now() - 86400000).toDateString();
          if (lastVisit === today) {
            // same day — no change
          } else if (lastVisit === yesterday) {
            streak++;
          } else {
            streak = 1; // reset
          }
          LS.set('streakLastVisit', today);
          LS.set('streakCount', streak);
          const el = document.getElementById('streak-count');
          const badge = document.getElementById('streak-badge');
          if (el) el.textContent = streak;
          if (badge) badge.title = streak + '-day study streak! Keep it up!';
          if (streak >= 7 && badge) badge.style.background = 'linear-gradient(135deg,#f59e0b,#ef4444)';
          if (streak >= 30 && badge) badge.style.background = 'linear-gradient(135deg,#7c3aed,#ec4899)';
        }

        // ② Copy Code Buttons ────────────────────────────────────────────
        document.querySelectorAll('pre').forEach(pre => {
          if (pre.closest('.code-wrap')) return;
          const wrap = document.createElement('div');
          wrap.className = 'code-wrap';
          pre.parentNode.insertBefore(wrap, pre);
          wrap.appendChild(pre);
          const btn = document.createElement('button');
          btn.className = 'copy-btn';
          btn.innerHTML = '<svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg> Copy';
          btn.title = 'Copy to clipboard';
          wrap.appendChild(btn);
          btn.addEventListener('click', () => {
            const code = pre.querySelector('code') || pre;
            navigator.clipboard.writeText(code.innerText).then(() => {
              btn.textContent = '✓ Copied!';
              btn.classList.add('copied');
              setTimeout(() => {
                btn.innerHTML = '<svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg> Copy';
                btn.classList.remove('copied');
              }, 2000);
            });
          });
        });

        // ③ Zen / Focus Mode ─────────────────────────────────────────────
        const zenBtn = document.getElementById('zen-btn');
        function toggleZen() {
          document.body.classList.toggle('zen-mode');
          if (zenBtn) zenBtn.classList.toggle('active', document.body.classList.contains('zen-mode'));
          toast(document.body.classList.contains('zen-mode') ? '🧘 Zen mode — hover top to show header' : '👁 Zen mode off');
        }
        if (zenBtn) zenBtn.addEventListener('click', toggleZen);

        // ④ Text Highlighter ─────────────────────────────────────────────
        const hlToolbar = document.getElementById('highlight-toolbar');
        let hlRange = null;
        const HL_KEY = 'textHighlights';

        function saveHighlights() {
          const marks = [];
          document.querySelectorAll('mark[data-hl]').forEach(m => {
            marks.push({ text: m.textContent, cls: m.className });
          });
          LS.set(HL_KEY, JSON.stringify(marks));
        }

        function applyHighlight(colorClass) {
          if (!hlRange || hlRange.collapsed) return;
          const sel = window.getSelection();
          if (!sel || sel.rangeCount === 0) return;
          try {
            const mark = document.createElement('mark');
            mark.className = colorClass;
            mark.setAttribute('data-hl', '1');
            hlRange.surroundContents(mark);
            sel.removeAllRanges();
            saveHighlights();
          } catch (e) { /* cross-node — skip */ }
          hlToolbar.classList.remove('visible');
          hlRange = null;
        }

        document.querySelectorAll('.hl-swatch').forEach(sw => {
          sw.addEventListener('mousedown', e => {
            e.preventDefault();
            applyHighlight(sw.dataset.color);
          });
        });

        const hlClear = document.getElementById('hl-clear-btn');
        if (hlClear) {
          hlClear.addEventListener('mousedown', e => {
            e.preventDefault();
            if (hlRange) {
              const mark = hlRange.commonAncestorContainer.parentElement;
              if (mark && mark.tagName === 'MARK') {
                const text = document.createTextNode(mark.textContent);
                mark.replaceWith(text);
                saveHighlights();
              }
            }
            hlToolbar.classList.remove('visible');
          });
        }

        document.addEventListener('mouseup', e => {
          setTimeout(() => {
            const sel = window.getSelection();
            if (!sel || sel.isCollapsed || !sel.toString().trim()) {
              hlToolbar.classList.remove('visible');
              return;
            }
            if (hlToolbar && hlToolbar.contains(e.target)) return;
            hlRange = sel.getRangeAt(0).cloneRange();
            const rect = sel.getRangeAt(0).getBoundingClientRect();
            hlToolbar.style.top = (rect.top + window.scrollY - hlToolbar.offsetHeight - 10) + 'px';
            hlToolbar.style.left = Math.max(4, rect.left + rect.width / 2 - 70) + 'px';
            hlToolbar.classList.add('visible');
          }, 10);
        });

        document.addEventListener('mousedown', e => {
          if (hlToolbar && !hlToolbar.contains(e.target)) {
            hlToolbar.classList.remove('visible');
          }
        });

        // ⑤ Export Notes ─────────────────────────────────────────────────
        const notesExportBtn = document.getElementById('notes-export-btn');
        if (notesExportBtn) {
          notesExportBtn.addEventListener('click', () => {
            const allNotes = [];
            for (let i = 0; i < localStorage.length; i++) {
              const key = localStorage.key(i);
              if (key && key.startsWith('cka-notes-')) {
                const sectionId = key.replace('cka-notes-', '');
                const text = localStorage.getItem(key);
                if (text && text.trim()) {
                  const heading = document.getElementById(sectionId);
                  const title = heading ? heading.textContent.trim() : sectionId;
                  allNotes.push('## ' + title + '\n\n' + text.trim());
                }
              }
            }
            if (!allNotes.length) { toast('📝 No notes saved yet!'); return; }
            const md = '# CKA Study Notes\n_Exported: ' + new Date().toLocaleString() + '_\n\n' + allNotes.join('\n\n---\n\n');
            const blob = new Blob([md], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url; a.download = 'cka-study-notes.md'; a.click();
            URL.revokeObjectURL(url);
            toast('📥 Notes exported as cka-study-notes.md');
          });
        }

        // ⑥ Mini Section TOC ─────────────────────────────────────────────
        const miniToc = document.getElementById('mini-toc');
        const miniTocList = document.getElementById('mini-toc-list');

        function buildMiniToc(block) {
          if (!miniToc || !miniTocList) return;
          miniTocList.innerHTML = '';
          const h3s = block ? block.querySelectorAll('h3') : [];
          if (h3s.length < 2) { miniToc.classList.remove('visible'); return; }
          h3s.forEach(h3 => {
            if (!h3.id) h3.id = 'toc-' + h3.textContent.trim().toLowerCase().replace(/[^a-z0-9]+/g, '-');
            const li = document.createElement('li');
            const a = document.createElement('a');
            a.href = '#' + h3.id;
            a.textContent = h3.textContent;
            a.addEventListener('click', e => {
              e.preventDefault();
              h3.scrollIntoView({ behavior: 'smooth', block: 'start' });
            });
            li.appendChild(a);
            miniTocList.appendChild(li);
          });
          miniToc.classList.add('visible');
        }

        // Update TOC when section changes
        const origOpenBlock = typeof openBlock !== 'undefined' ? openBlock : null;
        if (main) {
          main.addEventListener('scroll', () => {
            const tocLinks = miniTocList ? miniTocList.querySelectorAll('a') : [];
            let active = null;
            tocLinks.forEach(a => {
              const h3 = document.getElementById(a.href.split('#')[1]);
              if (h3) {
                const rect = h3.getBoundingClientRect();
                if (rect.top <= 120) active = a;
              }
              a.classList.remove('toc-active');
            });
            if (active) active.classList.add('toc-active');
          });
        }

        // Hook into existing openBlock via MutationObserver on main
        if (main && miniToc) {
          const tocObs = new MutationObserver(() => {
            const openBlk = main.querySelector('.content-block.is-open');
            if (openBlk) buildMiniToc(openBlk);
            else miniToc.classList.remove('visible');
          });
          tocObs.observe(main, { subtree: true, attributeFilter: ['class'] });
          // Initial
          const initBlk = main.querySelector('.content-block.is-open');
          if (initBlk) buildMiniToc(initBlk);
        }

        // ── Extended Keyboard Shortcuts ──────────────────────────────────
        // Add Z (Zen) and Q (Quiz) to the existing keydown handler
        // We patch by adding a second listener
        document.addEventListener('keydown', function (e) {
          const tag = document.activeElement.tagName;
          const inInput = tag === 'INPUT' || tag === 'TEXTAREA' || document.activeElement.isContentEditable;
          if (inInput) return;
          if (e.key === 'z' || e.key === 'Z') toggleZen();
          if (e.key === 'q' || e.key === 'Q') toggleQuiz();
        });

        // ── CKA Quiz ────────────────────────────────────────────────────
        const QUIZ_QUESTIONS = [
          {
            q: "Which kubectl command marks a node as unschedulable WITHOUT evicting existing pods?",
            opts: ["kubectl drain node01", "kubectl cordon node01", "kubectl taint nodes node01 key:NoSchedule", "kubectl delete node node01"],
            ans: 1, exp: "kubectl cordon only marks the node SchedulingDisabled. kubectl drain also evicts running pods."
          },
          {
            q: "A pod spec has a toleration with operator: Exists and no value. What does this match?",
            opts: ["Taints with value='Exists'", "Only NoSchedule taints", "Any taint with the matching key, regardless of value", "Only taints on the master node"],
            ans: 2, exp: "operator: Exists matches any taint that has the specified key, ignoring the value."
          },
          {
            q: "What happens to a container that exceeds its memory limit?",
            opts: ["It is throttled", "It is OOMKilled and restarted", "The node is cordoned", "Nothing — limits are advisory"],
            ans: 1, exp: "Memory limits are hard. Exceeding them causes an OOM kill (exit code 137). CPU is throttled, not killed."
          },
          {
            q: "Which object sets default resource requests and limits for all containers in a namespace?",
            opts: ["ResourceQuota", "LimitRange", "NetworkPolicy", "PodSecurityPolicy"],
            ans: 1, exp: "LimitRange sets per-container defaults and min/max bounds. ResourceQuota limits total resource consumption for the namespace."
          },
          {
            q: "Static pods are managed by:",
            opts: ["kube-controller-manager", "kube-apiserver", "kubelet directly on the node", "etcd"],
            ans: 2, exp: "kubelet reads YAML files from staticPodPath (/etc/kubernetes/manifests) and manages those pods directly, without the API server."
          },
          {
            q: "You need a pod to land ONLY on nodes labelled gpu=true. Taints alone are not sufficient because:",
            opts: ["Taints don't work with GPUs", "Tolerations only prevent scheduling — they don't guarantee placement on specific nodes", "Taints require a LimitRange", "kubectl taint requires admin privileges"],
            ans: 1, exp: "Taints repel pods that lack tolerations. But a pod with a toleration could still land on a non-GPU node. You must also use Node Affinity to attract pods to gpu=true nodes."
          },
          {
            q: "Which DaemonSet toleration allows the daemon to also run on control-plane (master) nodes?",
            opts: ["effect: NoExecute", "key: node.kubernetes.io/disk-pressure", "key: node-role.kubernetes.io/control-plane, effect: NoSchedule, operator: Exists", "effect: PreferNoSchedule"],
            ans: 2, exp: "Master nodes automatically have node-role.kubernetes.io/control-plane:NoSchedule. A DaemonSet needs this toleration to schedule pods there."
          },
          {
            q: "What is the correct way to remove the taint 'app=blue:NoSchedule' from a node?",
            opts: ["kubectl taint nodes node01 app=blue:NoSchedule --remove", "kubectl untaint nodes node01 app=blue", "kubectl taint nodes node01 app=blue:NoSchedule-", "kubectl patch node (avoid JSON in string)"],

            ans: 2, exp: "Append a minus (-) to the taint specification to remove it: kubectl taint nodes node01 app=blue:NoSchedule-"
          },
          {
            q: "In Node Affinity, requiredDuringSchedulingIgnoredDuringExecution means:",
            opts: ["The pod restarts if the node label changes", "Existing pods are evicted when node labels no longer match", "The rule is hard at scheduling time; already-running pods are NOT evicted if labels change later", "The affinity is applied to init containers only"],
            ans: 2, exp: "IgnoredDuringExecution means the rule is only evaluated at scheduling time. Running pods are not affected by label changes."
          },
          {
            q: "A PriorityClass with preemptionPolicy: Never will:",
            opts: ["Never schedule the pod", "Schedule the pod with high priority but NOT preempt lower-priority pods", "Evict lower pods but without a grace period", "Only work on nodes with GPUs"],
            ans: 1, exp: "preemptionPolicy: Never means the pod gets a high priority value for ordering but will not preempt (evict) running lower-priority pods when the cluster is full."
          },
          {
            q: "kubectl drain fails on a node that has a pod using emptyDir. Which flag resolves this?",
            opts: ["--force", "--ignore-daemonsets", "--delete-emptydir-data", "--skip-volumes"],
            ans: 2, exp: "--delete-emptydir-data allows drain to proceed by evicting pods that use emptyDir volumes (data will be lost)."
          },
          {
            q: "You want a pod to prefer nodes with disktype=ssd but still schedule elsewhere if unavailable. Which affinity type is correct?",
            opts: ["requiredDuringSchedulingIgnoredDuringExecution", "requiredDuringSchedulingRequiredDuringExecution", "preferredDuringSchedulingIgnoredDuringExecution", "preferredDuringSchedulingRequiredDuringExecution"],
            ans: 2, exp: "preferred...IgnoredDuringExecution is the soft rule. The scheduler tries to match but places the pod elsewhere if no matching node is available."
          },
          {
            q: "Which component on a node actually starts pod containers after the scheduler assigns nodeName?",
            opts: ["kube-proxy", "kube-scheduler", "kubelet", "container-runtime only (no orchestration)"],
            ans: 2, exp: "The kubelet on each node watches for pods assigned to its node via nodeName, then instructs the container runtime (containerd/docker) to pull images and start containers."
          },
          {
            q: "Scheduler Profiles (KubeSchedulerConfiguration) allow you to:",
            opts: ["Run multiple separate scheduler binaries", "Run multiple scheduler personalities inside one binary with per-profile plugin configs", "Scale the scheduler horizontally", "Configure etcd for the scheduler"],
            ans: 1, exp: "Since K8s 1.18, multiple profiles with different plugin configurations can run in a single scheduler binary, identified by different schedulerName values."
          },
          {
            q: "The nodeSelector in a pod spec only supports which type of matching?",
            opts: ["Regex matching", "Greater-than / less-than", "Equality-based labels only", "Weight-based scoring"],
            ans: 2, exp: "nodeSelector supports only exact equality matches (key=value). For In, NotIn, Exists, DoesNotExist operators or soft preferences, use Node Affinity instead."
          },
        ];

        const quizOverlay = document.getElementById('quiz-overlay');
        const quizClose = document.getElementById('quiz-close');
        const quizQuestion = document.getElementById('quiz-question');
        const quizOptions = document.getElementById('quiz-options');
        const quizExp = document.getElementById('quiz-explanation');
        const quizNext = document.getElementById('quiz-next');
        const quizScore = document.getElementById('quiz-score');
        const quizProgressFill = document.getElementById('quiz-progress-fill');
        const quizResults = document.getElementById('quiz-results');
        const quizFinalScore = document.getElementById('quiz-final-score');
        const quizResultMsg = document.getElementById('quiz-result-msg');
        const quizRestart = document.getElementById('quiz-restart');
        const quizBtn = document.getElementById('quiz-btn');

        let quizIdx = 0, quizCorrect = 0, shuffled = [];

        function shuffleArr(arr) { return [...arr].sort(() => Math.random() - 0.5); }

        function startQuiz() {
          shuffled = shuffleArr(QUIZ_QUESTIONS);
          quizIdx = 0; quizCorrect = 0;
          if (quizResults) quizResults.style.display = 'none';
          if (quizQuestion) quizQuestion.style.display = '';
          if (quizOptions) quizOptions.style.display = '';
          if (quizNav) quizNav.style.display = '';
          showQuestion();
        }

        const quizNav = document.getElementById('quiz-nav');

        function showQuestion() {
          const q = shuffled[quizIdx];
          if (quizProgressFill) quizProgressFill.style.width = ((quizIdx / shuffled.length) * 100) + '%';
          if (quizScore) quizScore.textContent = 'Question ' + (quizIdx + 1) + ' of ' + shuffled.length;
          if (quizQuestion) quizQuestion.textContent = q.q;
          if (quizExp) { quizExp.classList.remove('show'); quizExp.textContent = ''; }
          if (quizNext) quizNext.style.display = 'none';
          if (quizOptions) {
            quizOptions.innerHTML = '';
            q.opts.forEach((opt, i) => {
              const btn = document.createElement('button');
              btn.className = 'quiz-option';
              btn.textContent = opt;
              btn.addEventListener('click', () => answerQuiz(i, q.ans, q.exp));
              quizOptions.appendChild(btn);
            });
          }
        }

        function answerQuiz(chosen, correct, exp) {
          const btns = quizOptions ? quizOptions.querySelectorAll('.quiz-option') : [];
          btns.forEach((b, i) => {
            b.disabled = true;
            if (i === correct) b.classList.add('correct');
            else if (i === chosen) b.classList.add('wrong');
          });
          if (chosen === correct) quizCorrect++;
          if (quizExp) { quizExp.textContent = '💡 ' + exp; quizExp.classList.add('show'); }
          if (quizNext) quizNext.style.display = 'block';
        }

        if (quizNext) quizNext.addEventListener('click', () => {
          quizIdx++;
          if (quizIdx >= shuffled.length) {
            showQuizResults();
          } else {
            showQuestion();
          }
        });

        function showQuizResults() {
          if (quizProgressFill) quizProgressFill.style.width = '100%';
          if (quizQuestion) quizQuestion.style.display = 'none';
          if (quizOptions) quizOptions.style.display = 'none';
          if (quizExp) quizExp.classList.remove('show');
          if (quizNav) quizNav.style.display = 'none';
          if (quizResults) quizResults.style.display = 'block';
          const pct = Math.round((quizCorrect / shuffled.length) * 100);
          if (quizFinalScore) quizFinalScore.textContent = pct + '%';
          let msg = pct >= 90 ? '🎉 Excellent! You\'re ready for the CKA exam!' :
            pct >= 70 ? '👍 Good job! Review the topics you missed.' :
              pct >= 50 ? '📚 Keep studying — focus on Scheduling concepts.' :
                '💪 Keep going! Practice makes perfect.';
          if (quizResultMsg) quizResultMsg.textContent = msg + ' (' + quizCorrect + '/' + shuffled.length + ' correct)';
        }

        function toggleQuiz() {
          if (!quizOverlay) return;
          if (quizOverlay.classList.contains('open')) {
            quizOverlay.classList.remove('open');
          } else {
            quizOverlay.classList.add('open');
            startQuiz();
          }
        }

        if (quizBtn) quizBtn.addEventListener('click', toggleQuiz);
        if (quizClose) quizClose.addEventListener('click', () => quizOverlay && quizOverlay.classList.remove('open'));
        if (quizOverlay) quizOverlay.addEventListener('click', e => { if (e.target === quizOverlay) quizOverlay.classList.remove('open'); });
        if (quizRestart) quizRestart.addEventListener('click', startQuiz);


      })(); // End advanced features


    })();
  </script>
</body>

</html>
